{
    "title": "Endpoint Protection - Symantec Enterprise",
    "text": "01/04/24, 16:38Endpoint Protection - Symantec Enterprise Pagina 1 di 8https://community.broadcom.com/symantecenterprise/communities/…Key=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocuments PRODUCTSAPPLICATIONSSUPPORTCOMPANYHOW TO BUYSign inRegister StatisticsEndpoint Protection View OnlyCommunity HomeThreadsLibraryEventsMembers BACK TO LIBRARYWannaCry: Ransomware attacks show strong links toLazarus group 28 RecommendMay 22, 2017 06:19 PM A LJohnsonTools and infrastructure used in the WannaCry ransomware attacks have strong links to Lazarus,the group that was responsible for the destructive attacks on Sony Pictures and the theft ofUS$81 million from the Bangladesh Central Bank. Despite the links to Lazarus, the WannaCryattacks do not bear the hallmarks of a nation-state campaign but are more typical of acybercrime campaign. Our analysis only allows us to attribute these attacks to the Lazarusgroup. The technical details do not enable us to attribute the motivations of the attacks to aspeciﬁc nation state or individuals.Prior to the global outbreak on May 12, an earlier version of WannaCry (Ransom.Wannacry) wasused in a small number of targeted attacks in February, March, and April. This earlier versionwas almost identical to the version used in May 2017, with the only difference the method ofpropagation. Analysis of these early WannaCry attacks by Symantec’s Security Response teamrevealed substantial commonalities in the tools, techniques, and infrastructure used by theattackers and those seen in previous Lazarus attacks, making it highly likely that Lazarus wasbehind the spread of WannaCry. These earlier versions of WannaCry used stolen credentials tospread across infected networks, rather than leveraging the leaked Eternal Blue exploit thatcaused WannaCry to spread quickly across the globe starting on May 12.Summary of linksFollowing the ﬁrst WannaCry attack in February, three pieces of malware linked toLazarus were discovered on the victim’s network: Trojan.Volgmer and two variants ofBackdoor.Destover, the disk-wiping tool used in the Sony Pictures attacks.Trojan.Alphanc, which was used to spread WannaCry in the March and April attacks, is amodiﬁed version of Backdoor.Duuzer, which has previously been linked to Lazarus.Trojan.Bravonc used the same IP addresses for command and control as Backdoor.Duuzerand Backdoor.Destover, both of which have been linked to Lazarus.Backdoor.Bravonc has similar code obfuscation as WannaCry and Infostealer.Fakepude(which has been linked to Lazarus).There is shared code between WannaCry and Backdoor.Contopee, which has previouslybeen linked to Lazarus.February attackThe ﬁrst evidence Symantec has seen of WannaCry being used in the wild was February 10,2017, when a single organization was compromised. Within two minutes of the initial infection,more than 100 computers in the organization were infected.The attackers left behind several tools on the victim’s network that provided substantialevidence into how WannaCry spread. Two ﬁles, mks.exe and hptasks.exe (see Appendix C:Indicators of Compromise), were found on one affected computer. The ﬁle mks.exe is a variantof Mimikatz (Hacktool.Mimikatz), a password-dumping tool that is widely used in targetedattacks. The latter ﬁle, hptasks.exe, was used to then copy and execute WannaCry on othernetwork computers using the passwords stolen by mks.exe.The spread of WannaCry by hptasks.exe was a two-stage process. In stage one, when run,hptasks can be passed a target list of IP addresses as an argument. When given this command,hptasks reads previously stolen credentials from a ﬁle called cg.wry and uses them to connectto every computer in the set of IP address ranges. All connection attempts are logged into the0 Favorited0 Views0 Files0 Shares0 Downloads01/04/24, 16:38Endpoint Protection - Symantec Enterprise Pagina 2 di 8https://community.broadcom.com/symantecenterprise/communities/…Key=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocumentslog.dat ﬁle. If a successful connection is made to a remote computer, and there is no ﬁle with a.res extension in either the Admin$, or C$\\Windows folders, then hptasks.exe will copy the ﬁleslisted in Table 2 onto the remote computer.File nameRemote locationsTypecg.wry\\\\%s\\Admin$\\, \\\\%s\\C$\\Windows\\where %s the remote systemConﬁguration detailsr2.wry\\\\%s\\Admin$\\, \\\\%s\\C$\\Windows\\where %s the remote systemMessage to the user with instructions onhow to payt1.wry\\\\%s\\Admin$\\, \\\\%s\\C$\\Windows\\where %s the remote systemMessage to the user, for example \"Most ofyour ﬁles are encrypted...\"taskmsgr.exe\\\\%s\\Admin$\\, \\\\%s\\C$\\Windows\\where %s the remote systemApplication for displaying the messages int1.wry and t2.wrytaskschs.exe\\\\%s\\Admin$\\, \\\\%s\\C$\\Windows\\where %s the remote systemWannaCry encryption applicationTable 1. Files copied by hptasks.exe onto target computersAfter hptasks.exe executes WannaCry on the remote computer, the second stage begins.hptasks can pass several arguments to the WannaCry installation on the remote computer,including a new set of  IP addresses. If WannaCry is run with these IP addresses as arguments, itdoes not encrypt the ﬁles on the local computer. Instead, it connects to the IP addressespassed, accesses the Admin$ and C$ share on those computers using the credentialsembedded in the resource section in a ﬁle called c.wry, and then remotely encrypts those ﬁles.In addition to hptasks.exe and mks.exe, ﬁve other pieces of malware were discovered on asecond computer on the victim’s network. Three of these tools are linked to Lazarus. Two werevariants of Destover (Backdoor.Destover) a tool used in the Sony Pictures attacks. The third wasTrojan.Volgmer, malware that has previously been used by Lazarus in attacks against SouthKorean targets.  March and April attacksBeginning on March 27, at least ﬁve organizations were infected with a new sample ofWannaCry. There does not appear to have been a pattern to those targeted, with theorganizations spanning a range of sectors and geographies. These attacks revealed furtherevidence of links between those behind WannaCry and the Lazarus Group.Two different backdoors were used to deploy WannaCry in these attacks: Trojan.Alphanc andTrojan.Bravonc. Alphanc was used to drop WannaCry onto computers belonging to at least twoof the known victims, with a slightly modiﬁed version of the malware deployed to each victim.Alphanc shares a signiﬁcant amount of code with Backdoor.Duuzer, a sub-family of theDestover wiping tool used in the Sony attacks (see Appendix B: Shared Code). In fact,Symantec investigators believe Alphanc is an evolution of Duuzer. Duuzer has also previouslybeen linked to the activity of Backdoor.Joanap and Trojan.Volgmer, which have both beenpreviously linked to Lazarus.Symantec researchers were able to establish a detailed timeline of the activity of Alphanc onone of the victim’s systems, from the time it got on the system to when WannaCry wasdeployed.Timeline of Alphanc activityAlphanc was deployed on the target computer as armsvc.exe and minutes later copied itself toa new name, javaupdate.exe. The sample executed from this location:cmd.exe /c \"copy c:\\Users\\Administrator\\AppData\\armsvc.exec:\\windows\\system32\\javaupdate.exe >C:\\Users\\REDACTED\\AppData\\Local\\Temp\\NK15DA.tmp\" 2>&1Minutes later, mks.exe, the same credential dumper used in the February WannaCry attacks, wascreated and executed. There was no activity for three days, until the attackers returned anddeployed a version of RAR and created a password-protected archive. Moments later a networkscanner called g.exe ran. This performed a DNS lookup for all IP addresses in the IP addressrange selected by the attackers, probably to determine computers of interest. A two-day gap inactivity followed before the attackers returned to proﬁle the local network. Examples ofcommands used include:cmd.exe /c \"net view > C:\\Users\\REDACTED\\AppData\\Local\\Temp\\NK2301.tmp\" 2>&1cmd.exe /c \"net view /domain > C:\\Users\\REDACTED\\AppData\\Local\\Temp\\NK6C42.tmp\" 2>&1cmd.exe /c \"time /t > C:\\Users\\REDACTED\\AppData\\Local\\Temp\\NKC74F.tmp\" 2>&1Then, the ﬁle taskhcst.exec was created by javaupdate.exe. This was the WannaCry ransomware.The .exec extension is renamed to .exe, as illustrated blow. This was likely a safety check so thatthe attacker would not mistakenly execute the ﬁle prematurely.cmd.exe /c \"ren C:\\Windows\\taskhcst.exec taskhcst.exe >C:\\Users\\REDACTED\\AppData\\Local\\Temp\\NK833D.tmp\" 2>&101/04/24, 16:38Endpoint Protection - Symantec Enterprise Pagina 3 di 8https://community.broadcom.com/symantecenterprise/communities/…Key=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocumentsApproximately 45 minutes later, the attacker copied the javaupdate.exe backdoor to a remotecomputer. A ﬁle called bcremote.exe was then also copied to this computer; this was the sametool that was called hptasks.exe in the February attack, and was used to spread WannaCryacross the network. The conﬁguration ﬁle for this ﬁle was then copied, and ﬁnally WannaCryitself was copied over:cmd.exe /c \"net use \\\\REDACTED\\ipc$ REDACTED /u:REDACTED >C:\\Users\\REDACTED\\AppData\\Local\\Temp\\NK2E.tmp\" 2>&1cmd.exe /c \"copy c:\\windows\\system32\\javaupdate.exe\\\\REDACTED\\c$\\windows\\javaupdate.exe >C:\\Users\\REDACTEDAppData\\Local\\Temp\\NK3E49.tmp\" 2>&1cmd.exe /c \"copy c:\\windows\\beremote.exe \\\\REDACTED\\c$\\windows\\ >C:\\Users\\REDACTED\\AppData\\Local\\Temp\\NK4DD5.tmp\" 2>&1cmd.exe /c \"copy c:\\windows\\c.wry \\\\REDACTED\\c$\\windows\\ >C:\\Users\\REDACTED\\AppData\\Local\\Temp\\NK7228.tmp\" 2>&1cmd.exe /c \"copy c:\\windows\\taskh*.exe \\\\REDACTED\\c$\\windows\\ >C:\\Users\\REDACTED\\AppData\\Local\\Temp\\NK7DCF.tmp\" 2>&1The same process took place on a second server on the network, and when the bcremote.execommand was executed, WannaCry was spread across the network.Trojan.BravoncFewer details are available about the operation of Trojan.Bravonc, but it was used to dropWannaCry onto the computers of at least two other victims, and displays some fairly deﬁnitivelinks to the Lazarus group.It connects to a command and control (C&C) server at the IP address 87.101.243.252, which isthe same IP address used by a sample of Destover, a known Lazarus tool. This IP address wasalso referenced in Blue Coat’s From Seoul To Sony report.Duuzer has also been observed using this IP address as a C&C server. Bravonc and a variant ofDestover also share cryptographic related code (See Appendix B: Shared Code). In addition,Bravonc’s method of spreading (over SMB using hardcoded credentials), was the sametechnique used by Joanap, another Lazarus-linked tool. May attacks: WannaCry goes globalOn May 12, a new version of WannaCry was released which incorporated the leaked“EternalBlue” exploit that used two known vulnerabilities in Windows (CVE-2017-0144 and CVE-2017-0145) to spread the ransomware to unpatched computers on the victim’s network and alsoto other vulnerable computers connected to the internet.The incorporation of EternalBlue transformed WannaCry from a dangerous threat that couldonly be used in a limited number of targeted attacks to one of the most virulent strains ofmalware seen in recent years. It caused widespread disruption, both to organizations infectedand to organizations forced to take computers offline for software updates. The discovery andtriggering of a kill switch by security blog MalwareTech halted its spread and limited thedamage.The earlier versions of WannaCry and the one used in the May 12 attacks are largely the same,with some minor changes, chieﬂy the incorporation of the EternalBlue exploit. The passwordsused to encrypt the Zip ﬁles embedded in the WannaCry dropper are similar across bothversions (\"wcry@123\", \"wcry@2016\", and \"WNcry@2ol7\") indicating that the author of bothversions is likely the same group.The small number of Bitcoin wallets used by ﬁrst version of WannaCry, and its limited spread,indicates that this was not a tool that was shared across cyber crime groups. This providesfurther evidence that both versions of WannaCry were operated by a single group.WannaCry links to LazarusAside from commonalities in the tools used to spread WannaCry, there are also a number oflinks between WannaCry itself and Lazarus. The ransomware shares some code withBackdoor.Contopee, malware that has previously been linked to Lazarus. One variant ofContopee uses a custom SSL implementation, with an identical cipher suite, which is also usedby WannaCry. The cipher suite in both samples has the same set of 75 different ciphers tochoose from (as opposed to OpenSSL where there are over 300).In addition, WannaCry uses similar code obfuscation to Infostealer.Fakepude, malware that haspreviously been linked to Lazarus; and Trojan.Alphanc, malware that was used to spreadWannaCry in the March and April attacks and which has been linked to Lazarus (see above).Fortuitous leak turned WannaCry into global threat01/04/24, 16:38Endpoint Protection - Symantec Enterprise Pagina 4 di 8https://community.broadcom.com/symantecenterprise/communities…Key=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocumentsThe discovery of a small number of earlier WannaCry attacks has provided compelling evidenceof a link to the Lazarus group. These earlier attacks involved signiﬁcant use of tools, code, andinfrastructures previously associated with the Lazarus group, while the means of propagationthrough backdoors and stolen credentials is consistent with earlier Lazarus attacks. The leak ofthe EternalBlue exploit was what allowed the attackers to turn WannaCry into a far more potentthreat than it would have been had they still been relying on their own tools, since it bypassedmany of the steps the attackers previously had to take, removing both the need to stealcredentials and copy it from computer to computer. Thanks to Symantec’s Network Protection Research Labs for their contribution to this research.Appendix A: WannaCry and Lazarus shared networkinfrastructureThere are a number of crossovers seen in the C&C servers used in the WannaCry campaigns andby other known Lazarus tools. For example, during the attacks against Sony, a malware familycalled Backdoor.Destover was deployed. Later variants of Backdoor.Destover were seen to usethe IP address 87.101.243.252 for command and control. The Trojan.Bravonc sample discovereddropping WannaCry also connects to this IP address. Other shared network infrastructure islisted below:C&CUsed by Comments87.101.243.252Trojan.Bravonc,Backdoor.DuuzerBackdoor.Destover 84.92.36.96Trojan.AlphancAlso used by a backdoor program which shares an additionalC&C with Lazarus-linked Backdoor.Cuprox184.74.243.67Trojan.AlphancAlso seen used by entaskloader.exe which drops a networkscanning tool used in March attacks203.69.210.247Trojan.Alphanc 196.45.177.52Backdoor.CuproxAlso seen used by a backdoor program dropped by adocument called “discussion_QuadrigaCX.doc”Table 2. Infrastructure shared by WannaCry and other Lazarus toolsAppendix B: Shared CodeShared network code between Trojan.Alphanc andBackdoor.DuuzerTrojan.Alphanc and Backdoor.Duuzer use similar code to generate the buffer being sent outafter connection to the C&C server is established. This code is part of what could be referred toas a \"Fake SSL\" handshake. This is similar in concept to the code identiﬁed by Google, butdifferent in implementation. Both samples generate a random number, and use that number tolookup a table for additional data to send. That table is identical across both samples. Inaddition, both samples will prepend the same value, 0x16030100, to the start of the buffer sentto the C&C server. Figure 1. Backdoor.Duuzer sample with the hash fa6ee9e969df5ca4524daa77c172a1a701/04/24, 16:38Endpoint Protection - Symantec Enterprise Pagina 5 di 8https://community.broadcom.com/symantecenterprise/communities/…Key=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocuments Figure 2. Backdoor Alphanc sample with the hash E8C6ACC1EB7256DB728C0F3FED5D23D7Common strings between Trojan.Alphanc andBackdoor.DuuzerThe following table demonstrates the common strings between Trojan.Alphanc andBackdoor.Duuzer.01/04/24, 16:38Endpoint Protection - Symantec Enterprise Pagina 6 di 8https://community.broadcom.com/symantecenterprise/communities/…Key=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocuments Figure 3. Common strings between Trojan.Alphanc and Backdoor.DuuzerCryptographic number related routines betweenBackdoor.Bravonc and Backdoor.Destover 01/04/24, 16:38Endpoint Protection - Symantec Enterprise Pagina 7 di 8https://community.broadcom.com/symantecenterprise/communities/…Key=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocuments Figure 4. Trojan.Bravonc sample with the hash 55dd9b0af2a263d215cb4fd48f16231a Figure 5. Destover variant with the hash 0f246a13178841f8b324ca54696f592bShared function identiﬁed by Neel MehtaOn May 15, Google researcher Neel Mehta tweeted the following: The ﬁrst hash, 9c7c7149387a1c79679a87dd1ba755bc, is a Ransom.WannaCry variant andac21c8ad899727137c4b94458d7aa8d8 is a variant of Backdoor.Contopee, a backdoor used inattacks against several banks. The samples referenced in the tweet contain shared code. Thisshared code is part of a custom SSL implementation, using an identical cipher suite. It could bedescribed as \"fake ssl\". Each cipher speciﬁes an option for key exchange, authentication, bulkencryption, MAC. The Contopee sample and WannaCry sample have almost identical pieces ofcode that reference an identical cipher suite. The cipher suite in both samples has the same 75different ciphers to choose from (as opposed to OpenSSL where there are over 300).Appendix C: Indicators of CompromiseMD5SHA256File name21307227ECE129B1E12797ECC2C9B6D98A4D2BAA8CF519C7A9B91F414A0A9D8BA2B9E96D21D9E77DA7B34ED849830A36mks.exe6F0338AF379659A5155B3D2A4F1A1E92CA8DC152DC93EC526E505CF2A173A635562FFBF55507E3980F7DC6D508F0F258hptasks.exe0489978ffa3b864ede646d04705003362A99BCB5D21588E0A43F56AADA4E2F386791E0F757126B2773D943D7CBF47195ENTASKLOADER.EXE.Creates forti.exea1ffca7ba257b4eca7fe7d1e78bac6233C86FC0A93299A0D0843C7D7FF1A137A9E799F8F2858D3D30F964E3C12C28C9Eforti.exejavaupdate.exe,01/04/24, 16:38Endpoint Protection - Symantec Enterprise Pagina 8 di 8https://community.broadcom.com/symantecenterprise/communities/…Key=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocumentsf27cf59b00dacdd266ad7894a1df089492b0f4517fb22535d262a7f17d19f7c21820a011bfe1f72a2ec9fbffbdc7e3e0creates g.exea1ffca7ba257b4eca7fe7d1e78bac6233C86FC0A93299A0D0843C7D7FF1A137A9E799F8F2858D3D30F964E3C12C28C9Eg.exe511778c279b76cac40d5d695c56db4f591146EE63782A2061701DB3229320C161352EE2BC4059CCC3123A33114774D66svchost.exe, Createslsasvs.exef774c0588da59a944abc78d5910be407A7EA1852D7E73EF91EFB5EC9E26B4C482CA642D7BC2BDB6F36AB72B2691BA05Alsasvs.exe, Creates50793105.exe8386379a88a7c9893a62a67ea30737427F8166589023CD62AE55A59F5FCA60705090D17562B7F526359A3753EB74EA2F50793105.exe, Createstaskhcst.exe3bc855bfadfea71a445080ba72b26c1c043E0D0D8B8CDA56851F5B853F244F677BD1FD50F869075EF7BA1110771F70C2taskhcst.exe,WannaCryF27CF59B00DACDD266AD7894A1DF089492B0F4517FB22535D262A7F17D19F7C21820A011BFE1F72A2EC9FBFFBDC7E3E0armsvc.exe,javaupdate.exeE8C6ACC1EB7256DB728C0F3FED5D23D7524F8F0F8C31A89DF46A77C7A30AF5D2A1DC7525B08BFAFBED98748C3D8A3F1Cjusched.exe1D4EC831292B611F1FF8983EBD1DB5D441E9D6C3374FD0E78853E945B567F9309446084E05FD013805C70A6A8205CD70msinj32.exeD0CE651A344979C8CD11B8019F8E4D7E436195BD6786BAAE8980BDFED1D7D7DBCCCB7D5085E79EBDCC43E22D8BAE08A8goyqsvc.dll9A5FA5C5F3915B2297A1C379BE9979F09F177A6FB4EA5AF876EF8A0BF954E37544917D9AABA04680A29303F24CA5C72Cexldcmgmt.dll86759CE27D0FE0B203AAA19D4390A416AE8E9FF2DC0EC82B6BAE7C4D978E3FEAC93353CB3CD903E15873D31E30749150oledbg32.dllFCF3702E52AE32C995A36F7516C662B7FC079CEFA19378A0F186E3E3BF90BDEA19AB717B61A88BF20A70D357BF1DB6B8bitssvcs.dlle117406e3c14ab8e98b27c3697aea0b62BA20E39FF90E36086044D02329D43A8F7AE6A7663EB1198B91A95EA556CF56300bebc12.exe For additional information from Symantec regarding the WannaCry virus, visit our dedicatedWannaCry Ransomware page.Tags and KeywordsRelated Entries and LinksNo Related Resource entered. PRODUCTSAPPLICATIONSSUPPORTCOMPANYHOW TO BUYCopyright   2005-2024 Broadcom. All Rights Reserved. The term \"Broadcom\" refers to Broadcom Inc. and/or its subsidiaries.Hosted by Higher Logic, LLC on the behalf of Broadcom - Privacy Policy | Cookie Policy | Supply Chain TransparencyTerms of Use"
}