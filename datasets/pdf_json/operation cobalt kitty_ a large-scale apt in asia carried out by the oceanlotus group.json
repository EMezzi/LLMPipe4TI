{
    "title": "operation cobalt kitty_ a large-scale apt in asia carried out by the oceanlotus group",
    "text": "UCRI FOR UPDAT mail UCRI    Dued Operation Coalt Kitt, the APT targeted a gloal corporation aed in Aia with the goal of tealing proprietar uine information. The threat actor targeted the compan’ top-level management  uing pear-phihing attack a the initial penetration vector, ultimatel compromiing the computer of vice preident, enior director and other ke peronnel in the operational department. During Operation Coalt Kitt, the attacker compromied more than 40 PC and erver, including the domain controller,  le erver, We application erver and dataae erver. Want to hear aout another high-impact operation?  IGN UP FOR TH OPRATION OFT CLL WINAR Forenic artifact revealed that the attacker perited on the network for at leat a ear efore Cereaon wa deploed. The adverar proved ver adaptive and reponded to compan’ ecurit meaure  periodicall changing tool, technique and procedure (TTP), allowing them to perit on the network for uch an extenive period of time. Over 80 paload and numerou domain were oerved in thi operation - all of which were undetected  traditional ecurit product deploed in the compan’ environment at the time of the attack. The attacker arenal conited of modi ed pulicl-availale tool a well a ix undocumented cutom- uilt tool, which Cereaon conider the threat actor’ ignature tool. Among thee tool are two ackdoor that exploited DLL ideloading attack in Microoft, Google and Kaperk application. In addition, the developed a novel and tealth ackdoor that target Microoft Outlook for command-and- control channel and data ex ltration. aed on the tool, modu operandi and IOC (indicator of compromie) oerved in Operation Coalt Kitt,  Cereaon attriute thi large-cale cer epionage APT to the “ OceanLotu Group ” (which i alo known a, APT-C-00 , eaLotu and APT32). For detailed information ting Operation Coalt Kitt to the OceanLotu Group, pleae ee our Attacker’ Arenal and Threat Actor Pro le ection. Cereaon alo attriute the recentl reported ackdoor.Win32.Deni  to the OceanLotu Group, which at the time of thi report’ writing, had not een of ciall linked to thi threat actor. Finall, thi report offer a rare glimpe into what a cer epionage APT look like \"under-the-hood\". Cereaon wa ale to monitor and detect the entire attack lifeccle, from in ltration to ex ltration and all the tep in etween. Our report contain the following detailed ection (PDF): Coalt Kitt Lifeccle: A tep--tep anali Coalt Kitt Attacker’ Arenal: Deep dive into the tool ued in the APT Coalt Kitt Threat Actor Pro le and Indicator of Compromie HIGH-LVL ATTACK OUTLIN:  A CAT-AND-MOU GAM IN FOUR ACT The following ection outline the four phae of the attack a oerved  Cereaon’ analt, who were called to invetigate the environment after the compan’ IT department upected that their network wa reached ut could not trace the ource. PHA ON: FILL OPRATION (POWRHLL AND COALT TRIK PAYLOAD) aed on the forenic evidence collected from the environment, phae one wa the continuation of the original attack that egan aout a ear efore Cereaon wa deploed in the environment. During that phae, the threat actor operated a  lele Powerhell-aed infratructure, uing cutomized Powerhell paload taken from known offenive framework uch a Coalt trike , Powerploit  and Nihang . The initial penetration vector wa carried out  ocial engineering. Carefull elected group of emploee received pear-phihing email, containing either link to maliciou ite or weaponized Word document. Thee document contained maliciou macro that created peritence on the compromied machine uing two cheduled tak, whoe purpoe wa to download econdar paload (mainl Coalt trike eacon): MAY 24, 2017 9 min read   Written by: ASSAF DAHANOPERATION COBALT KITTY: A LARGE-SCALE APT IN ASIA CARRIED OUT BY THE OCEANLOTUS GROUP  cheduled tak 1:  Download a COM criptlet that redirect to Coalt trike paload: cheduled tak 2:  Ue Javacript to download a Coalt trike eacon: ee more detailed anali of the maliciou document in our Attack Life Ccle ection. FILL PAYLOAD DLIVRY INFRATRUCTUR In the  rt phae of the attack, the attacker ued a  lele in-memor paload deliver infratructure coniting of the following component: 1. V and Powerhell-aed loader The attacker dropped Viual aic and Powerhell cript in folder that the created under the ProgramData (a hidden folder,  default). The attacker created peritence uing Window’ regitr, ervice and cheduled tak. Thi peritence mechanim enured that the loader cript would execute either at tartup or at predetermined interval. Value found in Window’ Regitr: the V cript are executed  Window’ Wcript at tartup: The .v cript a well a the .txt  le contain the loader’ cript, which launche Powerhell with a ae64 encoded command, which either load another Powerhell cript (e.g Coalt trike eacon) or fetche a paload from the command-and-control (C&C) erver: 2. In-memor  lele paload from C&C erver The paload erved  the C&C erver are motl Powerhell cript with emedded ae64-encoded paload (Metaploit and Coalt trike paload): xample 1:  Powerhell paload with emedded hellcode downloading Coalt trike eacon The decoded paload i a hellcode, whoe purpoe i to retrieve a Coalt trike eacon from the C&C erver:  xample 2: Coalt trike eacon emedded in ofucated Powerhell A econd tpe of an ofucated Powerhell paload conited of Coalt trike’ eacon paload: Le than 48 hour after Cereaon alerted the compan aout the reach , the attacker tarted to change their approach and almot completel aandoned the Powerhell infratructure that the had een uing - replacing it with ophiticated cutom-uilt ackdoor. The attacker’ remarkale ailit to quickl adapt demontrated their kill and familiarit with and command of the compan’ network and it operation. The attacker mot likel replaced the Powerhell infratructure after the compan ued oth Window Group Polic Oject (GPO) and Cereaon’ execution prevention feature to prevent Powerhell execution. PHA TWO: ACKDOOR XPLOITING DLL- HIJACKING AND UING DN TUNNLING After realizing that the Powerhell infratructure had een dicovered, the attacker had to quickl replace it to maintain peritence and continue the operation. Replacing thi infratructure in 48 hour ugget that the threat actor were prepared for uch a cenario. During the econd phae of the attack, the attacker introduced two ophiticated ackdoor that the attempted to deplo on elected target. The introduction of the ackdoor i a ke turning point in the invetigation ince it demontrated the threat actor’ reourcefulne and kill-et. At the time of the attack, thee ackdoor were undetected and undocumented   an ecurit vendor. Recentl, Kaperk reearcher identi ed a variant of one of the ackdoor a ackdoor.Win32.Deni . The attacker had to make ure that the remained undetected o the ackdoor were deigned to e a tealth a poile. To avoid eing dicovered, the malware author ued thee technique: ackdoor exploiting DLL hijacking againt truted application The ackdoor exploited a vulnerailit called “ DLL hijacking ” in order to “hide” the malware inide truted oftware. Thi technique exploit a ecurit vulnerailit found in legitimate oftware, which allow the attacker to load a fake DLL and execute it maliciou code. Pleae ee an anali of the ackdoor in the Attacker’ Arenal ection. The attacker exploited thi vulnerailit againt the following truted application: Window earch (vulnerale application: earchindexer.exe /earchprotoclhot.exe) Fake DLL:  mfte.dll (63870536217c8923e856f4138d9caff7e309d)    Google Update  (d30e8c7543adc801d67506853057d75ca13f) Fake DLL : goopdate.dll (9731ca8661e6651114edf291031d4e218f7)     Kaperk’ Avpia (691686839681ad345728806889925dc4edd74e) Fake DLL:  product_info.dll (3cf444c9470f5d0c16996c42a338502a7517)  exploiting legitimate oftware, the attacker paed application whiteliting and legitimate ecurit oftware, allowing them to continue their operation without raiing an upicion. DN Tunneling a C2 channel - In attempt to overcome network  ltering olution, the attacker implemented a tealthier  C2 communication method, uing “ DN Tunneling ” – a method of C2 communicating and data ex ltration uing the DN protocol. To enure that the DN traf c would not e  ltered, the attacker con gured the ackdoor to communicate with Google and OpenDN DN erver, ince mot organization and ecurit product will not  lter traf c to thoe two major DN ervice. The creenhot elow how the traf c generated  the ackdoor and demontrate DN Tunneling for C2 communication. A hown, while the detination IP i “8.8.8.8” – Google’ DN erver – the maliciou domain i “hiding” inide the DN packet:  PHA THR: NOVL M OUTLOOK ACKDOOR AND LATRAL MOVMNT PR In the third phae of the operation, the attacker harveted credential tored on the compromied machine and performed lateral movement and infected new machine. The attacker alo introduced a ver rare and tealth technique  to communicate with their erver and ex ltrate data uing Microoft Outlook. OUTLOOK MACRO ACKDOOR In a relentle attempt to remain undetected, the attacker devied a ver tealth C2 channel that i hard to detect ince it leverage an email-aed C2 channel. The attacker intalled a ackdoor macro in Microoft Outlook  that enaled them to execute command, deplo their tool and teal valuale data from the compromied machine. For a detailed anali of the Outlook ackdoor, pleae ee the Attacker’ Arenal ection. Thi technique work a follow: 1. The maliciou macro can the victim’ Outlook inox and look for the tring “$$cpte” and “$$ecpte” . 2. Then the macro will open a CMD hell that will execute whatever intruction / command i in etween the tring. 3. The macro delete the meage from inox to enure minimal rik of expoure. 4. The macro earche for the pecial tring in the “Deleted Item” folder to  nd the attacker’ email addre and end the data ack to the attacker via email. 5. Latl, the macro will delete an evidence of the email received or ent  the attacker. CRDNTIAL DUMPING AND LATRAL MOVMNT The attacker ued the famou Mimikatz  credential dumping tool a their main tool to otain credential including uer paword, NTLM hahe and Kerero ticket. Mimikatz i a ver popular tool and i detected  mot antiviru vendor and other ecurit product. Therefore, the attacker ued over 10 different cutomized Mimikatz paload, which were ofucated and packed in a wa that allowed them to evade antiviru detection. The following are example of Mimikatz command line argument detected during the attack:    The tolen credential were ued to infect more machine, leveraging Window uilt-in tool a well a pa-the-ticket  and pa-the-hah  attack. PHA FOUR: NW ARNAL AND ATTMPT TO RTOR POWRHLL INFRATRUCTUR After a four week lull and no apparent maliciou activit, the attacker returned to the cene and introduced new and improved tool aimed at paing the ecurit mitigation that were implemented  the compan’ IT team. Thee tool and method mainl allowed them to pa the Powerhell execution retriction and paword dumping mitigation . During that phae, Cereaon found a compromied erver that wa ued a the main attacking machine, where the attacker tored their arenal in a network hare, which made it eaier to pread their tool to other machine on the network. The attacker’ arenal conited: New variant of Deni and Goop ackdoor Powerhell Retriction pa Tool  - Adapted from PUnlock Githu  project. Powerhell Coalt trike eacon -  New paload + new C2 domain Powerhell Ofucator - All the new Powerhell paload are ofucated uing a pulicl availale cript adapted from a Daniel ohannon’ GitHu project. HookPawordChange  - Inpired  tool found on GitHu , thi tool alert the attacker if a paword ha een changed. Uing thi tool, the attacker could overcome a paword reet. The attacker modi ed their tool. Cutomized Window Credential Dumper -  A Powerhell paword dumper that i aed on a known paword dumping tool , uing Powerhell pa and re ective loading. The attacker peci call ued it to otain Outlook paword. Cutomized Outlook Credential Dumper - Inpired  known Outlook credential dumper. Mimikatz -  Powerhell and inar verion, with multiple laer of ofucation. Pleae ee the Attacker’ Arenal ection for detailed anali of the tool. An anali of thi arenal how that the attacker went out of their wa to retore the Powerhell-aed infratructure, even though it had alread een detected and hut down once. The attacker’ preference to ue a  lele infratructure peci call in conjunction with Coalt trike i ver evident. Thi could ugget that the attacker preferred to ue known tool that are more expendale rather than uing their own cutom-uilt tool, which were ued a a lat reort. CONCLUION Operation Coalt Kitt wa a major cer epionage APT that targeted a gloal corporation in Aia and wa carried out  the OceanLotu Group. The anali of thi APT prove how determined and motivated the attacker were. The continuoul changed technique and upgraded their arenal to remain under the radar. In fact, the never gave up, even when the attack wa expoed and hut down  the defender. During the invetigation of Operation Coalt Kitt, Cereaon uncovered and analzed new tool in the OceanLotu Group’ attack arenal, uch a: New ackdoor (“Goop”) uing HTTP and DN Tunneling for C2 communication. Undocumented ackdoor that ued Outlook for C2 communication and data ex ltration. ackdoor exploiting DLL ideloading attack in legitimate application from Microoft, Google and Kaperk. Three cutomized credential dumping tool, which are inpired  known tool. In addition, Cereaon uncovered new variant of the “Deni” ackdoor  and managed to attriute the ackdoor to the OceanLotu Group - a connection that had not een pulicl reported efore. Thi report provide a rare deep dive into a ophiticated APT that wa carried out  one of the mot facinating group operating in Aia. The ailit to cloel monitor and detect the tage of an entire APT lifeccle - from initial in ltration to data ex ltration - i far from trivial. The fact that mot of the attacker’ tool were not detected  the antiviru oftware and other ecurit product deploed in the compan’ environment efore Cereaon, i not urpriing. The attacker ovioul inveted igni cant time and effort in keeping the operation undetected, triving to evade antiviru detection. A the invetigation progreed, ome of the IOC oerved in Operation Coalt Kitt tarted to emerge in the wild, and recentl ome were even reported eing ued in other campaign . It i important to rememer, however, that IOC have a tendenc to change over time. Therefore, undertanding a threat actor’ ehavioral pattern i eential in comatting modern and ophiticated APT. The modu  operandi and tool erved a ehavioral  ngerprint alo plaed an important role in ting Operation Coalt Kitt to the OceanLotu Group. Latl, our reearch provide an important tetimon to the capailitie and working method of the OceanLotu Group. Operation Coalt Kitt i unique in man wa, nonethele, it i till jut one link in the group’ ever-growing chain of APT campaign. Orchetrating multiple APT campaign in parallel and attacking a road pectrum of target take an incredile amount of reource, time, manpower and motivation. Thi comination i likel to e more common among nation-tate actor. While the are man rumour and peculation circulating in the Infoec communit, at the time of writing, there wa no pulicl availale evidence that can con rm that the OceanLotu Group i a nation-tate threat actor. Until uch evidence i made pulic, we will leave it to our reader to judge for themelve. To e continued ... Meow. Learn how to create a cloed-loop ecurit proce to defend againt thi tpe of attack etter. Read how to create a cloed-loop ecurit proce with MITR ATT&CK. HAR  RAD MOR RAD MOR RAD MORCONTINU XPLORING_ Return to Blog AOUT WHO W AR CARR MANAGMNT CONTACTPLATFORM OVRVIW NXT GNRATION ANTIVIRU NDPOINT DTCTION & RPON MANAGD DTCTION & RPONROURC LOG CA TUDI WINAR WHIT PAPR   2019 CYRAON. ALL RIGHT RRVD. TRM OF U   |  PRIVACY POLICYOPRATION OFT CLL: A WORLDWID CAMPAIGN AGAINT TLCOMMUNICATION PROVIDRWHAT I AN ADVANCD PRITNT THRAT (APT)? APT, TH OARD, AND YOU This website uses cookies to ensure you get the best experience on our website. By continuing on our website, you consent to our use of cookies. To find our more about how we use cookies, please see our Privacy Policy . I ACCEPT  "
}