{
    "title": "darkhydrus uses phishery to harvest credentials in the middle east",
    "text": "Tools\nPlaybooks\nSpeaking Events\nAbout Us\nDarkHydrus Uses Phishery to Harvest Credentials\nin the Middle East\n18,359\npeople reacted\n0\n6 min. read\nThis post is also available in: 日本語  (Japanese )\nLast week, Unit 42 released a blog on a newly named threat group called DarkHydrus that we observed targeting\ngovernment entities in the Middle East. The attack that we discussed in our previous publication  involved spear‐\nphishing to deliver a PowerShell payload we call RogueRobin; however, we are aware of DarkHydrus carrying out\na credential harvesting attack in June 2018. It also appears that this an ongoing campaign, as we have evidence of\nprevious credential harvesting attempts using the same infrastructure dating back to the Fall of 2017. These\nattacks were targeting government entities and educational institutions in the Middle East.\nThe credential harvesting attacks used spear‐phishing emails that contained malicious Microsoft Office\ndocuments that leveraged the “attachedTemplate” technique to load a template from a remote server. When\nattempting to load this remote template, Microsoft Office will display an authentication dialog box to ask the user\nto provide login credentials. When entered, these credentials are then sent to the C2 server, which allows\nDarkHydrus to collect the user account credentials.\nBased on Unit 42’s analysis, DarkHydrus used the open‐source Phishery tool  to create two of the known Word\ndocuments used in these credential harvesting attacks. As discussed in our previous blog, this further\nstrengthens DarkHydrus’ use of the open source for their attack tools.\nA phishing attack to steal credentials like this is not new: US‐CERT warned  of the same technique by a different\nthreat group in 2017. What is noteworthy is DarkHydrus’ use of an open‐source tool to carry out targeted\nattacks against these entities in the Middle East, which is fitting of their reliance of open source tools and these\nattacks are consistent in terms of targeting with what we reported last week. Based on this, we can reasonably\npresume this group will continue to carry out attacks against these kinds of targets in the Middle East in the near‐\nfuture.\nCredential Harvesting Attack\nOn June 24, 2018, Unit 42 observed DarkHydrus carrying out a credential harvesting attack on an educational\ninstitution in the Middle East. The attack involved a spear‐phishing email with a subject of “Project Offer” and a\nmalicious Word document (SHA256:\nd393349a4ad00902e3d415b622cf27987a0170a786ca3a1f991a521bff645318) as an attachment. When opened,\nthe malicious Word document displays a dialog box that asks the user for their credentials, as seen in Figure 1.\nFigure 1. Authentication dialog box presented to the user when opening document\nAs you can see in Figure 1, the authentication prompt says “Connecting to <redacted>. 0utl00k[.]net”, which is a\nDarkHydrus C2 server. If the user enters their credentials in this dialog box and presses ‘Ok’, the credentials are\nsent to the C2 server via the URL https://<redacted>.0utl00k[.]net/download/template.docx. With the\nauthentication dialog box gone, Word displays the contents of the document, which in this specific case was an\nempty document. While this document was empty, the authentication prompt may have made the targeted user\nmore likely to enter their credentials, thinking it’s necessary to view the contents of the document.\nDarkHydrus also created their C2 domain carefully in an attempt to further trick the targeted user to enter their\ncredentials. Firstly, the redacted subdomain was the domain of the targeted educational institution. Also, the\n0utl00k[.]net domain resembles Microsoft’s legitimate “outlook.com” domain that provides free email services,\nwhich also make the user less suspicious and more likely to enter their credentials. Some users may not even\nnotice what domain the dialog states they are connecting to and habitually type their Windows credentials.\nWe found two additional Word documents using the 0utl00k[.]net domain to harvest credentials, seen in Table 1.\nWe first saw these related Word documents in September and November 2017, which suggests that\nDarkHydrus has been carrying out this credential harvesting campaign for almost a year.\nFirst Seen SHA256 Filename Remote Template\n11/12/2017 9eac37a5c6.. PasswordHandoverForm.docx https://0utl00k[.]net/docs\n09/18/2017 0b1d5e1744.. ﺍﺳﺗﻁﻼﻉ. docx https://0utl00k[.]net/docs\nTable 1. Additional DarkHydrus Word documents used to steal credentials\nBoth of these related documents use the attachedTemplate technique to steal credentials by sending them to a\nURL https://0utl00k[.]net/docs. Unlike the June 2018 document that displayed no content after credential theft,\nboth of these documents displayed content that appears pertinent to the targeted organization. The September\n2017 document displays an employee survey, which can be seen in Figure 2.\nFigure 2. Employee survey displayed after credential theft\nThe November 2017 document displays a password handover document after credential theft occurs, as seen in\nFigure 3. We were unable to find the displayed document via open source research, which may suggest that the\nactor gathered this password handover form from a prior operation.\nFigure 3. Password handover form displayed after credential theft\nThe infrastructure used in these credential harvesting attacks used the domain 0utl00k[.]net, which at the time of\nthe attacks resolved to 107.175.150[.]113 and 195.154.41[.]150. This same infrastructure was discussed in the\nCampaign Analysis of our previous blog .\nPhishery Tool\nWhile analyzing the three malicious Word documents, we determined that two of the documents were created\nusing an open source tool called Phishery . The Phishery tool is capable of the following:\n1. Creating malicious Word documents by injecting a remote template URL\n2. Hosting a C2 server to gather credentials entered into authentication dialog boxes displayed when attempting\nto obtain the remote template\nWe were able to confirm that DarkHydrus used Phishery to create these Word documents by using the open\nsource tool to create a document and host a C2 ourselves. The DarkHydrus document used in the June 2018\nattacks had a remote template URL added, as seen in Figure 4.\nFigure 4. Remote template URL seen in the DarkHydrus document from June 2018\nWe were able to replicate the remote template path seen in Figure 4 by using Phishery to create a weaponized\ndelivery document. Figure 5 shows Phishery’s output to the command that injects a URL into a file named\n“good_test.docx”, which it will save the resulting file to “bad_test.docx”.\nFigure 5. Phishery command used to create a document that has same remote template URL as DarkHydrus\nTo confirm, we used Phishery’s C2 server and opened DarkHydrus’ Word document from the June 2018 attacks.\nWhen presented with the authentication dialog box, we entered “fakename” and “fakepass” as credentials, as\nseen in Figure 6 and pressed enter.\nFigure 6. Authentication dialog box with fake credentials entered\nOn the C2 server, we observed Phishery receiving the inbound request and capturing the credentials, as seen in\nFigure 7. The C2 server was able to obtain the “fakename” and “fakepass” credentials entered into the\nauthentication dialog box displayed when opening DarkHydrus’ Word document.\nFigure 7. Output of Phishery C2 showing captured credentials\nConclusion\nDarkHydrus is a threat group carrying out attack campaigns targeting organizations in the Middle East. We\ndiscovered DarkHydrus carrying out credential harvesting attacks that use weaponized Word documents, which\nthey delivered via spear‐phishing emails to entities within government and educational institutions. This threat\ngroup not only used the Phishery tool to create these malicious Word documents, but also to host the C2 server\nto harvest credentials. The use of Phishery further shows Dark Hydrus’ reliance on open source tools to conduct\ntheir operations.\nPalo Alto Networks customers are protected from Dark Hydrus by:\nThe C2 server 0utl00k[.]net  is classified as Malware\nAll Phishery documents created by DarkHydrus have malicious verdicts in WildFire\nAutoFocus customers can monitor this threat group’s activity via the DarkHydrus  tag\nIndicators of Compromise\nSamples\nd393349a4ad00902e3d415b622cf27987a0170a786ca3a1f991a521bff645318\n9eac37a5c675cd1750cd50b01fc05085ce0092a19ba97026292a60b11b45bf49\n0b1d5e17443f0896c959d22fa15dadcae5ab083a35b3ff6cb48c7f967649ec82\nInfrastructure\n0utl00k[.]net\n107.175.150[.]113\n195.154.41[.]150\nGet updates from Palo Alto  Networks!\nSign up to receive the latest news, cyber threat intelligence and research from us\nBy Robert Falcone\nAugust 7, 2018 at 5:00 AM\nCategory: Unit 42\nTags: DarkHydrus , Phishery\nEmail address\nSubscribe\nI'm not a robot\nreCAPTCHA\nPrivacy  - Terms\nBy submitting this form, you agree to our Terms of Use  and acknowledge\nour Privacy Statement .\n© 2020 Palo Alto Networks, Inc. All rights reserved.\nPopular Resources\nResource Center\nBlog\nCommunities\nTech Docs\nUnit 42\nSitemap\nLegal No ces\nPrivacy\nTerms of Use\nDocuments\nAccount\nManage Subscriptions\nReport a Vulnerability\nSearch Unit 42\nSHARE \n "
}