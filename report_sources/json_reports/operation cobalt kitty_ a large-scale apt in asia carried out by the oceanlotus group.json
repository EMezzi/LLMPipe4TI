{
    "title": "operation cobalt kitty_ a large-scale apt in asia carried out by the oceanlotus group",
    "text": "UCRI FOR UPDAT\nmail UCRI\n  \nDued Operation Coalt Kitt, the APT targeted a gloal corporation aed in Aia with the goal of tealing\nproprietar uine information. The threat actor targeted the compan’ top-level management \nuing pear-phihing attack a the initial penetration vector, ultimatel compromiing the computer of\nvice preident, enior director and other ke peronnel in the operational department. During\nOperation Coalt Kitt, the attacker compromied more than 40 PC and erver, including the domain\ncontroller,  le erver, We application erver and dataae erver.\nWant to hear aout another high-impact operation? \nIGN UP FOR TH OPRATION OFT CLL WINAR\nForenic artifact revealed that the attacker perited on the network for at leat a ear efore\nCereaon wa deploed. The adverar proved ver adaptive and reponded to compan’ ecurit\nmeaure  periodicall changing tool, technique and procedure (TTP), allowing them to perit on\nthe network for uch an extenive period of time. Over 80 paload and numerou domain were oerved\nin thi operation - all of which were undetected  traditional ecurit product deploed in the compan’\nenvironment at the time of the attack.\nThe attacker arenal conited of modi ed pulicl-availale tool a well a ix undocumented cutom-\nuilt tool, which Cereaon conider the threat actor’ ignature tool. Among thee tool are two\nackdoor that exploited DLL ideloading attack in Microoft, Google and Kaperk application. In\naddition, the developed a novel and tealth ackdoor that target Microoft Outlook for command-and-\ncontrol channel and data ex ltration.\naed on the tool, modu operandi and IOC (indicator of compromie) oerved in Operation Coalt\nKitt,  Cereaon attriute thi large-cale cer epionage APT to the “ OceanLotu Group ” (which i\nalo known a, APT-C-00 , eaLotu and APT32). For detailed information ting Operation Coalt Kitt to the\nOceanLotu Group, pleae ee our Attacker’ Arenal and Threat Actor Pro le ection.\nCereaon alo attriute the recentl reported ackdoor.Win32.Deni  to the OceanLotu Group, which\nat the time of thi report’ writing, had not een of ciall linked to thi threat actor.\nFinall, thi report offer a rare glimpe into what a cer epionage APT look like \"under-the-hood\".\nCereaon wa ale to monitor and detect the entire attack lifeccle, from in ltration to ex ltration and all\nthe tep in etween.\nOur report contain the following detailed ection (PDF):\nCoalt Kitt Lifeccle: A tep--tep anali\nCoalt Kitt Attacker’ Arenal: Deep dive into the tool ued in the APT\nCoalt Kitt Threat Actor Pro le and Indicator of Compromie\nHIGH-LVL ATTACK OUTLIN:  A CAT-AND-MOU\nGAM IN FOUR ACT\nThe following ection outline the four phae of the attack a oerved  Cereaon’ analt, who\nwere called to invetigate the environment after the compan’ IT department upected that their\nnetwork wa reached ut could not trace the ource.\nPHA ON: FILL OPRATION (POWRHLL\nAND COALT TRIK PAYLOAD)\naed on the forenic evidence collected from the environment, phae one wa the continuation of the\noriginal attack that egan aout a ear efore Cereaon wa deploed in the environment. During that\nphae, the threat actor operated a  lele Powerhell-aed infratructure, uing cutomized\nPowerhell paload taken from known offenive framework uch a Coalt trike , Powerploit  and\nNihang .\nThe initial penetration vector wa carried out  ocial engineering. Carefull elected group of emploee\nreceived pear-phihing email, containing either link to maliciou ite or weaponized Word\ndocument. Thee document contained maliciou macro that created peritence on the compromied\nmachine uing two cheduled tak, whoe purpoe wa to download econdar paload (mainl Coalt\ntrike eacon):\nMAY 24, 2017\n9 min read \n Written by:\nASSAF DAHANOPERATION COBALT KITTY: A LARGE-SCALE APT IN ASIA CARRIED\nOUT BY THE OCEANLOTUS GROUP\n cheduled tak 1:  Download a COM criptlet that redirect to Coalt trike paload:\ncheduled tak 2:  Ue Javacript to download a Coalt trike eacon:\nee more detailed anali of the maliciou document in our Attack Life Ccle ection.\nFILL PAYLOAD DLIVRY INFRATRUCTUR\nIn the  rt phae of the attack, the attacker ued a  lele in-memor paload deliver infratructure\nconiting of the following component:\n1. V and Powerhell-aed loader\nThe attacker dropped Viual aic and Powerhell cript in folder that the created under the\nProgramData (a hidden folder,  default). The attacker created peritence uing Window’ regitr,\nervice and cheduled tak. Thi peritence mechanim enured that the loader cript would execute\neither at tartup or at predetermined interval.\nValue found in Window’ Regitr: the V cript are executed  Window’ Wcript at tartup:\nThe .v cript a well a the .txt  le contain the loader’ cript, which launche Powerhell with a\nae64 encoded command, which either load another Powerhell cript (e.g Coalt trike eacon) or\nfetche a paload from the command-and-control (C&C) erver:\n2. In-memor  lele paload from C&C erver\nThe paload erved  the C&C erver are motl Powerhell cript with emedded ae64-encoded\npaload (Metaploit and Coalt trike paload):\nxample 1:  Powerhell paload with emedded hellcode downloading Coalt trike eacon\nThe decoded paload i a hellcode, whoe purpoe i to retrieve a Coalt trike eacon from the C&C\nerver:\n xample 2: Coalt trike eacon emedded in ofucated Powerhell\nA econd tpe of an ofucated Powerhell paload conited of Coalt trike’ eacon paload:\nLe than 48 hour after Cereaon alerted the compan aout the reach , the attacker tarted to change\ntheir approach and almot completel aandoned the Powerhell infratructure that the had een uing\n- replacing it with ophiticated cutom-uilt ackdoor. The attacker’ remarkale ailit to quickl adapt\ndemontrated their kill and familiarit with and command of the compan’ network and it operation.\nThe attacker mot likel replaced the Powerhell infratructure after the compan ued oth Window\nGroup Polic Oject (GPO) and Cereaon’ execution prevention feature to prevent Powerhell\nexecution.\nPHA TWO: ACKDOOR XPLOITING DLL-\nHIJACKING AND UING DN TUNNLING\nAfter realizing that the Powerhell infratructure had een dicovered, the attacker had to quickl\nreplace it to maintain peritence and continue the operation. Replacing thi infratructure in 48 hour\nugget that the threat actor were prepared for uch a cenario.\nDuring the econd phae of the attack, the attacker introduced two ophiticated ackdoor that the\nattempted to deplo on elected target. The introduction of the ackdoor i a ke turning point in the\ninvetigation ince it demontrated the threat actor’ reourcefulne and kill-et.\nAt the time of the attack, thee ackdoor were undetected and undocumented   an ecurit vendor.\nRecentl, Kaperk reearcher identi ed a variant of one of the ackdoor a ackdoor.Win32.Deni . The\nattacker had to make ure that the remained undetected o the ackdoor were deigned to e a\ntealth a poile. To avoid eing dicovered, the malware author ued thee technique:\nackdoor exploiting DLL hijacking againt truted application\nThe ackdoor exploited a vulnerailit called “ DLL hijacking ” in order to “hide” the malware inide truted\noftware. Thi technique exploit a ecurit vulnerailit found in legitimate oftware, which allow the\nattacker to load a fake DLL and execute it maliciou code.\nPleae ee an anali of the ackdoor in the Attacker’ Arenal ection.\nThe attacker exploited thi vulnerailit againt the following truted application:\nWindow earch (vulnerale application: earchindexer.exe /earchprotoclhot.exe)\nFake DLL:  mfte.dll (63870536217c8923e856f4138d9caff7e309d)\n  \nGoogle Update  (d30e8c7543adc801d67506853057d75ca13f)\nFake DLL : goopdate.dll (9731ca8661e6651114edf291031d4e218f7)\n \n \nKaperk’ Avpia (691686839681ad345728806889925dc4edd74e)\nFake DLL:  product_info.dll (3cf444c9470f5d0c16996c42a338502a7517)\n exploiting legitimate oftware, the attacker paed application whiteliting and legitimate ecurit\noftware, allowing them to continue their operation without raiing an upicion.\nDN Tunneling a C2 channel -\nIn attempt to overcome network  ltering olution, the attacker implemented a tealthier  C2\ncommunication method, uing “ DN Tunneling ” – a method of C2 communicating and data ex ltration\nuing the DN protocol. To enure that the DN traf c would not e  ltered, the attacker con gured the\nackdoor to communicate with Google and OpenDN DN erver, ince mot organization and ecurit\nproduct will not  lter traf c to thoe two major DN ervice.\nThe creenhot elow how the traf c generated  the ackdoor and demontrate DN Tunneling for\nC2 communication. A hown, while the detination IP i “8.8.8.8” – Google’ DN erver – the maliciou\ndomain i “hiding” inide the DN packet:\n PHA THR: NOVL M OUTLOOK ACKDOOR\nAND LATRAL MOVMNT PR\nIn the third phae of the operation, the attacker harveted credential tored on the compromied\nmachine and performed lateral movement and infected new machine. The attacker alo introduced a\nver rare and tealth technique  to communicate with their erver and ex ltrate data uing Microoft\nOutlook.\nOUTLOOK MACRO ACKDOOR\nIn a relentle attempt to remain undetected, the attacker devied a ver tealth C2 channel that i hard\nto detect ince it leverage an email-aed C2 channel. The attacker intalled a ackdoor macro in\nMicrooft Outlook  that enaled them to execute command, deplo their tool and teal valuale data from\nthe compromied machine.\nFor a detailed anali of the Outlook ackdoor, pleae ee the Attacker’ Arenal ection.\nThi technique work a follow:\n1. The maliciou macro can the victim’ Outlook inox and look for the tring “$$cpte” and\n“$$ecpte” .\n2. Then the macro will open a CMD hell that will execute whatever intruction / command i in\netween the tring.\n3. The macro delete the meage from inox to enure minimal rik of expoure.\n4. The macro earche for the pecial tring in the “Deleted Item” folder to  nd the attacker’\nemail addre and end the data ack to the attacker via email.\n5. Latl, the macro will delete an evidence of the email received or ent  the attacker.\nCRDNTIAL DUMPING AND LATRAL MOVMNT\nThe attacker ued the famou Mimikatz  credential dumping tool a their main tool to otain credential\nincluding uer paword, NTLM hahe and Kerero ticket. Mimikatz i a ver popular tool and i\ndetected  mot antiviru vendor and other ecurit product. Therefore, the attacker ued over 10\ndifferent cutomized Mimikatz paload, which were ofucated and packed in a wa that allowed them to\nevade antiviru detection.\nThe following are example of Mimikatz command line argument detected during the attack:  \n The tolen credential were ued to infect more machine, leveraging Window uilt-in tool a well a\npa-the-ticket  and pa-the-hah  attack.\nPHA FOUR: NW ARNAL AND ATTMPT TO\nRTOR POWRHLL INFRATRUCTUR\nAfter a four week lull and no apparent maliciou activit, the attacker returned to the cene and introduced\nnew and improved tool aimed at paing the ecurit mitigation that were implemented  the\ncompan’ IT team. Thee tool and method mainl allowed them to pa the Powerhell execution\nretriction and paword dumping mitigation .\nDuring that phae, Cereaon found a compromied erver that wa ued a the main attacking machine,\nwhere the attacker tored their arenal in a network hare, which made it eaier to pread their tool to\nother machine on the network. The attacker’ arenal conited:\nNew variant of Deni and Goop ackdoor\nPowerhell Retriction pa Tool  - Adapted from PUnlock Githu  project.\nPowerhell Coalt trike eacon -  New paload + new C2 domain\nPowerhell Ofucator - All the new Powerhell paload are ofucated uing a pulicl\navailale cript adapted from a Daniel ohannon’ GitHu project.\nHookPawordChange  - Inpired  tool found on GitHu , thi tool alert the attacker if a\npaword ha een changed. Uing thi tool, the attacker could overcome a paword reet.\nThe attacker modi ed their tool.\nCutomized Window Credential Dumper -  A Powerhell paword dumper that i aed on a\nknown paword dumping tool , uing Powerhell pa and re ective loading. The\nattacker peci call ued it to otain Outlook paword.\nCutomized Outlook Credential Dumper - Inpired  known Outlook credential dumper.\nMimikatz -  Powerhell and inar verion, with multiple laer of ofucation.\nPleae ee the Attacker’ Arenal ection for detailed anali of the tool.\nAn anali of thi arenal how that the attacker went out of their wa to retore the Powerhell-aed\ninfratructure, even though it had alread een detected and hut down once. The attacker’ preference to\nue a  lele infratructure peci call in conjunction with Coalt trike i ver evident. Thi could\nugget that the attacker preferred to ue known tool that are more expendale rather than uing their\nown cutom-uilt tool, which were ued a a lat reort.\nCONCLUION\nOperation Coalt Kitt wa a major cer epionage APT that targeted a gloal corporation in Aia and wa\ncarried out  the OceanLotu Group. The anali of thi APT prove how determined and motivated the\nattacker were. The continuoul changed technique and upgraded their arenal to remain under the\nradar. In fact, the never gave up, even when the attack wa expoed and hut down  the defender.\nDuring the invetigation of Operation Coalt Kitt, Cereaon uncovered and analzed new tool in the\nOceanLotu Group’ attack arenal, uch a:\nNew ackdoor (“Goop”) uing HTTP and DN Tunneling for C2 communication.\nUndocumented ackdoor that ued Outlook for C2 communication and data ex ltration.\nackdoor exploiting DLL ideloading attack in legitimate application from Microoft,\nGoogle and Kaperk.\nThree cutomized credential dumping tool, which are inpired  known tool.\nIn addition, Cereaon uncovered new variant of the “Deni” ackdoor  and managed to attriute the\nackdoor to the OceanLotu Group - a connection that had not een pulicl reported efore.\nThi report provide a rare deep dive into a ophiticated APT that wa carried out  one of the mot\nfacinating group operating in Aia. The ailit to cloel monitor and detect the tage of an entire APT\nlifeccle - from initial in ltration to data ex ltration - i far from trivial.\nThe fact that mot of the attacker’ tool were not detected  the antiviru oftware and other ecurit\nproduct deploed in the compan’ environment efore Cereaon, i not urpriing. The attacker\novioul inveted igni cant time and effort in keeping the operation undetected, triving to evade\nantiviru detection.\nA the invetigation progreed, ome of the IOC oerved in Operation Coalt Kitt tarted to emerge in\nthe wild, and recentl ome were even reported eing ued in other campaign . It i important to\nrememer, however, that IOC have a tendenc to change over time. Therefore, undertanding a threat\nactor’ ehavioral pattern i eential in comatting modern and ophiticated APT. The modu\n operandi and tool erved a ehavioral  ngerprint alo plaed an important role in ting Operation\nCoalt Kitt to the OceanLotu Group.\nLatl, our reearch provide an important tetimon to the capailitie and working method of the\nOceanLotu Group. Operation Coalt Kitt i unique in man wa, nonethele, it i till jut one link in the\ngroup’ ever-growing chain of APT campaign. Orchetrating multiple APT campaign in parallel and\nattacking a road pectrum of target take an incredile amount of reource, time, manpower and\nmotivation. Thi comination i likel to e more common among nation-tate actor. While the are man\nrumour and peculation circulating in the Infoec communit, at the time of writing, there wa no\npulicl availale evidence that can con rm that the OceanLotu Group i a nation-tate threat actor.\nUntil uch evidence i made pulic, we will leave it to our reader to judge for themelve.\nTo e continued ... Meow.\nLearn how to create a cloed-loop ecurit proce to defend againt thi tpe of attack etter. Read how to\ncreate a cloed-loop ecurit proce with MITR ATT&CK.\nHAR \nRAD MOR RAD MOR RAD MORCONTINU XPLORING_\nReturn to Blog\nAOUT\nWHO W AR\nCARR\nMANAGMNT\nCONTACTPLATFORM\nOVRVIW\nNXT GNRATION ANTIVIRU\nNDPOINT DTCTION & RPON\nMANAGD DTCTION & RPONROURC\nLOG\nCA TUDI\nWINAR\nWHIT PAPR\n ©2019 CYRAON. ALL RIGHT RRVD. TRM OF U   |  PRIVACY POLICYOPRATION OFT CLL: A\nWORLDWID CAMPAIGN AGAINT\nTLCOMMUNICATION PROVIDRWHAT I AN ADVANCD PRITNT\nTHRAT (APT)? APT, TH OARD, AND YOU\nThis website uses cookies to ensure you get the best experience on our website. By continuing on our website, you consent to our use of cookies. To find\nour more about how we use cookies, please see our Privacy Policy . I ACCEPT\n "
}