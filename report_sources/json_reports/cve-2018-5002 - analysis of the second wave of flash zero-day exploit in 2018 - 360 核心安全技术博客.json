{
    "title": "cve-2018-5002 - analysis of the second wave of flash zero-day exploit in 2018 - 360 核心安全技术博客",
    "text": "Comments\n© 2020 -  360 核心安全技术博客   - blogs.360.cn  \nPowered by ThinkJS  & FireKylin 1.3.1文章目录\nBackground\nVulnerability Analysis\nAttack Procedure\nVulnerability Root Cause Analysis\nCorrelation\nConclusion\n分享到：\n 新浪微博\n 微信\n Twitter\n 印象笔记\n QQ好友\n 有道云笔记CVE-2018-5002 - Analysis of the Second Wave of Flash Zero-day\nExploit in 2018\nBackground\nOn June 1, 2018, the Advanced Threat Response Team of 360 Core Security discovered an attack using a new\nFlash 0-day vulnerability on a global scale. The hackers carefully constructed an Office document that remotely\nloaded Flash vulnerability. When the document was opened, all the exploit code and malicious payload were\ndelivered through remote servers. This attack mainly targets the Middle East. This vulnerability is the second Flash\n0-day vulnerability discovered in 2018 and is currently affecting Adobe Flash Player 29.0.0.171 and below\nversions.\nVulnerability Analysis\nThe sample has a very appealing file name: salary.xlsx , whose content is also consistent with the title. The file is in Arabic and shows salaries\nfor various time periods. The content of salary.xlsx (MD5: **517277fb0dbb4bbf724245e663) is complete, but here we only revealed a part of it:\nThe hacker embeds a remote Flash file link through the ActiveX control and data. The related exploit code is controlled and delivered by the remote server.\nAttack Procedure\nAfter running the xlsx, the malicious SWF (Shock Wave File) file (MD5: **66491a5c5cd7423849f32b58f5) is downloaded from the remote C&C server\n(C&C:people.doha .com) for execution. The SWF file will request the server again to download encrypted data and decryption keys. The\ndecrypted SWF (md5: ** e78116bebfa1780736d343c9eb) is the Flash 0day exploit. After the vulnerability is triggered, it requests the remote server to\ndownload a malicious shell and execute it. During the real-time analysis, we found that the attacker had closed Trojan payload which is expected to be\ndelivered in the final phase.\nThe following picture shows different phases of the attack:\nVulnerability Root Cause Analysis\nThe vulnerability Flash code is highly obfuscated. After debugging and analysis, we located the 0-day vulnerability code in the attack sample.\nAfter the restoration of the main code is as follows:\nFlash will use the interpreter to handle Static-init methods. The interpreter handles the try catch statement does not correctly handle the exception, and this\nwill make li8 (123456) instruction caught by the catch block when it triggers the exception. Because Flash assumes that it is impossible to execute to the\ncatch block when processing the try catch statement, it does not check the bytecode in the catch block. The attacker uses the getlocal, setlocal instruction\nin the catch block to read and write arbitrary addresses on the stack. In this wild used 0 day, the attacker switches the vulnerability to a type obfuscation\nproblem by exchanging two object pointers on the stack and finally completes the attack. To further debug the attack code, we can see that the localcount of\nfunction in the exploited bytecode is 2, while in the catch block getlocal, setlocal has manipulated the data at locations 448 and 498.\nLet’s observe setlocal operation stack data. The value of ecx is the pointer of the class5 object, and 068fc1a0 is the pointer of class7.\nAfter exchanging the pointers of two objects, the attacker checks whether the exploited is successful by comparing the values of the object members.\nCorrelation\nThe C&C for the vulnerability attack is people.doha *.com, and the corresponding IP address is .145.128.57 . The WHOIS information from this domain\nname shows that the domain registration time is 2018-02-18, indicating that the attacker started preparing for the attack in February this year. When\ndirectly access to people.doha .com, the visits will be forced redirected to https://people ..com/ /, a Qatar Airways staff introduction homepage.\nPeople. .com is a job search site in the Middle East. The C&C used by the attackers just has one more doha (Doha). It was obvious that there was an\nintention of disguising the domain name for phishing. Therefore, we boldly suspected that the targeted region is Doha, Qatar.\nConclusion\nThrough analysis, we can see that the attack used a 0-day vulnerability regardless of the cost. The attacker developed sophisticated plans in the cloud and\nspent at least three months preparing for the attack. The detailed phishing attack content was also tailored to the attack target. All clues show this is a\ntypical APT attack. We suggest all relevant organizations and users to update their Flash to the latest versions in a timely manner. We also strongly\nrecommend using 360 ​​SafeGuard to protect your devices against possible threats.\n本文链接： http://blogs.360.cn/post/cve-2018-5002-en.html\n-- EOF --\n作者 heliosteam  发表于  2018-06-07 12:29:59  ，添加在分类  Threat Intelligence  Vulnerability Analysis  下 ，最后修改于  2018-08-24 08:39:2706月07, 2018\n« CVE-2018-5002---2018 年第二波 Flash零日漏洞在野攻击分析预警 蓝宝菇  - 核危机行动揭秘  »\n360 核心安全技术博客\n  主页 Home\n  归档 Archive\n  分类 Category\n  关于 About\n   \n "
}