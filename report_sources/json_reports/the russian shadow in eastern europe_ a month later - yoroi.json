{
    "title": "the russian shadow in eastern europe_ a month later - yoroi",
    "text": "Privacy  - Terms\nFigure 1.\nMalicious\ne-mail \nFigure 3.\nLow AV\ndetection\nof SFX\nmalware\nFigure\n4.\nContent\nof SFX\nFigure 7.\nExecution of\n“winupd.exe ”\n(SFX) and\nrelative\npassword\n(uyjqystgblfhs)\nFigure 11.\nPOST\nrequest\nsent to C2\nwith victim\nmachine\ninformation\nThe Russian Shadow in Eastern Europe: A Month Later\nIntroduction\nThe Gamaredon attacks against Ukraine doesn't seem to have stopped. After a month since our last report  we spotted a new suspicious email\npotentially linked to the Gamaredon group. The group was first discovered by Symantec and TrendMicro  in 2015 but evidence of its activities\nhas been dated back to 2013. During recent times, Gamaredon is targeting the Ukrainian military and law enforcement sectors too, as officially\nstated by the CERT-UA.\nCybaze-Yoroi ZLAB team dissected the artifact recovered from their latest attack to figure out evolution or changes in the threat actor TTPs.\nTechnical Analysis\nThe infection chain is composed by different stages of password protected SFX (self extracting archive),\neach containing vbs or batch scripts.\nAt the final stage of this malicious chain, we found a customized version of UltraVNC, a well known off-\nthe-shelf tool for remote administration, modified by the Group and configured to connect to their\ncommand and control infrastructure. Despite its apparent triviality, the Matryoshka of SFX archives\nreached a low detection rate, making it effective.\nStage 1\nHash 5555a3292bc6b6e7cb61bc8748b21c475b560635d8b0cc9686b319736c1d828e\nThreat Gamaredon Pteranodon implant\nBrief Description SFX file\nSsdeep 24576:PXwOrRsTyuURQFsVhIe74lpyevrM4vZxn6k1gQ Guo:PgwRAyuURQ2/1YpyeT7ok8\nTable 1. Information about initial SFX file\nThe mail attachment is a RAR archive containing a folder named “ suspected ” in Ukrainan and a single suspicious file with “.scr” extension. At\nfirst glance, it is possible to notice the PowerPoint icon associated to the file, normally not belonging to .scr files.\nFigure 2.\nContent\nof\nmalicious\ne-mail\nThe file has a very low detection rate on VirusTotal platform: only four AV engines are able to identify it as malicious and\nonly on engine understands it may be associated to the Gamaredon implant.\nAfter a quick analysis, the real nature of the .scr file emerges: it is a Self Extracting Archive containing all the files in Figure\n4.\nThey are extracted into “%TEMP%\\7ZipSfx.000\\”  and the first command to be executed is “15003.cmd” , which firstly checks\nfor the presence of malware analysis tools. If it detects the presence of Wireshark or Procexp tools, it kill itself. Otherwise, it\ncopies:\nthe “11439” file in “%USERNAME%\\winupd.exe”\nthe “28509” file in “%APPDATA%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\winupd.lnk” pointing\nto the previous executable and granting persistence to machine reboot\nthe “20261” file in “%TEMP%\\7ZipSfx.000\\Document.docx”\nFigure 5.\nScript\ncontent in\n “15003.cmd ”\nfile\nAt the same time, the extracted document will be shown in order to divert the user attention and to continue the infection unnoticed. This\ndocument, written in Ukraine language, contains information about a criminal charge.\nFigure 6.\nFake\ndocument\nto divert\nattention\non\nmalware\nexecution\nInstead, exploring the LNK file is possible to see it's able to start the “ winupd.exe ” file, with a\nparticular parameter: %USERPROFILE%\\winupd.exe -puyjqystgblfhs. This behavior indicates the\n“winupd.exe” executable is another Self Extracting Archive, but this time it is password protected.\nStage 2\nHash fd59b1a991df0a9abf75470aad6e2fcd67c070bfccde9b4304301bc4992f678e\nThreat Gamaredon Pteranodon implant\nBrief Description SFX file\nSsdeep 24576:bGKUQ8Lj7S6Jr1ye4SM4vzxn3k1jQ GujR:biJr1yeNxJkro\nTable 2. Information about second SFX file\nWhen launched, it extracts its content in “%TEMP%\\RarSFX0\\”, then executes the “setup.vbs” script, which contains only two code lines. So,\nthe execution flow moves on “1106.cmd”.\nFigure 8.\nContent of\n“setup.vbs ”\nscript\nFigure 9. Content of\n“%APPDATA%\\Local\\Temp\\RarSFX0”\nafter “ winupd.exe ” (SFX) extraction\nThe source code of “1106.cmd” is full of junk instructions. However, in the end it performs a simple action: it writes a new VBS script in\n“%APPDATA%\\Microsoft\\SystemCertificates\\My\\Certificates\\”  . This script tries to download another malicious file from\n“http://bitvers.ddns[.net/ {USERNAME}/{DATE}/index.html ”.  Performing many researches abot this server we noticed the continuously\nmodification of associated records. Indeed, the attacker has changed many time the domain names in the latest period. Moreover, querying\nthe services behind the latest associated DNS record the host responds with “403 Forbidden” message too, indicating the infrastructure may\nstill be operative.\nFigure 10.\nInformation\nabout C2\nand relative\nDNS\nThe scripts creates a new scheduled task in order to periodically execute (every 20 mins) the previous VBS script.\nAlso, it collects all the information about the victim’s system using the legit “systeminfo”\nMicrosoft tool and sends them to the remote server through a POST request using the\n“MicrosoftCreate.exe” file, which actually is the legit “wget” utility. The response body will\ncontain a new executable file, named “jasfix.exe”, representing the new stage.\nStage 3\nHash c479d82a010884a8fde0d9dcfdf92ba9b5f4125fac1d26a2e36549d8b6b4d205\nThreat Gamaredon Pteranodon implant\nBrief Description SFX file\nSsdeep 24576:Gfxwgmyg5EOJ+IIpBz2GAROm560XVEC1Ng MdfaQbhUfEIg+m:GJpgIdPzeRBJVEC1CMd\nTable 3. Information about third SFX file\nAfter few researches, we were able to retrieve the “jasfix.exe” file, the next stage of the infection chain. After downloading it, we notice that it\nis another SFX archive other files.\nFigure 12.\nContent of\n“jasfix.exe ”\n(SFX)\ndownloaded\nfrom the C2\nThe first file to be executed is “20387.cmd” that renames the “win.jpg”  into “win.exe” , another password protected SFX.\nStage 4\nHash 28eff088a729874a611ca4781a45b070b46302e494bc0dd53cbaf598da9a6773\nThreat Gamaredon Pteranodon implant\nBrief Description SFX file\nSsdeep 24576:9GKUQ8vCTAaaJVssTk3OwO+vl+3yt6Xf IAR:9vaJes2Ocl7t9S\nTable 4. Information about fourth SFX file\nThis latest SFX archive follows the typical pattern of the Gamaredon archives Matryoshka, where the “ .cmd” file is in designed to decrypt and\nrun next stage. This time using the string “ gblfhs ” as password.\nFigure 13.\nScript to\nrename\n“win.jpg”\ninto\n“win.exe”,\ndecrypt\nand run\nnext\nstage\nFigure 14.\nContent\nof\n“win.exe”\n(last SFX\nof\ninfection)\nHowever, the file named “ win32.sys ” is particularly interesting: it actually is a PE32 executable file. Exploring the “. rsrc” section of the PE32\nexecutable, we noticed different “ .class ” files. Two of them are named “ VncCanvas ” and “ VncViewer ”. These files are part of a legit Remote\nAdministration Tool (RAT) named UltraVNC, available at this link.\nFigure 15.\nContent of\n“win32.sys”\nThe “ win.exe ” SFX archive contains other interesting files too: one of them is an “ .ini” configuration file containing all the parameters and the\npassword used by the UltraVNC tool.\nFigure 16.\nConfiguration\nfile used by\n“win32.sys”\n(Custom\nultraVNC)\nFinally, the RAT tries to establish a connection to the “ torrent-vnc[.ddns[.net ” domain, headed to an endpoint reachable on 195.88.208.51, a\nVPS hosted by the Russian provider IPServer.\nFigure\n17. C2\nand\nrelative\nport\nused\nby RAT\nConclusion\nThis recent attack campaign shows the Gamaredon operation are still ongoing and confirms the potential Russian interest about infiltrating\nthe East European ecosystem, especially the Ukranian one. The techniques and the infection patterns the Group is using is extremely similar\nto the other attacks spotted in the past months of 2019, showing the Matryoshka structure to chain SFX archives, typical of their implant, but\nstill effective and not easily detectable by several antivirus engines.\nAlso, digging into this infection chain, we noticed the come back of third party RATs as payload, a Gamaredon old habit that the usage of the\ncustom-made Pterodo backdoor replaced few times ago.\nIndicators of Compromise\nHashes\n601d85c0236f8d3a82fecf353adb106fac23f1681ef866783ff6e634538c9ce0\n566f495f334cbf4bf019d9ad58636ad0839eadce8d9e5e3fd78deececbcb6fdc\n5555a3292bc6b6e7cb61bc8748b21c475b560635d8b0cc9686b319736c1d828e\n3ed4ba91886309f8c25a9d2c052effab37193ffbb1dbbf29cbd1e9b7e9691514\nfd59b1a991df0a9abf75470aad6e2fcd67c070bfccde9b4304301bc4992f678e\nf53bb852e0721e623f55a63e325db1c13c4eddad2a8d6743f358430dfcbe9c23\nb511e05100b3a4f3515c5526d2dc3c873f66384225c174c65931744d9e682dc0\n45a4db08585ae8148fc1f23644b04e431e2b945f285797e235002f2a41c04462\nddd5b5ca4c0816d9983cb200a55a345a5dbe005e38642d088f05bb137174828a\na48ad33695a44de887bba8f2f3174fd8fb01a46a19e3ec9078b0118647ccf599 (WGET)\n774925ca3134dabfa57c548c11080fc383c9ed89af8cdc11e6caab5a25fc9564\nc479d82a010884a8fde0d9dcfdf92ba9b5f4125fac1d26a2e36549d8b6b4d205\n57b094d0ad345a2654843bed9fdcd2af3f1d9f5d567919f5cb78d9e547093f23\n28eff088a729874a611ca4781a45b070b46302e494bc0dd53cbaf598da9a6773\nd8a01f69840c07ace6ae33e2f76e832c22d4513c07e252b6730b6de51c2e4385\n99c9440a84cdc428ce140de901452eb334faec49f1f6258acdde1ddcbb34376e\nef0f0e80e5e1fae63b946f87d571fac8646e6ba90995536c08cd20d2e40da18e\ncedbbbc4deb6569c23aa20ac64ad1c2b2bef6f7b3405cef861f26a0b44d836d9\nURL\nmy-certificates[.ddns[.net\nbitvers[.ddns[.net\ntorrent-vnc[.ddns[.net:5612\nComponents\n%TEMP%\\RarSFX0\\11060.cmd\n%TEMP%\\RarSFX0\\jasfix.exe\n%TEMP%\\RarSFX0\\MicrosoftCreate.exe\n%TEMP%\\RarSFX0\\NnDBzUE\n%TEMP%\\RarSFX0\\setup.vbs\n%TEMP%\\7ZipSfx.000\\11439\n%TEMP%\\7ZipSfx.000\\15003.cmd\n%TEMP%\\7ZipSfx.000\\20261\n%TEMP%\\7ZipSfx.000\\28509\n%TEMP%\\7ZipSfx.000\\Document.docx\n%USERNAME%\\winupd.exe\n%APPDATA%\\Microsoft\\SystemCertificates\\My\\Certificates\\{filename}.vbs\n%APPDATA%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\winupd.lnk\n%TEMP%\\RarSFX0\\win\\32.sys\nIP\n195.62.52.119\nYara Rules\nrule GamaredonPteranodon_SFX {\nmeta:\n     description = \"Yara Rule for Pteranodon implant Family\"\n     author = \"ZLAB Yoroi - Cybaze\"\n     last_updated = \"2019-04-19\"\n     tlp = \"white\"\n     category = \"informational\"\n   strings:\n      $s1 = \"SFX module - Copyright (c) 2005-2012 Oleg Scherbakov\"\n      $s2 = \"7-Zip archiver - Copyright (c) 1999-2011 Igor Pavlov\" \n      $s3 = \"RunProgram=\\\"hidcon\" \n      $s4 = \"7-Zip - Copyright (c) 1999-2011 \" ascii\n      $s5 = \"sfxelevation\" ascii wide\n      $s6 = \"Error in command line:\" ascii wide\n      $s7 = \"%X - %03X - %03X - %03X - %03X\" ascii wide\n      $s8 = \"- Copyright (c) 2005-2012 \"  ascii\n      $s9 = \"Supported methods and filters, build options:\" wide ascii\n      $s10 = \"Could not overwrite file \\\"%s\\\".\" wide ascii\n      $s11 = \"7-Zip: Internal error, code 0x%08X.\" wide ascii\n      $s12 = \"@ (%d%s)\"  wide ascii\n      $s13 = \"SfxVarCmdLine0\" ascii\n      $s14 = \"11326\"\n      $s15 = \"29225\"\n      $s16 = \"6137\"\n      $cmd = \".cmd\" wide ascii \ncondition:\n      12 of ($s*) and $cmd\n}\nimport \"pe\"\nrule GamaredonPteranodon_SFX_intermediate_stage{\nmeta:\n description = \"Yara Rule for Pteranodon implant Family Intermediate Stage\"\n author = \"Cybaze - Yoroi ZLab\"\n last_updated = \"2019-05-31\"\n tlp = \"white\"\n category = \"informational\"\nstrings:\n $a1 = {56 8B F1 8D 46 04 50 FF}\n $a2 = {14 7A 19 5D 01 EB 18 02 85}\n $a3 = {0D 4D 38 B1 2D EE 1E 2B}\n    $b1 = {34 9B 43 00 50 FF 15 30}\n     $b2 = {AB B9 89 97 2F DD 7D 82}\n     $b3 = {9D CA C6 91 EF}\n     $c1 = {24 0C FF 15 34 9B 43 00}\n     $c2 = {32 31 32 F0 32 2E 39}\n     $c3 = {45 3B 4B 21 A7}\ncondition:\n pe.number_of_sections == 4 and all of ($a*) or\n     pe.number_of_sections == 6 and all of ($b*) or\n     pe.number_of_sections == 6 and all of ($c*)\n}\nAcknowledgement: special thanks to @JAMESWT_MHT for info and samples.\nSeat\nYoroi S.r.l.\nVia Giovanni Battista Martini 6,\nRoma RM, 00198\nContact\ninfo@yoroi.company\n+39 051 0301005\nLegal\nTerms & Conditions\nPrivacy Policy\nWarning system\nSubscribe to our early warning\nsystem\nDownloads News\nSocial\nP.IVA. 03407741200 - R.E.A. RM 1559639 - Codice Fiscale 03407741200 - Capitale Sociale: Euro 50.000 IV\ncredits: SimpleNetworksDefence center\nSolutions  \nBlog\nHome\nDownloads\nAbout us\nContacts\nWe use cookies to ensure that we give you the best experience on our website. If you continue to use this site we will assume that you are happy with it.\n OkOk\n Privacy PolicyPrivacy Policy\n "
}