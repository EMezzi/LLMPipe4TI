{
    "title": "the fourth horseman_ cve-2019-0797 vulnerability _ securelist",
    "text": "Share post on:In February 2019, our Automatic Exploit Prevention (AEP) systems detected an attempt to exploit a vulnerability in the\nMicrosoft Windows operating system. Further analysis of this event led to us discovering a zero-day vulnerability in\nwin32k.sys. We reported it to Microsoft on February 22, 2019. The company confirmed the vulnerability and assigned it\nCVE-2019-0797 . Microsoft have just released a patch, crediting Kaspersky Lab researchers Vasiliy Berdnikov  and Boris Larin\nwith the discovery:\nThis is the fourth consecutive exploited Local Privilege Escalation vulnerability in Windows we have discovered recently\nusing our technologies. Just like with CVE-2018-8589 , we believe this exploit is used by several threat actors including, but\npossibly not limited to, FruityArmor and SandCat. While FruityArmor is known to have used zero-days before, SandCat is a\nnew APT we discovered only recently. In addition to CVE-2019-0797 and CHAINSHOT, SandCat also uses the\nFinFisher/FinSpy framework.\nKaspersky Lab products detected this exploit proactively through the following technologies:\n1. Behavioral detection engine and Automatic Exploit Prevention for endpoint products;\n2. Advanced Sandboxing and Anti Malware engine for Kaspersky Anti Targeted Attack Platform (KATA).\nKaspersky Lab verdicts for the artifacts used in this and related attacks are:\nHEUR:Exploit.Win32.Generic\nHEUR:Trojan.Win32.Generic\nPDM:Exploit.Win32.Generic\nBrief technical details – CVE-2019-0797\nCVE-2019-0797 is a race condition that is present in the win32k driver due to a lack of proper synchronization between\nundocumented syscalls NtDCompositionDiscardFrame and NtDCompositionDestroyConnection. The vulnerable code can\nbe observed below on screenshots made on an up-to-date system during initial analysis:\nSnippet of NtDCompositionDiscardFrame syscall (Windows 8.1)\nOn this screenshot with the simplified logic of the NtDCompositionDiscardFrame syscall you can see that this code acquires\na lock that is related to frame operations in the structure DirectComposition::CConnection and tries to find a frame that\ncorresponds to a given id and will eventually call a free on it. The problem with this can be observed on the second\nscreenshot:\nSnippet of NtDCompositionDestroyConnection syscall inner function (Windows 8.1)\nOn this screenshot with the simplified logic of the function DiscardAllCompositionFrames that is called from within the\nNtDCompositionDestroyConnection syscall you can see that it does not acquire the necessary lock and calls the function\nDiscardAllCompositionFrames that will release all allocated frames. The problem lies in the fact that when the syscalls\nNtDCompositionDiscardFrame and NtDCompositionDestroyConnection are executed simultaneously, the function\nDiscardAllCompositionFrames may be executed at a time when the NtDCompositionDiscardFrame syscall is already looking\nfor a frame to release or has already found it. This condition leads to a use-after-free scenario.\nInterestingly, this is the third race condition zero-day exploit used by the same group in addition to CVE-2018-8589 and\nCVE-2018-8611 .\nStop execution if module file name contains substring\n“chrome.exe”\nThe exploit that was found in the wild was targeting 64-bit operating systems in the range from Windows 8 to Windows 10\nbuild 15063. The exploitation process for all those operating systems does not differ greatly and is performed using heap\nspraying palettes and accelerator tables with the use of GdiSharedHandleTable and gSharedInfo to leak their kernel\naddresses. In exploitation of Windows 10 build 14393 and higher windows are used instead of palettes. Besides that, that\nexploit performs a check on whether it’s running from Google Chrome and stops execution if it is because vulnerability\nCVE-2019-0797 can’t be exploited within a sandbox.\nMICROSOFT WINDOWS  TARGETED ATTACKS  VULNERABILITIES AND EXPLOITS  ZERO-DAY VULNERABILITIES\nRelated Posts\nLEAVE A REPLY\nYour email address will not be published.  Required fields are marked *\nEnter your comment here\nName *\nEmail *\nSave my name, email, and website in this browser for the next time I comment.\n \nSUBMIT\nI'm not a robot\nreCAPTCHA\nPrivacy  - Terms\n \nIN THE SAME CATEGORY\nAssessing the impact of protection from\nweb miners\nAgent 1433: remote attack on Microsoft\nSQL Server\nHow to steal a million (of your data)\nOn the IoT road: perks, beneﬁts and\nsecurity of moving smartly\nHow we hacked our colleague’s smart\nhome\nRESEARCH\nThe fourth horseman: CVE-2019-0797\nvulnerability\nThe new zero-day in the Windows OS exploited in targeted\nattacks\nBy Vasily Berdnikov , Boris Larin  on March 13, 2019. 10:00 am\n \nNotify me when new comments are added.\n© 2020 AO Kaspersky Lab.  All Rights Reserved. \nRegistered trademarks and service marks are the property of their respective owners.\nContact us  | Privacy Policy  | License AgreementEmail\n I agree to provide my email address to “AO Kaspersky\nLab” to receive information about new posts on the\nsite. I understand that I can withdraw this consent at\nany time via e-mail by clicking the “unsubscribe” link\nthat I find at the bottom of any e-mail sent to me for\nthe purposes mentioned above.SUBSCRIBE\nMokes and Buerak\ndistributed under the guise\nof security certificates\nOperation AppleJeus Sequel\n Kaspersky Security Bulletin\n2019. Statistics\nTHREATS\n CATEGORIES\n TAGS\n STATISTICS ENCYCLOPEDIA DESCRIPTIONS KSB 2019\n English\nSolutions\n Industries\n Products\n Services\n Resource Center\n Contact Us GDPRCompanyAccount GET IN TOUCHSolutions for: Home Products  Small Business 1-50 employees Medium Business 51-999 employees Enterprise 1000+ employees\n "
}