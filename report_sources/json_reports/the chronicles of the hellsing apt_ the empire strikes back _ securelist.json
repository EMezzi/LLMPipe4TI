{
    "title": "the chronicles of the hellsing apt_ the empire strikes back _ securelist",
    "text": "Share post on:\nTHERE ARE 4 COMMENTS\nhttps://www.youtube.com/watch?v=gvAUfp4iDw4\nIntroduction\nOne of the most active APT groups in Asia, and especially around the South China Sea area is “Naikon”. Naikon plays a key\npart in our story, but the focus of this report is on another threat actor entirely; one who came to our attention when they\nhit back at a Naikon attack.\nNaikon is known for its custom backdoor, called RARSTONE , which our colleagues at Trend Micro have described in detail.\nThe name Naikon comes from a custom user agent string, “NOKIAN95/WEB”, located within the backdoor:\nNOKIAN string in Naikon backdoor\nThe Naikon group is mostly active in countries such as the Philippines, Malaysia, Cambodia, Indonesia, Vietnam, Myanmar,\nSingapore, and Nepal, hitting a variety of targets in a very opportunistic way. What was perhaps one of the biggest operations\nof the Naikon group was launched in March 2014, in the wake of the MH370 tragedy  that took place on March 8th. By\nMarch 11th, the Naikon group was actively hitting most of the nations involved in the search for MH370. The targets were\nextremely wide-ranging but included institutions with access to information related to the disappearance of MH370, such as:\nOffice of the President\nArmed Forces\nOffice of the Cabinet Secretary\nNational Security Council(s)\nOffice of the Solicitor General\nNational Intelligence Coordinating Agency\nCivil Aviation Authority\nDepartment of Justice\nNational Police\nPresidential Management Staff\nThe Naikon group used mostly spear-phished documents for the attacks, with CVE-2012-0158 exploits that dropped the\ngroup’s signature backdoor.\nWhile many of these attacks were successful, at least one of the targets didn’t seem to like being hit, and instead of\nopening the documents, decided on a very different course of action.\nThe empire strikes back\nHere’s a question – what should you do when you receiving a suspicious document from somebody you don’t know, or\nknow very little? Choose one:\nOpen the document\nDon’t open the document\nOpen the document on a Mac (everybody knows Mac’s don’t get viruses )\nOpen the document in a virtual machine with Linux\nBased on our experience, most people would say 2, 3 or 4. Very few would open the document and even fewer would\nactually decide to test the attacker and verify its story.\nBut this is exactly what happened when one of the Naikon spear-phishing targets received a suspicious email. Instead of\nopening the document or choosing to open it on an exotic platform, they decided to check the story with the sender:\nNaikon target asks for confirmation of the email\nIn the email above, we can see the target questioning the authenticity of the Naikon spear-phishing. They ask the sender if it\nwas their intention to email this document.\nThe attacker was, of course, not confused in the slightest, and being very familiar with the internal structure of the target’s\ngovernment agency, replied claiming that they work for the secretariat division and were instructed to send it by the\norganization’s management:\nNaikon attacker replies to the target\nThe reply is written in poor English and indicates that the attacker is probably not as proficient in the language as the\nintended victim. Seeing the reply, the target obviously decided not to open the document. Moreover, they decided to go a\nbit further and try to learn more about the attacker.\nNot long after the first exchange, the following email was sent to the attacker by the target:\nThe attachment is a RAR archive with password, which allows it to safely bypass malware scanners associated with the free\nemail account used by the attackers. Inside the archive we find two decode PDF files and one SCR file:\nMuch to our surprise, the “SCR” file turned out to be a backdoor prepared especially for the Naikon fraudsters.\nThe file “ Directory of … Mar 31, 2014.scr ” (md5: 198fc1af5cd278091f36645a77c18ffa ) drops a blank document containing\nthe error message and a backdoor module (md5: 588f41b1f34b29529bc117346355113f ). The backdoor connects to the\ncommand server located at philippinenews[.]mooo[.]com .\nThe backdoor can perform the following actions:\ndownload files\nupload files\nupdate itself\nuninstall itself\nWe were amazed to see this course of action and decided to investigate the “Empire Strikes Back”-door further; naming the\nactor “Hellsing” (explained later).\nThe malware used by the intended victim appears to have the following geographical distribution, according to KSN data:\nMalaysia – government networks\nPhilippines – government networks\nIndonesia – government networks\nUSA – diplomatic agencies\nIndia (old versions of malware)\nIn addition, we’ve observed the targeting of ASEAN-related entities.\nVictims of Hellsing attacks\nThe actor targets its intended victims using spear-phishing emails with archives containing malware, similar to the one it used\nagainst the Naikon group. Some of the attachment names we observed include:\n2013 Mid-Year IAG Meeting Admin Circular FINAL.7z\nHSG FOLG ITEMS FOR USE OF NEWLY PROMOTED YNC FEDERICO P AMORADA 798085 PN CLN.zip\nHome Office Directory as of May 2012.Please find attached here the latest DFA directory and key position officials for\nyour referenece.scr\nLOI Nr 135-12 re 2nd Quarter.Scr\nLetter from Paquito Ochoa to Albert Del Rosario,the Current Secretary of Foreign Affairs of the Philippines.7z\nLetter to SND_Office Call and Visit to Commander, United States Pacific Command (USPACOM) VER 4.0.zip\nPAF-ACES Fellowship Program.scr\nRAND Analytic Architecture for Capabilities Based Planning, Mission System Analysis, and Transformation.scr\nUpdate Attachments_Interaction of Military Personnel with the President _2012_06_28.rar\nUpdate SND Meeting with the President re Hasahasa Shoal Incident.scr\nWashington DC Directory November 2012-EMBASSY OF THE PHILIPPINES.zip\nZPE-791-2012&ZPE-792-2012.rar\nzpe-791-2012.PDF.scr\nWe’ve observed RAR, ZIP and 7ZIP archives in the attacks – the 7ZIP archives with passwords were probably introduced as a\nway to bypass the recent security features on Gmail, which block password-protected archives with executables inside.\nEach backdoor has a command and control server inside as well as a version number and a campaign or victim identifier.\nSome examples include:\nMD5 Date C&C Campaign identifier\n2682a1246199a18967c98cb32191230c Mar 31 2014 freebsd.extrimtur[.]com 1.6.1_MOTAC\n31b3cc60dbecb653ae972db9e57e14ec Mar 31 2014 freebsd.extrimtur[.]com 1.6.1_MOTAC\n4dbfd37fd851daebdae7f009adec3cbd Nov 08 2013 articles.whynotad[.]com1.5_articles.whynotad.com-\nnsc\n015915bbfcda1b2b884db87262970a11 Feb 19 2014 guaranteed9.strangled[.]net 1.5_guaranteed9-nsc\n3a40e0deb14f821516eadaed24301335 Mar 31 2014 hosts.mysaol[.]com 1.6.1_imi;simple\n73396bacd33cde4c8cb699bcf11d9f56 Nov 08 2013 web01.crabdance[.]com 1.5_op_laptop\n7c0be4e6aee5bc5960baa57c6a93f420 Nov 08 2013 hosts.mysaol[.]com 1.5_MMEA\nbff9c356e20a49bbcb12547c8d483352 Apr 02 2014 imgs09.homenet[.]org 1.6.1_It\nc0e85b34697c8561452a149a0b123435 Apr 02 2014 imgs09.homenet[.]org 1.6.1_It\nf13deac7d2c1a971f98c9365b071db92 Nov 08 2013 hosts.mysaol[.]com 1.5_MMEA\nf74ccb013edd82b25fd1726b17b670e5 May 12 2014 second.photo-frame[.]com 1.6.2s_Ab\nThe campaign identifiers could be related to the organizations targeted by the specific builds of this APT. Some possible\ndescriptions for these initials could be:\nMOTAC – Ministry of Tourism and Culture, Malaysia – http://www.motac.gov.my/en/\nNSC – http://www.nsc.gov.my/\nMMEA – Malaysian Maritime Enforcement Agency – http://www.mmea.gov.my\nArtifacts and overlap with other APTs\nInterestingly, some of the infrastructure used by the attackers appears to overlap (although around a year apart) with a group\ntracked internally at Kaspersky Lab as PlayfullDragon (also known as “GREF”); while other aspects of the infrastructure\noverlap with a group known as Mirage or Vixen Panda.\nFor instance, one of the PlayfullDragon’s Xslcmd backdoors described by our colleagues from FireEye  (md5:\n6c3be96b65a7db4662ccaae34d6e72cc) beams to cdi.indiadigest[.]in:53 . One of the Hellsing samples we analysed (md5:\n0cbefd8cd4b9a36c791d926f84f10b7b) connects to the C&C server at webmm[.]indiadigest[.]in . Although the hostname is\nnot the same, the top level domain suggests some kind of connection between the groups. Several other C&C subdomains\non “indiadigest[.]in” include:\naac.indiadigest[.]in\nld.indiadigest[.]in\nlongc.indiadigest[.]in\nAnother overlap we observed is with an APT known as Cycldek or Goblin Panda. Some of the Hellsing samples we analysed\nin this operation (e.g. md5: a91c9a2b1bc4020514c6c49c5ff84298) communicate with the server\nwebb[.]huntingtomingalls[.]com , using a protocol specific to the Cycldek backdoors (binup.asp/textup.asp/online.asp).\nIt appears that the Hellsing developer started with the Cycldek sources and worked together with the operators from other\nAPT groups. Nevertheless, it is sufficiently different to warrant classification as a stand-alone operation.\nSo, where does the Hellsing name come from? One of the samples we analysed (md5:\n036e021e1b7f61cddfd294f791de7ea2) appears to have been compiled in a rush and the attacker forgot to remove the\ndebug information. One can see the project name is Hellsing and the malware is called “msger”:\nOf course, Hellsing can have many different meanings, including the famous doctor from Bram Stoker’s Dracula. However,\naccording to Wikipedia, “Hellsing ( ヘルシング  Herushingu) is also a Japanese manga  series written and illustrated by Kouta\nHirano . It first premiered in Young King Ours  in 1997 and ended in September 2008 ″.\nThe Hellsing series chronicles the efforts of the mysterious and secret Hellsing Organization, as it combats vampires ,\nghouls , and other supernatural  foes; which makes it perhaps an appropriate name for our group.\nIn addition to the Hellsing/msger malware, we’ve identified a second generation of Trojan samples which appear to be\ncalled “xweber” by the attackers:\n“Xweber” seems to be the more recent Trojan, taking into account compilation timestamps. All the “msger” samples we\nhave seen appear to have been compiled in 2012. The “Xweber” samples are from 2013 and from 2014, indicating that at\nsome point during 2013 the “msger” malware project was renamed and/or integrated into “Xweber”.\nDuring our investigation we’ve observed the Hellsing APT using both the “Xweber” and “msger” backdoors in their attacks, as\nwell as other tools named “xrat”, “clare”, “irene” and “xKat”.\nOther tools\nOnce the Hellsing attackers compromise a computer, they deploy other tools which can be used for gathering further\ninformation about the victim or doing lateral movement. One such tool is “test.exe”:\nName test.exe\nSize 45,568 bytes\nMD5 14309b52f5a3df8cb0eb5b6dae9ce4da\nType Win32 PE i386 executable\nThis tool is used to gather information and test available proxies. Interestingly, it also contains the Hellsing debug path:\nAnother attack tool deployed in a victim’s environment was a file system driver, named “diskfilter.sys”, although internally it\nclaims to be named “xrat.sys”. The driver is unsigned and compiled for 32-bit Windows. It was used briefly in 2013, before\nbeing abandoned by the attackers, possibly due to Windows 7 driver signing requirements:\nAnother tool used by the attackers is called “xKat”:\nName xkat.exe\nSize 78,848 bytes\nMD5 621e4c293313e8638fb8f725c0ae9d0f\nType Win32 PE i386 executable\nThis is a powerful file deletion and process killer which uses a driver (Dbgv.sys) to perform the operations. We’ve seen it\nbeing used by the attackers to kill and delete malware belonging to their competitors.\nSome of the debug paths found in the binaries include:\ne:\\Hellsing\\release\\clare.pdb\ne:\\Hellsing\\release\\irene\\irene.pdb\nd:\\hellsing\\sys\\irene\\objchk_win7_x86\\i386\\irene.pdb\nd:\\hellsing\\sys\\xkat\\objchk_win7_x86\\i386\\xKat.pdb\nd:\\Hellsing\\release\\msger\\msger_install.pdb\nd:\\Hellsing\\release\\msger\\msger_server.pdb\nd:\\hellsing\\sys\\xrat\\objchk_win7_x86\\i386\\xrat.pdb\nD:\\Hellsing\\release\\exe\\exe\\test.pdb\nAttribution\nIn general, the attribution of APTs is a very tricky task which is why we prefer to publish technical details and allow others to\ndraw their own conclusions.\nThe Hellsing-related samples appear to have been compiled around the following times:\nAssuming normal work starts at around 9 am, the attacker seems to be most active in a time-zone of GMT+8 or +9,\nconsidering a work program of 9/10 am to 6/7pm.\nConclusions\nThe Hellsing APT group is currently active in the APAC region, hitting targets mainly in the South China Sea area, with a\nfocus on Malaysia, the Philippines and Indonesia. The group has a relatively small footprint compared to massive operations\nsuch as “ Equation “. Smaller groups can have the advantage of being able to stay under the radar for longer periods of time,\nwhich is what happened here.\nThe targeting of the Naikon group by the Hellsing APT is perhaps the most interesting part. In the past, we’ve seen APT\ngroups accidentally hitting each other while stealing address books from victims and then mass-mailing everyone on each\nof these lists. But, considering the timing and origin of the attack, the current case seems more likely to be an APT-on-APT\nattack.\nTo protect against a Hellsing attack, we recommend that organisations follow basic security best practices:\nDon’t open attachments from people you don’t know\nBeware of password-protected archives which contain SCR or other executable files inside\nIf you are unsure about the attachment, try to open it in a sandbox\nMake sure you have a modern operating system with all patches installed\nUpdate all third party applications such as Microsoft Office, Java, Adobe Flash Player and Adobe Reader\nKaspersky Lab products detect the backdoors used by the Hellsing attacker as: HEUR:Trojan.Win32.Generic, Trojan-\nDropper.Win32.Agent.kbuj, Trojan-Dropper.Win32.Agent.kzqq .\nDeny the Hellsing APT by default\nAppendix:\nHellsing Indicators of Compromise\nAPT SOCIAL ENGINEERING  TARGETED ATTACKS  VULNERABILITIES AND EXPLOITS\nRelated Posts\nLawrence Munro\nPosted on April 15, 2015. 7:16 am\nMaybe a slight tangey, but how did they get named ‘Naikon’ from ‘Nokian’. Especially as I think it’s referencing the Nokia\nN95 which is an old smart phone that is commonly weaponised by pen testers / hackers.\nREPLY\nassp1r1n3\nPosted on July 6, 2016. 7:34 pm\nI’m not aware of any custom firmware for N95, as well as any other Symbian phone, which could have value\nfor pentester/hacker. Perhaps, those phones are _really_ old.\nREPLY\nGhost\nPosted on April 15, 2015. 6:21 pm\n@Lawrence, reverse the string \nREPLY\nDonny\nPosted on May 14, 2015. 9:15 am\nNAIKON comes from the HTTP user-agent, which was NOKIAN95.\nREPLY\nLEAVE A REPLY\nYour email address will not be published.  Required fields are marked *\nEnter your comment here\nName *\nEmail *\nSave my name, email, and website in this browser for the next time I comment.\n \nSUBMIT\nI'm not a robot\nreCAPTCHA\nPrivacy  - Terms\n APT REPORTS\nThe Chronicles of the Hellsing APT:\nthe Empire Strikes Back\nBy Costin Raiu , Maxim Golovkin  on April 15, 2015. 2:30 am\n \nNotify me when new comments are added.\n© 2020 AO Kaspersky Lab.  All Rights Reserved. \nRegistered trademarks and service marks are the property of their respective owners.\nContact us  | Privacy Policy  | License AgreementEmail\n I agree to provide my email address to “AO Kaspersky Lab” to\nreceive information about new posts on the site. I understand\nthat I can withdraw this consent at any time via e-mail by\nclicking the “unsubscribe” link that I find at the bottom of any e-\nmail sent to me for the purposes mentioned above.\nSUBSCRIBE\nHunting APTs with YARA\n Mokes and Buerak\ndistributed under the guise\nof security certificates\nHappy New Fear! Gift-\nwrapped spam and phishing\nTHREATS\n CATEGORIES\n TAGS\n STATISTICS ENCYCLOPEDIA DESCRIPTIONS KSB 2019\n English\nSolutions\n Industries\n Products\n Services\n Resource Center\n Contact Us GDPR GET IN TOUCH\n "
}