{
    "title": "blackoasis apt and new targeted attacks leveraging zero-day exploit _ securelist",
    "text": "More information about BlackOasis APT is available to customers of Kaspersky Intelligence Reporting Service. Contact:\nintelreports@kaspersky.com\nIntroduction\nKaspersky Lab has always worked closely with vendors to protect users. As soon as we find new vulnerabilities we\nimmediately inform the vendor in a responsible manner and provide all the details required for a fix.\nOn October 10, 2017, Kaspersky Lab’s advanced exploit prevention systems identified a new Adobe Flash zero day exploit\nused in the wild against our customers. The exploit was delivered through a Microsoft Office document and the final\npayload was the latest version of FinSpy malware. We have reported the bug to Adobe who assigned it CVE-2017-11292 and\nreleased a patch  earlier today:\nSo far only one attack has been observed in our customer base, leading us to believe the number of attacks are minimal and\nhighly targeted.\nAnalysis of the payload allowed us to confidently link this attack to an actor we track as “BlackOasis”. We are also highly\nconfident that BlackOasis was also responsible for another zero day exploit (CVE-2017-8759) discovered by FireEye  in\nSeptember 2017.  The FinSpy payload used in the current attacks (CVE-2017-11292) shares the same command and control\n(C2) server as the payload used with CVE-2017-8759 uncovered by FireEye.\nBlackOasis Background\nWe first became aware of BlackOasis’ activities in May 2016, while investigating another Adobe Flash zero day. On May 10,\n2016, Adobe warned  of a vulnerability (CVE-2016-4117) affecting Flash Player 21.0.0.226 and earlier versions for Windows,\nMacintosh, Linux, and Chrome OS. The vulnerability was actively being exploited in the wild.\nKaspersky Lab was able to identify a sample exploiting this vulnerability that was uploaded to a multi scanner system on May\n8, 2016. The sample, in the form of an RTF document, exploited CVE-2016-4117 to download and install a program from a\nremote C&C server. Although the exact payload of the attack was no longer in the C&C, the same server was hosting\nmultiple FinSpy installation packages.\nLeveraging data from Kaspersky Security Network, we identified two other similar exploit chains used by BlackOasis in June\n2015 which were zero days at the time.  Those include CVE-2015-5119 and CVE-2016-0984, which were patched in July\n2015 and February 2016 respectively.  These exploit chains also delivered FinSpy installation packages.\nSince the discovery of BlackOasis’ exploitation network, we’ve been tracking this threat actor with the purpose of better\nunderstanding their operations and targeting and have seen a couple dozen new attacks. Some lure documents used in\nthese attacks are shown below:\nIN THE SAME CATEGORY\nChafer used Remexi malware to spy on\nIran-based foreign diplomatic entities\nGreyEnergy’s overlap with Zebrocy\nA Zebrocy Go Downloader\nAPT review of the year\nDarkPulsar FAQ\nTHREATS\n CATEGORIES\n TAGS\n STATISTICS ENCYCLOPEDIA DESCRIPTIONS KSB 2019\nAPT REPORTS\nBlackOasis APT and new targeted\nattacks leveraging zero-day exploit\nBy GReAT  on October 16, 2017. 2:28 pm\nEnglish\nSolutions\n Industries\n Products\n Services\n Resource Center\n Contact Us GDPRCompanyAccount GET IN TOUCHSolutions for: Home Products  Small Business 1-50 employees Medium Business 51-999 employees Enterprise 1000+ employees\n Decoy documents used in BlackOasis attacks\nTo summarize, we have seen BlackOasis utilizing at least five zero days since June 2015:\nCVE-2015-5119 – June 2015\nCVE-2016-0984 – June 2015\nCVE-2016-4117 – May 2016\nCVE-2017-8759 – Sept 2017\nCVE-2017-11292 – Oct 2017\nAttacks Leveraging CVE-2017-11292\nThe attack begins with the delivery of an Office document, presumably in this instance via e-mail.  Embedded within the\ndocument is an ActiveX object which contains the Flash exploit.\nFlash object in the .docx file, stored in uncompressed format\nThe Flash object contains an ActionScript which is responsible for extracting the exploit using a custom packer seen in other\nFinSpy exploits.\nUnpacking routine for SWF exploit\nThe exploit is a memory corruption vulnerability that exists in the “ com.adobe.tvsdk.mediacore.BufferControlParameters ”\nclass.  If the exploit is successful, it will gain arbitrary read / write operations within memory, thus allowing it to execute a\nsecond stage shellcode.\nThe first stage shellcode contains an interesting NOP sled with alternative instructions, which was most likely designed in\nsuch a way to avoid detection by antivirus products looking for large NOP blocks inside flash files:\n NOP sled composed of 0x90 and 0x91 opcodes\nThe main purpose of the initial shellcode is to download second stage shellcode from\nhxxp://89.45.67[.]107/rss/5uzosoff0u.iaf.\nSecond stage shellcode\nThe second stage shellcode will then perform the following actions:\n1. Download the final payload (FinSpy) from hxxp://89.45.67[.]107/rss/mo.exe\n2. Download a lure document to display to the victim from the same IP\n3. Execute the payload and display the lure document\nPayload – mo.exe\nAs mentioned earlier, the “mo.exe” payload (MD5: 4a49135d2ecc07085a8b7c5925a36c0a) is the newest version of FinSpy\nmalware, typically sold to nation states and other law enforcement agencies to use in lawful surveillance operations.  This\nnewer variant has made it especially difficult for researchers to analyze the malware due to many added anti-analysis\ntechniques, to include a custom packer and virtual machine to execute code.\nThe PCODE of the virtual machine is packed with the aplib packer.\nPart of packed VM PCODE\nAfter unpacking, the PCODE it will look like the following:\nUnpacked PCODE\nAfter unpacking the virtual machine PCODE is then decrypted:\nDecrypted VM PCODE\nThe custom virtual machine supports a total of 34 instructions:\n Share post on:\nTHERE ARE 3 COMMENTS\nExample of parsed PCODE\nIn this example, the “1b” instruction is responsible for executing native code that is specified in parameter field.\nOnce the payload is successfully executed, it will proceed to copy files to the following locations:\nC:\\ProgramData\\ManagerApp\\AdapterTroubleshooter.exe\nC:\\ProgramData\\ManagerApp\\15b937.cab\nC:\\ProgramData\\ManagerApp\\install.cab\nC:\\ProgramData\\ManagerApp\\msvcr90.dll\nC:\\ProgramData\\ManagerApp\\d3d9.dll\nThe “AdapterTroubleshooter.exe” file is a legitimate binary which is leveraged to use the famous DLL search order hijacking\ntechnique.  The “d3d9.dll” file is malicious and is loaded into memory by the legit binary upon execution.  Once loaded, the\nDLL will then inject FinSpy into the Winlogon process.\nPart of injected code in winlogon process\nThe payload calls out to three C2 servers for further control and exfiltration of data. We have observed two of them used in\nthe past with other FinSpy payloads. Most recently one of these C2 servers was used together with CVE-2017-8759 in the\nattacks reported by FireEye in September 2017. These IPs and other previous samples tie closely to the BlackOasis APT\ncluster of FinSpy activity.\nTargeting and Victims\nBlackOasis’ interests span a wide gamut of figures involved in Middle Eastern politics and verticals disproportionately relevant\nto the region. This includes prominent figures in the United Nations, opposition bloggers and activists, and regional news\ncorrespondents. During 2016, we observed a heavy interest in Angola, exemplified by lure documents indicating targets with\nsuspected ties to oil, money laundering, and other illicit activities. There is also an interest in international activists and think\ntanks.\nVictims of BlackOasis have been observed in the following countries: Russia, Iraq, Afghanistan, Nigeria, Libya, Jordan,\nTunisia, Saudi Arabia, Iran, Netherlands, Bahrain, United Kingdom and Angola.\nConclusions\nWe estimate that the attack on HackingTeam in mid-2015 left a gap on the market for surveillance tools, which is now\nbeing filled by other companies. One of these is FinFisher with their suite of tools.\nWe believe the number of attacks relying on FinFisher software, supported by zero day exploits such as the ones described\nhere will continue to grow.\nWhat does it mean for everyone and how to defend against such attacks, including zero-day exploits?\nFor CVE-2017-11292 and other similar vulnerabilities, one can use the killbit  for Flash within their organizations to disable it\nin any applications that respect it.  Unfortunately, doing this system-wide is not easily done, as Flash objects can be loaded in\napplications that potentially do not follow the killbit. Additionally, this may break any other necessary resources that rely on\nFlash and of course, it will not protect against exploits for other third party software.\nDeploying a multi-layered approach including access policies, anti-virus, network monitoring and whitelisting can help\nensure customers are protected against threats such as this.  Users of Kaspersky products are protected as well against this\nthreat by one of the following detections:\nPDM:Exploit.Win32.Generic\nHEUR:Exploit.SWF.Generic\nHEUR:Exploit.MSOffice.Generic\nMore information about BlackOasis APT is available to customers of Kaspersky Intelligence Reporting Service. Contact:\nintelreports@kaspersky.com\nAcknowledgements\nWe would like to thank the Adobe Product Security Incident Response Team (PSIRT) for working with us to identify and\npatch this vulnerability.\nReferences\n1. Adobe Bulletin https://helpx.adobe.com/security/products/flash-player/apsb17-32.html\nIndicators of compromise\n4a49135d2ecc07085a8b7c5925a36c0a\n89.45.67[.]107\nADOBE  APT DLL HIJACKING  MICROSOFT WORD  VULNERABILITIES AND EXPLOITS  \nZERO-DAY VULNERABILITIES\nRelated Posts\nRyan\nPosted on October 16, 2017. 11:54 pm\nDoes EMET block the flash exploit?\nREPLY\nFaron Faulk\nPosted on October 17, 2017. 5:04 pm\nfixed\nhttps://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV170018\nREPLY\neyal \nMokes and Buerak\ndistributed under the guise\nof security certificates\nKBOT: sometimes they\ncome back\nOilRig’s Poison Frog – old\nsamples, same trick\n Posted on August 23, 2018. 11:42 am\noffice sample hash?\nREPLY\nLEAVE A REPLY\nYour email address will not be published.  Required fields are marked *\nEnter your comment here\nName *\nEmail *\nSave my name, email, and website in this browser for the next time I comment.\n \nSUBMIT\nI'm not a robot\nreCAPTCHA\nPrivacy  - Terms\n Notify me when new comments are added.\n© 2020 AO Kaspersky Lab.  All Rights Reserved. \nRegistered trademarks and service marks are the property of their respective owners.\nContact us  | Privacy Policy  | License AgreementEmail\n I agree to provide my email address to “AO Kaspersky Lab” to\nreceive information about new posts on the site. I understand\nthat I can withdraw this consent at any time via e-mail by\nclicking the “unsubscribe” link that I find at the bottom of any e-\nmail sent to me for the purposes mentioned above.\nSUBSCRIBE\nWe use cookies to make your experience of our websites better. By using and further navigating this website you accept this. Detailed\ninformation about the use of cookies on this website is available by clicking on more information .ACCEPT AND CLOSE\n "
}