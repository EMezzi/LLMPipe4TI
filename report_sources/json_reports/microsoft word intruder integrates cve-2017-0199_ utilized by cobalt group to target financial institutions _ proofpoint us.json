{
    "title": "microsoft word intruder integrates cve-2017-0199_ utilized by cobalt group to target financial institutions _ proofpoint us",
    "text": "/Blog /Threat Insight /Microsoft Word Intruder Integrates CVE-2017-0199, Utilized by Cobalt Group to Target Financial Institutions\nJUNE 01, 2017  | MATTHEW MESA, AXEL F, PIERRE T, TRAVIS GREEN\nOverview\nIn May, Proofpoint observed multiple campaigns using a new version of Microsoft Word Intruder (MWI). MWI is a tool sold on underground\nmarkets for creating exploit-laden documents, generally used in targeted attacks. We previously reported about MWI when it added support\nfor CVE-2016-4117 [2]. After the latest update, MWI is now using CVE-2017-0199 [4][5] to launch an HTML Application (HTA) used for both\ninformation collection and payload execution.\nThis activity targets organizations in the financial vertical including banks, banking software vendors, and ATM software and hardware\nvendors. The emails are sent to technology and security personnel working in departments including Fraud and Information Security.\nThe actor involved is believed to be the Cobalt group -- an actor known to target banks in Europe and Asia and previously documented by\nGroup IB [1]. The malicious documents created with MWI for use in these activities delivered Metasploit Stager, Cobalt Strike, and\npreviously undocumented malware  we named Cyst Downloader.\nEmail Lures\nWhile we observed numerous malicious attachments, we describe two here and list the rest in the IOC section.\nFigure 1: Email used to deliver the MWI document (Body translated: “Good day, important to familiarize yourself!”)\nIn the first campaign, the email (Figure 1) purported to be from FinCERT [8] with the subject “Памятка по информационной\nбезопасности” (Information Security Notice) and contained a Microsoft Word attachment named “сводка1705.doc” (report1705)\n(Figure 3).•\nAnother email (Figure 2) purported to be from Security Support for PCI-DSS [3] at a major credit card company with the subject line\n“Безопасность” (security) and a Microsoft Word attachment (Figure 4) “Требования безопасности.doc” (Safety requirements).•\nMicrosoft Word Intruder Integrates CVE-\n2017-0199, Utilized by Cobalt Group to Target\nFinancial InstitutionsContinua a vedere i contenuti per la tua posizione Continua United States\nProducts Solutions Partners Resources CompanyCONTACT LOGIN\n Figure 2: Email used to deliver the MWI document (Body translated: “Please accept following advice and recommendations regarding\nnecessary safety precautions”)\nFigure 3: MWI document after the exploit is triggered; the lure displays unreadable characters\nFigure 4: MWI document after the exploit is triggered; the lure describes the different ways to pay for a delinquent MTS (Russian mobile\nprovider) bill\nMWI Advertising Integration of CVE-2017-0199\nBefore we describe our MWI analysis, it is worth mentioning that on May 8, 2017, an advertisement for MWI on an underground site stated\nthat this exploit document builder integrated CVE-2017-0199, and was recruiting customers for several available seats. The full version of\nthe original Russian advertisement and its English translation follows:\nMicrosoft Office Word Exploits, universal .doc exploit-pack\nимеется несколько мест на CVE-2017-0199 (OLE2LINK)\n* билдер\n* статистика\n* запуск exe/dll (скриплеттов)\n* запуск cmd/powershell\n* поддержка, обновления, чистки\nподробности: [REDACTED_EMAIL]\n---\n[*] MICROSOFT WORD INTRUDER 8 - the best APT-like *.doc exploit pack\nCVE-2016-4117 + CVE-2015-2545 + CVE-2015-1641 + CVE-2012-0158\nTranslation:\nMicrosoft Office Word Exploits, universal .doc exploit-pack\nThere are several spots available for the CVE-2017-0199 (OLE2LINK)\n* Builder\n* Statistics\n* Running exe / dll (scriptlets)\n* Starting cmd / powershell\n* Support, updates, cleaning\nDetails: [REDACTED_EMAIL]\n---\n[*] MICROSOFT WORD INTRUDER 8 - the best APT-like * .doc exploit pack\nCVE-2016-4117 + CVE-2015-2545 + CVE-2015-1641 + CVE-2012-0158\nMWI Analysis\nWhen the document is opened, it drops the embedded payload into a temporary directory as is typical of RTFs with embedded objects[6].\nNext, the CVE-2017-0199 exploit downloads and executes the HTA.\nFrom our analysis, the purpose of the HTA is two-fold. It is used to download and/or execute the payload as well as collect information about\nthe infected machine. Thus the advertisement description is accurate. In the example analyzed here, shown in Figure 5, the MWI HTA is\nconfigured to run an executable payload embedded in the document, which was previously saved into the temporary directory when the\nrecipient opened the document. Note that the HTA could have alternatively been configured to download and run an executable, DLL, or a\n JScript/VBscript file. It is also configured to collect and report information about the system, such as installed antivirus applications, running\nprocesses, and whether execution of the payload was successful.\nFigure 5: Configuration section of the MWI HTA\nAs mentioned above, depending on how MWI is configured, it has different ways of executing the payload. Figure 6 shows the code snippet\nused for executing EXE and DLL payloads. There is also functionality for executing JScript/VBScript (Figure 7) and cmd/Powershell. All\nthree methods generate a section for the Command and Control (C&C) report letting the operator know if the execution was successful.\nFigure 6: Portion of the HTA code responsible for running DLLs and Executables\nFigure 7: Portion of the HTA code responsible for executing VBScript/Jscript\nThe information collection code is responsible for profiling the system. It collects network details, operating system information, installed\nantivirus products, and running processes (see list below). This collected information is encoded with base64 and sent it to its C&C server.\nUserName•\nComputerName•\nUserDomain•\nOS Version•\nOS SerialNumber•\nWindowsDirectory•\nCodeSet•\nCountryCode•\nOSLanguage•\n Figure 8: Section of the HTA responsible for collecting information about the system\nFigure 9: Section of the HTA responsible for sending collected data\nFigure 10: Function in the HTA used to send collected data\nMalware Payload: Metasploit Stager\nThe payload installed most frequently by MWI was the Metasploit stager, which in turn downloaded Cobalt Strike. The Metasploit stager [7] is\nused to stage additional malware and we often see it in penetration testing as well as real attacks.\nMalware Payload: Cyst Downloader and Plugin\nHowever, in at least in one case we observed an MWI document install a previously unknown malware (SHA256:\naf17a3b5bf4c78283b2ee338ac6d457b9f3e7b7187c7e9d8651452b78574b3d3). We are calling it the Cyst Downloader. The functionality\nof this loader is limited. It can create a mutex such as “syst<10 digits>” and communicate with the the C&C server to receive a DLL plugin.\nThe URI path pattern of the C&C beacon contains a folder (random alphanumeric name) followed by a file (random alphanumeric name) with\na .jpg, .php, .gif, or .png extension. The downloaded DLL is encrypted with a hardcoded \"\\x28\\xBF\\x0A\\xBE\\x5B\\x6E\\x70\\x03\" RC4  key and\nbase64 encoded. The server sends the DLL in HTML comments in a fake 404 response.\nCurrentTimeZone•\nLocale•\nDefaultProxy•\nAntivirus displayName•\nAntivirus instanceGuid•\nAntivirus pathToSignedProductExe•\nAntivirus pathToSignedReportingExe•\nAntivirus productState•\nAntivirus Timestamp•\nRunning process ProcessId•\nRunning process Name•\nRunning process ExecutablePath•\n Figure 11: Cyst Downloader communicating with the C&C and receiving a payload plugin\nThe DLL plugin is loaded in memory by the loader and does not access the disk. This plugin has the internal name “test.dll”, which may\nindicate it is still in development. This plugin has only one export named “Execute”, which is hardcoded into the Cyst loader. The plugin\nenumerates URLs stored in the browser history, with support for Internet Explorer, Chrome, Firefox, and Opera:\nThese methods of browser history parsing are well-known and have been used for a long time by malware authors. The visited URLs\nretrieved are stored in malware memory using this format :\n\"browser: (IE|Chrome|Firefox|Opera)\\r\\n” + “url: [s]” + \" | time: [d]\\r\\n\"\nFigure 12: Example of visited URLs (recovered from browser history) stored in memory\nThis data is then RC4 encrypted and sent to the same C&C. The attacker is likely parsing the data on the server side and searching for a\nset of selected domains relevant to their attack, making it an efficient filter for interesting targets.\nConclusion\nMicrosoft Word Intruder is a powerful tool for creating exploit documents that can be used in a variety of malicious campaigns. In this case,\nnot only was it used to install known malware and customizable scripts and executables, but also installed a previously undocumented\nmalware called Cyst Downloader. While exploit documents are less commonly used in attacks as malicious attachments and hosted files\nthan macro documents, the availability of often unpatched vulnerabilities like CVE-2017-0199 make it attractive to threat actors. We will\ncontinue to monitor MWI development and campaigns by Cobalt and other actors using associated exploit documents.\nAcknowledgements\nSpecial thanks to our colleague Andrew Komarov ( InfoArmor Inc. ) for his help in this study.\nReferences\n[1] http://www.group-ib.com/cobalt.html\n[2] https://www.proofpoint.com/us/threat-insight/post/microsoft-word-intruder-8-adds-support-for-flash-vulnerability\n[3] https://en.wikipedia.org/wiki/Payment_Card_Industry_Data_Security_Standard\n[4] https://www.proofpoint.com/us/threat-insight/post/apt-targets-financial-analysts\n[5] https://www.proofpoint.com/us/threat-insight/post/dridex-campaigns-millions-recipients-unpatched-microsoft-zero-day\n[6] https://www.proofpoint.com/us/threat-insight/post/dyre-malware-campaigners-innovate-distribution-techniques\n[7] https://blog.cobaltstrike.com/2013/06/28/staged-payloads-what-pen-testers-should-know/\n[8] https://www.scmagazine.com/fincert-to-help-russian-banks-respond-to-cyber-attacks/article/535448/\nIndicators of Compromise (IOCs)\nIOC IOC Type Description\ne559c65b51a874b9ebf4faacd830223428e507a865788c2f32a820b952ccf0b4 SHA256 MWI Document\n2a918030be965cd5f365eb28cd5a0bebec32d05c6a27333ade3beaf3c54d242c SHA256 MWI Document\ne0f6073aee370d5e1e29da20208ffa10e1b30f4cf7860bb1a9dde67a83dee332 SHA256 MWI Document\n61afc2bf91283ccc478406a4c1277a0c8549584716d8b3a89d36f9bcdc45c4fe SHA256 MWI Document\naf17a3b5bf4c78283b2ee338ac6d457b9f3e7b7187c7e9d8651452b78574b3d3\n SHA256 MWI Document\n326a01a5e2eeeeebe3dade94cf0f7298f259b72e93bd1739505e14df3e7ac21e SHA256 MWI HTA\nhxxp://37.1.207[.]202/wstat/ URL MWI C&C\nhxxp://5.45.66[.]161/wstat/ URL MWI C&C\n39ac90410bd78f541eb42b1108d2264c7bd7a5feafe102cd7ac8f517c1bd3754 SHA256 Metasploit Stager\nhxxps://176.9.99[.]134/MAUy URL Cobalt Strike\nDownload\nhxxps://176.9.99[.]134/kQ6j URL Cobalt Strike\nDownload\nhxxps://52.15.209[.]133/Els8 URL Cobalt Strike\nDownload\n138d3f20da09e9f5aa5a367b8ff89d349fe20a63682df2379a7a6f78f31eb53d SHA256 Cobalt Strike\n176.9.99[.]134 IP Cobalt Strike C&C\n52.15.209[.]133 IP Cobalt Strike C&C\n922e3bccd3eb151ee46afb203f9618ae007b99a758ca95caf5324d650a496426 SHA256 Cyst Downloader\n96.44.188[.]57 IP Cyst Downloader\nC&C\n24973014fa8174ffff190ae7967a65307a23d42386683dc672babd9c6cf1e5ee SHA256 Cyst Plugin (browser\nhistory checker)\nET and ETPRO Suricata/Snort Coverage\n2024306          ET TROJAN MWI Maldoc Load Payload\n2024197          ET CURRENT_EVENTS SUSPICIOUS MSXMLHTTP DL of HTA (Observed in RTF 0-day )\n2024307          ET TROJAN MWI Maldoc Posting Host DataIE: parse history using the IUrlHistoryStg2::EnumUrls method•\nChrome: parse history using a SQL query : “SELECT url, (last_visit_time/1000000-11644473600) FROM urls”•\nFirefox: parse history using a SQL query : “SELECT url, (last_visit_date/1000000) FROM moz_places”•\nOpera: parse history using a SQL query : “SELECT url, (last_visit_time/1000000-11644473600) FROM urls”•\n About Threat Center Products Resources Connect\nSupport\n2814013          ETPRO TROJAN Meterpreter or Other Reverse Shell SSL Cert\n2023629          ET INFO Suspicious Empty SSL Certificate - Observed in Cobalt Strike\n2826544          ETPRO TROJAN Cyst Downloader Fake 404\nOverview\nWhy Proofpoint\nCareers\nLeadership Team\nNews Center\nInvestors CenterLatest Threat Report\nHuman Factor Report\nThreat Glossary\nThreat Blog\nDaily RulesetEmail Protection\nAdvanced Threat Protection\nSecurity Awareness Training\nCloud App Security\nArchive & Compliance\nInformation Protection\nDigital Risk Protection\nProduct Bundles\nNexus PlatformWhitepapers\nWebinars\nDatasheets\nEvents\nCustomer Stories\nBlog\nFree Trial+1-408-517-4710\nContact Us\nOffice Locations\nRequest a Demo\nSupport Login\nSupport Services\nIP Address Blocked?\n   © 2020. All rights reserved. Terms and conditions  Privacy Policy  Sitemap\n \n "
}