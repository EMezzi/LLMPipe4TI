{
    "title": "cobalt strikes again_ spam runs use macros and cve-2017-8759 exploit against russian banks - trendlabs security intelligence blog",
    "text": "Trend Micro About TrendLabs Security Intelligence Blog\nHome    »   Exploits    »   Cobalt Strikes Again: Spam Runs Use Macros and CVE-2017-8759 Exploit Against\nRussian Banks\nSecurity Predictions for 2020\nCybersecurity in 2020 will be viewed\nthrough many lenses — from differing\nattacker motivations and cybercriminal\narsenal to technological developments\nand global threat intelligence — only so\ndefenders can keep up with the broad\nrange of threats.\nRead our security predictions for 2020.\nBusiness Process Compromise\nAttackers are starting to invest in long-\nterm operations that target specific\nprocesses enterprises rely on. They\nscout for vulnerable practices,\nsusceptible systems and operational\nloopholes that they can leverage or\nabuse. To learn more, read our Security 101:\nBusiness Process Compromise.\nRecent Posts\nOpenSMTPD Vulnerability (CVE-2020-8794) Can\nLead to Root Privilege Escalation and Remote\nCode Execution\nOperation Overtrap Targets Japanese Online\nBanking Users Via Bottle Exploit Kit and Brand-\nNew Cinobi Banking Trojan\nMarch Patch Tuesday: LNK, Microsoft Word\nVulnerabilities Get Fixes, SMBv3 Patch Follows\nBusting Ghostcat: An Analysis of the Apache\nTomcat Vulnerability (CVE-2020-1938 and CNVD-\n2020-10487)\nDissecting Geost: Exposing the Anatomy of the\nAndroid Trojan Targeting Russian Banks\nPopular Posts\nLokiBot Impersonates Popular Game Launcher\nand Drops Compiled C# Code File\nMisconfigured Container Abused to Deliver\nCryptocurrency-mining Malware\nDissecting Geost: Exposing the Anatomy of the\nAndroid Trojan Targeting Russian Banks\nOutlaw Updates Kit to Kill Older Miner Versions,\nTargets More Systems\nFebruary Patch Tuesday: Fixes for Critical LNK,\nRDP, Trident Vulnerabilities\nStay Updated\nEmail Subscription\nYour email here\nSubscribe\nPrivacy Statement Legal Policies Copyright © 2020 Trend Micro Incorporated. All rights reserved.HOME AND HOME OFFICE  | FOR BUSINESS  | SECURITY INTELLIGENCE  | ABOUT TREND MICRO\nAsia Pacific Region (APAC): Australia  / New Zealand , 中国, 日本, 대한민국 , 台灣 Latin America Region (LAR): Brasil , México  North America Region (NABU): United States , Canada  \nEurope, Middle East, & Africa Region (EMEA): France , Deutschland / Österreich / Schweiz , Italia, Россия , España , United Kingdom / Ireland\nCobalt Strikes Again: Spam Runs Use Macros and CVE-\n2017-8759 Exploit Against Russian Banks\nPosted on: November 20, 2017  at 4:00 am Posted in: Exploits , Malware , Spam Author:  Trend Micro\nTags: Cobalt CVE-2017-8759 macro-based attackby Ronnie Giagone, Lenart Bermejo, and Fyodor Yarochkin\nThe waves of backdoor-laden spam emails we observed  during\nJune and July that targeted Russian-speaking businesses were\npart of bigger campaigns. The culprit appears to be the Cobalt\nhacking group, based on the techniques used. In their recent\ncampaigns, Cobalt used two different infection chains, with\nsocial engineering hooks that were designed to invoke a sense\nof urgency in its recipients—the bank’s employees.\nCobalt was named after Cobalt Strike, a multifunctional\npenetration testing tool similar to Metasploit. The hacking group\nmisused Cobalt Strike, for instance, to perpetrate  ATM cyber heists  and target financial institutions\nacross Europe, and interestingly, Russia. Unlike other groups that avoid Russia (or Russian-\nspeaking countries) to elude law enforcement, Cobalt’s attack patterns suggest that the group\nuses Russia as a testing ground where they try their latest malware and techniques on Russian\nbanks. If successful, they go on to attack financial institutions outside the country. This resembles\nthe tactics of another cybercriminal group, Lurk.\nOf note were Cobalt’s other targets. The hacking group’s first spam run also targeted a Slovenian\nbank, while the second run targeted financial organizations in Azerbaijan, Belarus, and Spain.\nChanging Tacks\nApart from using a different vulnerability ( CVE-2017-8759 ), what’s unique in their latest spear\nphishing  campaigns, compared to their previous spam runs and even other related cybercriminal\ncampaigns, is an apparent role change. The modus  commonly seen in attack chains that target\nend users (i.e., bank customers) is now leveled against the banks themselves. While they\npreviously posed as sales and billing departments of legitimate companies, they’re now\nmasquerading as the customers of their targets (banks), a state arbitration court, and ironically, an\nanti-fraud and online security company notifying the would-be victim that his “internet resource”\nhas been blocked.\nThey also diversified tacks. The first spam run on August 31 used a Rich Text Format (RTF)\ndocument laden with malicious macros. The second, which ran from September 20 to 21, used an\nexploit for CVE-2017-8759  (patched  last September), a code injection /remote code execution\nvulnerability in Microsoft’s .NET Framework. The vulnerability was used to retrieve and execute\nCobalt Strike from a remote server they controlled. We also saw other threat actors using the\nsame security flaw of late, like the cyberespionage group ChessMaster .\nBelow are snapshots of some of the spam emails they sent to their targets:\nFigure 1: Spam emails containing RTF documents embedded with malicious macros\nInfection Chain via Macros\nHere’s a visualization of this infection chain:\nFigure 2: Infection chain of Cobalt’s latest spear phishing campaign using malicious macro\nThe RTF file contains macro codes that will execute a PowerShell command to retrieve a dynamic-\nlink library (DLL) file before executing it using odbcconf.exe, a command-line utility related to\nMicrosoft Data Access Components . The DLL will drop and execute a malicious JScript using\nregsvr32.exe, another command-line utility, to download another JScript and execute it using the\nsame regsvr32.exe. This JScript will then connect to a remote server and wait for backdoor\ncommands. During analysis, we received a PowerShell command that downloads Cobalt Strike\nfrom hxxps://5[.]135[.]237[.]216[/]RLxF. It will ultimately try to connect to their command and control\n(C&C) server, 5[.]135[.]237[.]216[:]443, which we found located in France.\nFigure 3: The malicious RTF file asking would-be victims to “Enable Content” (left) and what\nhappens after clicking it, when the macro codes are run (right)\nTo further illustrate this infection chain: after clicking “Enable Content”, it will run the macro codes\nthat will check if the machine is 64-bit, decrypt and execute a PowerShell command, remove the\npicture in the document, and write “Call me” in it.  The PowerShell command is for downloading a\nDLL file from hxxp://visa[-]fraud[-]monitoring[.]com[/]t[.]dll, saving it in the affected machine, then\nexecuting it via the command, odbcconf.exe /S /A {REGSVR “”C:\\Users\\Public\\file.dll””}. The DLL\nfile will drop a Windows Script Component (SCT) file embedded with JScript in the %AppData%\nfolder using a random name and append it with a .TXT extension.\nFigure 4: The macro codes (above) and the DLL file executing the SCT file via regsvr32.exe\n(below)\nThe SCT file will check if the system has an internet connection; if it’s connected, it will proceed to\ndownload and execute a backdoor from the remote server.\nFigure 5: The file downloaded from the remote server, which is actually a backdoor\nSome of the backdoor’s commands are:\nd&exec — download and execute PE file\nmore_eggs — download additional scripts\ngtfo — delete files/startup entries and terminate\nmore_onion — run additional script\nmore_power — run command shell commands\nInfection Chain via CVE-2017-8759\nThe RTF attachment used in their second spam run contained an exploit for CVE-2017-8759. It\nentails downloading a specified Simple Object Access Protocol (SOAP) Web Services Description\nLanguage (WSDL) definition from a remote server, which is injected into memory. The codes\ninclude downloading and retrieving Cobalt Strike, which will connect to the C&C server\n86[.]106[.]131[.]207 and wait for commands.\nFigure 6: Infection chain using CVE-2017-8759\nFigure 7: Spam emails whose attachments contain an exploit for CVE-2017-8759\nThe same exploit technique has been employed  to deliver the cyberespionage malware FinSpy. In\nCobalt’s case, a SOAP moniker is embedded in the RTF file, which facilitates the exploit for CVE-\n2017-8759 by retrieving the malicious SOAP WSDL definition via\nhxxp://servicecentrum[.]info[/]test[.]xml. Contents of this Extensible Markup Language (XML) file will\nbe parsed, which will generate a Source Code (CS) file. It will then be compiled by the .NET\nFramework, which Microsoft Office will load as a library.  \nDepending on the infected machine’s architecture, the library will inject codes that will download\nand execute the final payload. It’s named “ZxT6” in 32-bit systems and “MZBt” in 64-bit machines.\nThe endgame is to connect to the C&C server, 86[.]106[.]131[.]207, which we found located in\nGermany. The final payload is a DLL that is a component of Cobalt Strike. It will connect to\n86[.]106[.]131[.]207[:]443 to wait for further commands.\nThis is what the attacker’s panel looks like when trying to interact with the targeted victims:\nFigure 8: Dashboard of Cobalt Strike, which is also abused by various attackers\nMitigations\nMany security technologies and security researchers may be utilizing newer detection\nmechanisms, but cybercriminals are also keeping up , adjusting their tactics to evade them. In\nCobalt’s case, for instance, they’ve looked into instances of valid Windows programs or utilities as\nconduits that allow their malicious code to bypass whitelisting.\nIndeed, Cobalt hacking group’s attacks exemplify the importance of defense in depth. Here are\nsome best practices to defend against these types of threats:\nBlacklist, disable, and secure the use  of built-in interpreters or command-line applications,\nsuch as PowerShell , odbcconf.exe, and regsvr.exe\nRegularly patch  and keep the system and its applications updated to prevent attackers from\nexploiting possible vulnerabilities; consider virtual patching  for legacy/end-of-life systems\nSecure the email gateway , given how Cobalt still relies on email as entry point\nImplement network segmentation  and data categorization  to thwart lateral movement\nProactively monitor the network and endpoint for anomalous activities; deploy firewalls  and\nsandbox  as well as intrusion detection and prevention systems to reduce attack surface\n \nTrend Micro Solutions\nTrend Micro XGen™ security  provides a cross-generational blend of threat defense techniques\nagainst a full range of threats for data centers , cloud environments , networks , and endpoints . It\nfeatures high-fidelity machine learning to secure the gateway  and endpoint  data and applications,\nand protects physical, virtual, and cloud workloads. With capabilities like web/URL filtering,\nbehavioral analysis, and custom sandboxing, XGen™ protects against today’s purpose-built\nthreats that bypass traditional controls, exploit known, unknown, or undisclosed vulnerabilities .\nSmart, optimized, and connected, XGen™ powers Trend Micro’s suite of security solutions: Hybrid\nCloud Security, User Protection, and Network Defense.\nIndicators of Compromise (IoCs):\nHashes related to the spear phishing campaign using malicious macro codes (SHA256):\nEmail attachments/RTF files detected as W2KM_CALLEM.ZGEI-A:\nccb1fa5cdbc402b912b01a1838c1f13e95e9392b3ab6cc5f28277c012b0759f9\ndcad7f5135ffa5e98067b46feec2563be8c67934eb3b14ef1aad8ff7fe0892c5\nMalicious DLL file detected as TROJ_DROPFCKJS.ZHEI-A\ndab05e284a9cbc89d263798bae40c9633ff501e19568c2ca21ada58e90d66891\nMalicious JScript file (35CE74A54720.txt) detected as JS_NAKJS.ZGEI-A:\n2b4760b5bbe982a7e26af4ee618f8f2dcc67dfe0211f852bf549db457acd262c\nMalicious TXT file (README.TXT) detected as JS_GETFO.ZIEI-A:\ne9ab3195f3a974861aa1135862f6c24df1d7f5820e8c2ac6e61a1a5096457fc3\nBackdoor (RLxF) detected as BKDR_COBALT.ZHEJ-A:\n0dedb345d90dbba7e83b2d618c93d701ed9e9037aa3b7c7c58b62e53dab7d2ce\nHashes related to the spear phishing campaign exploiting CVE-2017-8759:\nEmail attachments/RTF files detected as TROJ_MDROP.ZHEI-A:\neb4325ef1cbfba85b35eec3204e7f79e4703bb706d5431a914b13288dcf1d598\na0292cc74ef005b2e5e0889d1fc1711f07688b93b16ebc3174895d7752a16a23\n94155a2940a1d49a92a602a5232f156eeb1d35018847edb9c6002cefe4c49f94\n69e55d2e3207e29d9efc806ff36f13cd49fb92f7c12f0145f867674b559734a3\nMalicious XML file (test.xml) detected as TROJ_CVE20178759.ZIEI-A:\n0f5c5d07ed0508875330a0cb89ba3f88c58f92d5b1536d20190df1e00ebd3d91\nBackdoor (ZxT6) detected as BKDR_COBALT.ZIEI-A:\n9d9d1c246ba83a646dd9537d665344d6a611e7a279dcfe288a377840c31fe89c\nBackdoor (MZBt) detected as BKDR64_COBALT.ZIEI-A:\ne78e800bc259a46d51a866581dcdc7ad2d05da1fa38841a5ba534a43a8393ce9\nRelated malicious URLs:\nhxxp://visa-fraud-monitoring[.]com/t[.]dll\nhxxps://webmail[.]microsoft[.]org[.]kz/portal/readme[.]txt\nhxxps://webmail[.]microsoft[.]org[.]kz/portal/ajax[.]php\nhxxp://servicecentrum[.]info/test[.]xml\nhxxps://5[.]135[.]237[.]216[/]RLxF\nhxxps://86[.]106[.]131[.]207[/]ZxT6\nhxxps://86[.]106[.]131[.]207[/]MZB\nLearn how to protect Enterprises, Small Businesses, and Home Users from ransomware:\nENTERPRISE SMALL BUSINESS HOME1 \n\n» » »\nHome Categories\nSearch:\n "
}