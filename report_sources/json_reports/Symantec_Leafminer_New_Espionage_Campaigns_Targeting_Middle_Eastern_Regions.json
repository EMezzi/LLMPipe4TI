{
    "title": "Symantec_Leafminer_New_Espionage_Campaigns_Targeting_Middle_Eastern_Regions",
    "text": "Questa è la copia cache di Google di https://symantec-blogs.broadcom.com/blogs/threat-intelligence/leafminer-espionage-middle-east.È un'istantanea della pagina visualizzata il 1 apr 2020 13:33:53GMT.Nel frattempo la pagina corrente potrebbe essere stata modificata.Ulteriori informazioni.Versione completaVersione solo testoVisualizza sorgenteSuggerimento. Per trovare rapidamente il termine di ricerca su questa pagina, digita Ctrl+F o ⌘-F(Mac) e utilizza la barra di ricerca.BlogsMenuMain menuBlogs HomeThreat IntelligenceFeature StoriesExpert PerspectivesProduct InsightsSearchBroadcom HomeSymantec's Enterprise Security business will now operate as the SymantecEnterprise division of Broadcom. Click for details.Critical Attack Discovery and Intelligence TeamSymantecNetwork Protection Security LabsPosted: 25 Jul, 20189 Min ReadThreat IntelligenceSubscribeLeafminer: New Espionage CampaignsTargeting Middle Eastern RegionsActive attack group is eager to make use ofavailable tools, research, and the work of otherLeafminer: New Espionage Campaigns Targeti... https://webcache.googleusercontent.com/searc...\n1 of 11 4/7/20, 9:22 AMthreat actors.Symantec has uncovered the operations of a threat actor named Leafminer thatis targeting a broad list of government organizations and business verticals invarious regions in the Middle East since at least early 2017. The group tends toadapt publicly available techniques and tools for their attacks and experimentswith published proof-of-concept exploits. Leafminer attempts to inﬁltrate targetnetworks through various means of intrusion: watering hole websites,vulnerability scans of network services on the internet, and brute-force/dictionary login attempts. The actor’s post-compromise toolkit suggeststhat the group is looking for email data, ﬁles, and database servers oncompromised target systems.Figure 1. Leafminer targeting organizations in Middle East regionFigure 1. Leafminer targeting organizations in Middle East regionLeafminer’s arsenalDuring our investigation, there was a breakthrough discovery that helpedconnect Leafminer to a number of attacks observed on systems in the MiddleEast and identify the toolkit used in the group’s eﬀorts of intrusion, lateralmovement, and exﬁltration. The download URL for a malware payload used inone of the attacks lead to the identiﬁcation of a compromised web server on thedomain e-qht.az that had been used to distribute Leafminer’s arsenal ofmalware, payloads, and tools within the group and make them available fordownload from victim machines.As of early June 2018, the server hosted 112 ﬁles in a subdirectory that couldbe accessed through a public web shell planted by the attackers. In addition tomalware and tools, the served ﬁles also included uploads of log ﬁles seeminglyoriginating from vulnerability scans and post-compromise tools.The web shell is a modiﬁcation of the PhpSpy backdoor and references theauthor MagicCoder while linking to the (deleted) domain magiccoder.ir.Researching the hacker handle MagicCoder results in references to the Iranianhacking forum Ashiyane as well as defacements by the Iranian hacker groupSun Army.TargetsDuring the investigation of the Leafminer group, we were able to assemble atargeting proﬁle from diﬀerent sources including telemetry and log ﬁles hostedpublicly on the attacker’s arsenal server.One interesting source of target information discovered during theLeafminer investigation was a list of 809 targets used by theattackers for vulnerability scans.Leafminer: New Espionage Campaigns Targeti... https://webcache.googleusercontent.com/searc...\n2 of 11 4/7/20, 9:22 AMSymantec detection telemetry shows malware and custom tools used byLeafminer on 44 systems across four regions in the Middle East.Figure 2. Infected computers per regionFigure 2. Infected computers per regionOne interesting source of target information discovered during the Leafminerinvestigation was a list of 809 targets used by the attackers for vulnerabilityscans. The list is written in the Iranian language Farsi and groups each entrywith organization of interest by geography and industry. Figure 3 shows abreakdown of the industry verticals. Targeted regions included in the list areSaudi Arabia, United Arab Emirates, Qatar, Kuwait, Bahrain, Egypt, Israel, andAfghanistan.Figure 3. Industry verticals targeted by LeafminerFigure 3. Industry verticals targeted by LeafminerIntrusionWe observed three main techniques used by Leafminer for initial intrusion oftarget networks:Compromised web servers used for watering hole attacksScans/exploits for vulnerabilities of network servicesDictionary attacks against logins of network servicesThere are indicators that suggest the attackers have also employed emailphishing with malicious attachment ﬁles. However, this was not directlyobserved or captured.Watering hole SMB credential theftOur investigation of Leafminer started with the discovery of JavaScript code onseveral compromised websites in the Middle East. The obfuscated code wasplanted by the attackers to steal SMB credential hashes that couldsubsequently be brute-forced oﬄine.When executing the code, the browser creates an invisible image tag and setsthe URL to an attack server using the ﬁle:// protocol scheme. On Windowsmachines, this triggers a request to a remote server via the Samba networkingprotocol (SMB) that also transmits the user’s login NTLM hash. These hashescan be cracked to retrieve the original login password by methods of brute-force, dictionary, or rainbow table lookups.Table 1 shows an overview of the compromised websites used as wateringholes, infected JavaScript URLs, and SMB URLs used to collect NTLM hashes.Table 1. Watering hole website detailsLeafminer: New Espionage Campaigns Targeti... https://webcache.googleusercontent.com/searc...\n3 of 11 4/7/20, 9:22 AMTable 1. Watering hole website detailsInterestingly, the same technique was also observed in watering hole attacks bythe threat actor Dragonﬂy in 2017 as reported by Symantec.Vulnerability scans and exploitationAs previously mentioned, Leafminer seems to be actively followingdevelopments and publications of the oﬀensive security community whenselecting their toolkit. This became especially apparent when analyzing thegroup’s techniques and tools for vulnerability scans and exploitation. Thecompromised web server used to store Leafminer’s arsenal hosted severalpublic proof-of-concept exploits and exploitation tools.\"Leafminer espionage group makes use of available tools, research, and work ofother threat actors https://symc.ly/2MNFOOD\"Click to TweetThis included the Fuzzbunch framework that was part of an infamous leak ofexploits and tools by the Shadow Brokers in April 2017. Leafminer hasdeveloped exploit payloads for this framework (Table 2) that deliver custommalware through attacks against SMB vulnerabilities described by Microsoft.The EternalBlue exploit from the framework received worldwide attention afterbeing used in the ransomware campaigns WannaCry in May andPetya/NotPetya in June 2017. The Leafminer operators use EternalBlue toattempt lateral movement within target networks from compromised stagingservers.Symantec also observed attempts by Leafminer to scan for the Heartbleedvulnerability (CVE-2014-0160) from an attacker-controlled IP address.Furthermore, the Leafminer arsenal server hosted a Python script to scan forthis vulnerability.Dictionary attacksAnother intrusion approach used by Leafminer seems a lot less sophisticatedthan the previously described methods but can be just as eﬀective: usingspeciﬁc hacktools to guess the login passwords for services exposed by atargeted system. This type of attack was observed both via dedicated serversset up by Leafminer as well as staging servers compromised by the group.Commands found in a readme text that was stored in a ZIP archive togetherwith the hacktool THC Hydra in Leafminer’s tool arsenal represent onlinedictionary attacks on Microsoft Exchange and Remote Desktop Protocolservices of regional government servers in Saudi Arabia. \"Online\" in this caserefers to the attacker using the protocol of the targeted network service toquickly run through many password guesses.Leafminer: New Espionage Campaigns Targeti... https://webcache.googleusercontent.com/searc...\n4 of 11 4/7/20, 9:22 AMCustom malwareSymantec identiﬁed two strains of custom malware used by the Leafminergroup: Trojan.Imecab and Backdoor.Sorgu. Directly connected to this malwareare several sets of reﬂective loader DLLs used as droppers or to executespeciﬁc commands on a compromised system.The development of custom malware by Leafminer as well as some of the toolsused for lateral movement show a preference for the .NET framework. We alsoobserved that the attackers would download and install the .NET framework oncompromised machines, supposedly in the situation that an operator wouldhave remote access to the system but required .NET to run Leafminer's customtools. To this end, the command and control (C&C) server operated by thegroup hosted the legitimate setup executable for Microsoft .NET Framework2.0 SP2.Backdoor.SorguBackdoor.Sorgu is used by the attackers to provide remote access to theinfected machine. The backdoor is installed as a service in the Windows systemthrough a shell command script.Trojan.ImecabThe purpose of Trojan.Imecab is to set up a persistent remote access accounton the target machine with a hardcoded password. Variants of the malwarewere also observed with the ﬁlename guester.exe which likely refers to thefunctionality of adding a powerful guest account to the system.The malware installs itself in the system as a Windows service to achievepersistence and ensure that the guest account remains available to theattacker.Reﬂective loader DLLsTable 2 gives an overview of the reﬂective loader DLLs and their purpose:Table 2. Reﬂective loader DLLsTable 2. Reﬂective loader DLLsThese DLLs were likely used as payloads for exploit shellcode of the Fuzzbunchframework, which is also evidenced by the embedded PDB strings.Lateral movement and exﬁltrationThe discovery of malware and hacktools hosted on e-qht.az allowed us toLeafminer: New Espionage Campaigns Targeti... https://webcache.googleusercontent.com/searc...\n5 of 11 4/7/20, 9:22 AMcorrelate detection telemetry of potential Leafminer intrusions with tools madeavailable for download to the group’s operators. Understanding the purpose ofthe tools used by the attacker gives a unique insight into the tactics andprocedures used by Leafminer after the initial compromise of a target network.Table 3 outlines the observed toolset for lateral movement, informationgathering, and exﬁltration.Table 3. Toolset for lateral movement, information gathering, andexﬁltrationTable 3. Toolset for lateral movement, information gathering, andexﬁltrationWe discovered a number of servers compromised by Leafminer that were usedas staging systems to gain a foothold in the targeted network and executeattacks on intranet resources. For example, the use of THC Hydra to executedictionary attacks against Exchange logins was observed both in initialintrusion attempts as well as in lateral attacks from staging systems.Figure 4 shows a screenshot of the Total SMB BruteForcer hacktool used byLeafminer for lateral movement. The tool requires input ﬁles with lists of IPs,users, and passwords respectively.Figure 4. Total SMB BruteForcerFigure 4. Total SMB BruteForcerThe arsenal server hosted ﬁve text ﬁles that could be used by Leafmineroperators as input for dictionary attacks using Total SMB Bruteforcer and THCHydra.OrangeTeghal and Process DoppelgängingOne of the custom tools used by the Leafminer group is a rebranded version ofthe widespread post-exploitation tool Mimikatz.Figure 5. OrangeTeghalFigure 5. OrangeTeghalWhile the logo and commands are identical to the original hacktool, the namewas changed to OrangeTeghal. To evade security software while deploying thistool on compromised systems, the attackers use a technique revealed at BlackHat EU ‘17 in the presentation Lost in Transaction: Process Doppelgänging.The malware ﬁle orange64.exe is a .NET executable that drops and executes aPowerShell script with basic obfuscation. After deobfuscation, this scriptclosely resembles the code published by the authors of the technique. ProcessDoppelgänging uses NTFS transactions to modify the executable of a seeminglybenign process that is suspended right after creation.Leafminer: New Espionage Campaigns Targeti... https://webcache.googleusercontent.com/searc...\n6 of 11 4/7/20, 9:22 AMAmbitions blunted by inexperienceLeafminer is a highly active group, responsible for targeting a range oforganizations across the Middle East. The group appears to be based in Iranand seems to be eager to learn from and capitalize on tools and techniquesused by more advanced threat actors.On a broad level, it has followed the recent trend among targeted attack groupsfor “living oﬀ the land”—using a mixture of publicly available tools alongside itsown custom malware. More speciﬁcally, it mimicked Dragonﬂy’s use of awatering hole to harvest network credentials. It also capitalized on the ShadowBrokers release of Inception Framework tools, making use of the leakedFuzzbunch framework by developing its own exploit payloads for it.Leafminer’s eagerness to learn from others suggests someinexperience on the part of the attackers, a conclusion that’ssupported by the group’s poor operational security.Leafminer has also been tracking developments in the world of cyber security.After the Heartbleed bug was disclosed it began scanning for instances of thevulnerability. It also utilized Process Doppelgänging, a detection evasiontechnique ﬁrst discussed at the Black Hat EU conference last year.However, Leafminer’s eagerness to learn from others suggests someinexperience on the part of the attackers, a conclusion that’s supported by thegroup’s poor operational security. It made a major blunder in leaving a stagingserver publicly accessible, exposing the group’s entire arsenal of tools. Thatone misstep provided us with a valuable trove of intelligence to help us betterdefend our customers against further Leafminer attacks.ProtectionSymantec has the following protections in place to protect customers againstLeafminer attacks:File-based protectionBackdoor.SorguTrojan.ImecabThreat intelligenceCustomers of the DeepSight Intelligence Managed Adversary and ThreatIntelligence (MATI) service have received intelligence that details thecharacteristics of the Leafminer cyber espionage group and methods ofdetecting and thwarting activities of this adversary.Leafminer: New Espionage Campaigns Targeti... https://webcache.googleusercontent.com/searc...\n7 of 11 4/7/20, 9:22 AMBest PracticesImportant passwords, such as those with high privileges, should be at least8-10 characters long (and preferably longer) and include a mixture ofletters and numbers. Encourage users to avoid reusing the samepasswords on multiple websites and sharing passwords with others shouldbe forbidden. Delete unused credentials and proﬁles and limit the numberof administrative-level proﬁles created. Employ two-factor authentication(such as Symantec VIP) to provide an additional layer of security,preventing any stolen credentials from being used by attackers.Emphasize multiple, overlapping, and mutually supportive defensivesystems to guard against single point failures in any speciﬁc technology orprotection method. This should include the deployment of regularlyupdated ﬁrewalls as well as gateway antivirus, intrusion detection orprotection systems (IPS), website vulnerability with malware protection,and web security gateway solutions throughout the network.Implement and enforce a security policy whereby any sensitive data isencrypted at rest and in transit. Ensure that customer data is encrypted aswell. This can help mitigate the damage of potential data leaks from withinan organization.Implement SMB egress traﬀic ﬁltering on perimeter devices to preventSMB traﬀic leaving your network onto the internet.Educate employees on the dangers posed by spear-phishing emails,including exercising caution around emails from unfamiliar sources andopening attachments that haven’t been solicited. A full protection stackhelps to defend against emailed threats, including Symantec EmailSecurity.cloud, which can block email-borne threats, and SymantecEndpoint Protection, which can block malware on the endpoint. SymantecMessaging Gateway’s Disarm technology can also protect computers fromthreats by removing malicious content from attached documents beforethey even reach the user.Understanding the tools, techniques, and procedures (TTP) of adversariesthrough services like DeepSight Adversary Intelligence fuels eﬀectivedefense from advanced adversaries like Leafminer. Beyond technicalunderstanding of the group, strategic intelligence that informs themotivation, capability, and likely next moves of the adversaries ensuresmore timely and eﬀective decisions in proactively safeguarding yourenvironment from these threats.IOCsSymantec has also developed a list of Indicators of Compromise to assist inidentifying Leafminer activity:File AttachmentsLeafminer: New Espionage Campaigns Targeti... https://webcache.googleusercontent.com/searc...\n8 of 11 4/7/20, 9:22 AMLeafminer IOCsTXT3.26 KBTable contents in text formatTXT2.3 KB\nAbout the AuthorCritical Attack Discovery and Intelligence TeamSymantecThe Critical Attack Discovery and Intelligence team is a group of securityexperts within Symantec whose mission is to investigate targeted attacks, driveenhanced protection in Symantec products, and oﬀer analysis that helpscustomers respond to attacks.Leafminer: New Espionage Campaigns Targeti... https://webcache.googleusercontent.com/searc...\n9 of 11 4/7/20, 9:22 AMAbout the AuthorNetwork Protection Security LabsNetwork Protection Security Labs is a group of security experts within NetworkProtection Products doing advanced security research to continuously improveSymantec Network Products.Want to comment on this post?We encourage you to share your thoughts on your favorite social platform.Related Blog PostsPosted: 11 Mar, 202028 Min ReadMicrosoft Patch Tuesday – March 2020Leafminer: New Espionage Campaigns Targeti... https://webcache.googleusercontent.com/searc...\n10 of 11 4/7/20, 9:22 AMPosted: 12 Feb, 202024 Min ReadMicrosoft Patch Tuesday – February 2020Posted: 3 Feb, 20203 Min ReadGeopolitical Tensions May Increase Risk of DestructiveAttacksPosted: 20 Jan, 20204 Min ReadIncrease in Emotet Spam Observed, Blocked by SymantecSymantecSubscribePrivacy PolicyCookie PolicyData Processing and Data TransfersSupplier ResponsibilityTerms of UseSitemapCopyright © 2005-2020 Broadcom. All Rights Reserved. The term \"Broadcom\"refers to Broadcom Inc. and/or its subsidiaries.Get Symantec's Latest Blog Posts In Your Inbox I accept the Terms of Use. Your privacy is important to us. Please see ourPrivacy Policy for more information.Enter your email addressSubscribeSubmittedCloseLeafminer: New Espionage Campaigns Targeti... https://webcache.googleusercontent.com/searc...\n11 of 11 4/7/20, 9:22 AM"
}