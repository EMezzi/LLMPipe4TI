{
    "title": "R1-4.12.7",
    "text": "Dec 2017\u0001\nCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\tYoshihiro Ishikawa \u0001\nOpen\tSource\tas\tfuel\tof\trecent\tAPT\u0001Copyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nWho\tam\ti?\t• Organization:\tLAC\t• Department:\tCyber\tCounter\tThreat\tTeam\t• Job\tTitle:\tSecurity\tResearcher\tCISSP\tyoshihiro.ishikawa[at]lac.co.jp\tYoshihiro\tIshikawa\t\n2\tCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\n Agenda\u0001n Purpose\tn Open\tSource\tMalware\tTargeting\tMacOS\tn PowerShell\tEmpire\timproperly\tused\tn Prevention\tmethod\tn Conclusion\t\n3\tCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nPurpose\u0001PowerSploit\t\t\nTiny\tSHell\tn Recently,\tthere\tare\tso\tmany\tAPT\tattacks\tfueled\tby\tthe\tusage\tof\tthe\topen\tsource\ttools\tand\tmalware.\tn Why?\tn Actors\tperforming\tattacks\tusing\topen\tsource\ttools\tare\tbecoming\tmore\teasy\tand\tmore\tresourceful.\tn Actors\tare likely\tanonymize\ttheir\tattacks.\tn Actors\tusually\tmodified\ttheir\tattack\tcode\tand\tcreated\ta\tnew\tcustomized\tmalware\teasily.\tKoadic\tQuasarRAT\tmimikatz\tTrochilus\tPupy\t4\tNishang\tCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nPurpose:\tAPT\tgroups\twith\tOpen\tSource\tTools\u0001n APT10\t(menuPass):\tPowerSploit,\tKoadic,\tQuasarRAT,\tRedleaves(Trochilus)\tn Public,\tTechnology,\tEnergy\tsectors,\tetc\t(USA,\tCanada,\tUK,\tFrance,\tSouth\tKorea,\tJapan,\tetc)[1]\tn Cloudy\tOmega\t(Blue\tTermite):\tmimikatz\tn Some\tcompanies,\tno\tspecific\ttrends\t(Japan)\tn Tick\t(BRONZE\tBUTLER):\tmimikatz\tn Critical\tInfrastructure\tand\tmanufacture\t(South\tKorea\tand\tJapan)\tn PassCV/BARIUM\t(Winnti?)[2][3]:\tMetasploit,\tBeFF\tn Game\tmakers\t(USA,\tChina,\tRussia,\tSouth\tKorea,\tTaiwan\tand\tJapan)\tn Unsure\tGroup\t(APT10):\tPowerShell\tEmpire\tn Political\tand\tacademic\tsectors\t(Japan)\tIn\tthis\tpresentation,\tI\twill\tintroduce\tPassCV\tand\tUnsure\tGroup’s\tTTPs\tconfirmed\tin\tJapan\tin\t2017\t5\t\nCYBERɹ-ɹEDUCATIONɹ-ɹPENTESTɹ-ɹJSOCɹ-ɹ 119ɹ-ɹCONSULTING\tWe provide IT total solutions based on advanced security technologies.\t\nCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\tOpen Source Malware Targeting MacOS\u0001Copyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nOpen\tsource\tmalware\tvariant\tusing\tTiny\tSHell\u0001\nn Identification\t(I\tpicked\tonly\tone\tcase)\tn Hash:\t0161317c5f4fb3901df63c6e88f60933\tn Type:\tMach-O\t64-bit\tExecutable\tn Lang:\tC\tn Characteristic:\tn Developed\twith\tXcode\ton\tMacOSX\tSierra(10.12)\tn Tiny\tSHell\toriginal\tsource\tcode\twas\tused\tn No\tcode\tsigning\tFile\tinformation\t\nCharacteristic\tString\t\n7\tCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nWhat\tabout\tTiny\tSHell\u0001Tiny\tSHell\tis\tan\topen\tsource\tbackdoor\tthat\tcompiles\ton\tall\tPOSIX\tvariants[4][5]\t\nn Functions\tn Remote\tShell\tExecution\tn File\tUpload\tn File\tDownload\tn C2\tCommunication\tn Protocol:\tTCP\tn Port:\t22\t(default)\tn Encryption:\tAES\tn Default\tkey\tis\t\"never\tsay\tnever\tsay\tdie\"\t\nCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nComparison\tof\tsimilarities\u0001\nto\tcall\tAES\tencryption\tTiny\tSHell\tMalicious\tvariant\tusing\tTiny\tSHell\t\nWe\tcan\tconfirm\tthat\t\tthese\tcodes\tare\tALMOST\tidentical.\tAES\tKey\t=\t“free&2015”\tto\tcall\tbackdoor\tfunctions\t\n9\tCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nFunctions\tonly\tin\tTiny\tSHell\tvariants\u00011.\tThe\tmalware\tconfiguration/setting\tfile\tCase\troot\t(Privilege\tuser)\tn For\tsetting\tinformation\tused\tby\tmalware,\tit\twas\tsaved\tas\ta\t“.\tcache”\tfile.\tThis\t“.cache”\tfile\tis\tread\tfrom\tdifferent\tPATH\taccording\tto\tauthority.\tn C2\tinformation\twritten\tin\tthe\t\".cache\"\tfile\tis\tencrypted\tand\tmalware\tdecrypts\tthe\tstring\tusing\tthe\tXOR\tdecoder\tfunction\tdescribed\tin\tpart\t\"2.\tDecryption\tfunction\".\t\n10\t\n.cache\tfile\tloading\tfunction\tCase\troot\t(Privilege\tuser)\t\nCase\tuser\t\nC2\tDomain\tPort\tSleep\tTime\tForged\tProcess\t.cache\tfile\tCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\n2.\tDecryption\tFunction\tXOR\tdecrypt\tthe\tcontents\tof\t.cache\tor\thard-coded\tstrings\tin\tmalware.\tOur\tDecrypting\tScript\tin\tpython\t\t\nDecrypted\tString\t\nFunctions\tonly\tin\tTiny\tSHell\tvariants\u0001\n11\tCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\n3.\tAnti-analysis\tfunction\tand\tmalicious\tenvironment\tsetup\t\nn A\tfunction\tto\tcheck\twhether\t“tcpdump”\tis\trunning\ton\tthe\tcomputer.\tn Shell\tand\tMySQL\tcommand\twithout\thistory\tenabled\tsetting.\tFunctions\tonly\tin\tTiny\tSHell\tvariants\u0001\n12\tCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\n4.\tCreate\trootkit\tand\tbe\tcalled\tfrom\tit\tn A\trootkit\t(“rsakit”)\tis\tcreated\tafter\tconnected\tto\tC2\tserver\tand\treceiving\tresponse.\tn This\trootkit\tis\talso\tusing\tan\topen\tsource\ttool\tvariant\tof\trtkit\tcode.[6]\tn Rootkit\tfunctionality:\tto\thide\town\tprocess\tor\tarbitrary\tprocess.\t\nrootkit\t(rsakit)\t\tvariant\tTiny\tSHell\tFunctions\tonly\tin\tTiny\tSHell\tvariants\tin\tLinux\u0001\n13\tCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nMalware\tconnection\tand\trelated\telements\t\nIP\taddress\tassociated\twith\tthe\tC2\tserver\tdomain\tof\tmalware\tis\t“61.78.62\t[.]\t21”\t\nThis\tIP\twas\tused\t“war[.]geekgalaxy[.]com”\t\nThis\tdomain\trelated\t“PassCV”[7]\tNext\tattention\tto\tother\tIP\taddress\t“106.184.5[.]252”[8]\t\niisexit[at]gmail.com\t61.78.62.xxx\t106.184.5.xxx\t\njob[.]yoyakuweb[.]technology\tresume[.]immigrantlol[.]com\tRelated\telement\t\n14\tCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nHow\tused\tfor\tattacking\t\njob[.]yoyakuweb[.]technology\tUser-Agent\tCheck\tresume[.]immigrantlol[.]com\t\ninfo.zip\tResume.app\t\nBeef\tC2\tCase\tMac\t\ninfo.zip\tInfo.doc\tCase\tWindows\tappaffect[.]com\t\nCobalt\tStrike[10]\tvps2java[.]securitytactics[.]com\t\nMetasploit\tFramework[9]\t\nxxxx.zip\tInfo.chm\t/\tStefan_Info.doc……exe\t\nOther\tC2\t\nBeginning\tis\tspear\tphishing\te-mail\t\n15\tCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nCase\tWindows:\tusing\tCVE-2017-0199\texploit\t\nCVE-2017-0199\texploit\t\ndecoy\tfile\tof\tthe\tresume\tis\topened,\tand\tmalicious\tscript\tdownload\tBase64\t+\tgzip\t\nNext\tPayload\tdownload\t\n16\tCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nThis\tcode\tis\tusing\texec-sc.ps1\tof\t\tDon't\tKill\tMy\tCat\t(DKMC)[11]\t(too\tlong,\tredacted)\tBase64\tThis\tcode\tis\tMetasploit\tshellcode\t\nThis\tcombination\tused\tattack\t\tCobalt\tStrike\tcalled\t\"Beacon\"\tDecoded\tScript\tCase\tWindows:\tusing\tCVE-2017-0199\texploit\t\n17\tCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nCase\tWindows:\tothers\tattacking\ttypes\u0001\nDownload\tnext\tdownloader\tCase\tchm\t(in\t2014)\t\nCase\texe\t(in\t2016)\t.chm\tfile\tcontain\tin\tmalicious\tscript\t\nextract\texecute\t\ndrop&\texecute\t\nCobalt\tStrike\tBeacon\tPayload\texecute\t\tdecoy\tfile\tis\topened\tand\texe\tfile\texecute\t\t18\tCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nCase\tMac:\tusing\tmalicious\tjar\tfile\u0001\nInfo.zip\tInfo.plist\t\nJavaAppLauncher\tApplication\tBundle\t\nFunctions:\tRead\tand\texecute\tbundled\tResume.jar\tThis\tapplication\tis\tnot\tmalicious.\t\tIt\twas\tsimilar\tto\tAppBundler\tcode.[12]\t\ncodesign\t\n19\t\nCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nconfig\tdecompile\tdecoy\tfile\t\nResume.jar\tread\tconfig\t(Flash.dat)\tand\tconnect\tto\tC2\tsave\tand\tdisplay\tdecoy\tfile\tCase\tMac:\tusing\tmalicious\tjar\tfile\u0001\n20\tCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nFlash.dat\t(config)\t\nC2\tDomain\tFlag\tPort\tSleep\tTime\tThis\tfile\tcontent\tencrypt\t\t10-bytes\tXOR\tkey\t\nvps2java[.]securitytactics.com\t\nThis\tpacket\tis\tusing\tMeterpreter.\tIt\tseems\tthat\tMetasploit\tFramework\twas\trunning\ton\tthe\tC2\tserver.\t\t\nCase\tMac:\tusing\tmalicious\tjar\tfile\u0001\n21\t\nCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nAttack\tis\tongoing\t?\u0001\nThis\tIP\tis\tPassCV\tInfrastructures\tIs\tnew\tspear\tphishing\te-mail\tattack\tlaunching?\t\n“eggagent[.]info”\tused\t“106.184.5[.]252”\t\tand\tnow\tused\t“139.162.95[.]39”\tIt\tmight\tbe\tnew\tattack\tInfrastructure\t\n\t(PassiveTotal)[13]\t\n(DomainTools)[14]\t\n22\tA\tresume\tis\tdisplayed\twhen\taccessing\tthe\tdomain\tCYBERɹ-ɹEDUCATIONɹ-ɹPENTESTɹ-ɹJSOCɹ-ɹ 119ɹ-ɹCONSULTING\tWe provide IT total solutions based on advanced security technologies.\t\nCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\tPowerShell Empire improperly used\u0001Copyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nWhat\tabout\tPowerShell\tEmpire\u0001\nPowerShell\tEmpire[15]\tRunning\t\tPowerShell\tEmpire\t\n24\tPowerShell\tEmpire\tis\ta\tpost-exploitation\tframework\tand\tit\tis\tmainly\tusing\tin\ta\tpenetration\ttest\tand\tRed\tTeam\tAssessment.\tCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nPowerShell\tEmpire:\tInfection\tvector\u0001\nSpecific\tUniversity\tOrganization\t\nThe\tcontents\tof\tthe\tZip\tfile\tare\tsuspicious\tLNK\tfiles\tand\tRTF\tfiles\tspear\tphishing\te-mail\t\naccess\tto\tURL\tand\tZip\tFile\tDownload\t\nZip\tfile\t\nspecified\taccount\thas\tbeen\thackd\t\n[16]\t25\tCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nLNK/RTF\tfile\tdetail\tof\t1st\tpayload\u0001\nLNK\tRTF\t\nCall\tPowerShell\tusing\tScript\tin\tthe\tHTA\tfile\tThis\tcommunication\tis\t443/TCP\tbut,\tHTTP\tis\tused\tinstead\tof\tHTTPS\t\nRTF\tfile\twith\t\tCVE-2017-0199\t\texploit\tLNK\tfile\twill\texecute\t\tMSHTA.exe\t\n26\tCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nHTA\tfile\tdetail\tof\t2nd\tpayload\t(case\tof\tLNK)\u0001\nThis\tcode\tis\tPowerShell\tEmpire\t\nBase64\tResponse\tdata\t(HTA\tfile)\t\nDisplay\tDecoy\tWeb\tPages\t27\tCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nPersistence\tmethods\twith\tPowerShell\tEmpire\u0001\nThis\tstring\tBase64\tdecoded\tresult\tis\tEmpire\tscript\t\nTask\tscheduler\t\nPlease\tcheck\tthe\t“debug”\tregistry\tvalue\tTask\tProgram\t\tto\tlunch\t\tPowerShell\t\n28\tCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nMalware\tconnection\tand\trelated\telements\t\nBoth\tcompanies\tprovide\tWeb\tHosting\tservice\t\nWe\tcan\tsee\t“HTTP/1.0”\tand\t“Microsoft-IIS/7.5”\tin\tthe\tHTTP\tresponse\theader\t\nThis\tcombination\tused\tEmpire\tC2\tServer\t\t(listeners/http.py).\tIt\twas\trunning\tas\tof\tchecked\ton\tlate\tAugust\t2017.\t27\t\nCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nPrevention\tmethod\u0001n Plenty\tof\tinitial\tattack\tvectors\tare\tSpear\tPhishing\tE-mail.\tn Keep\tup-to-date\twith\tlatest\tsystems,\tsoftware\tand\tused\tsecurity\tproducts\tn Educate\temployees\ton\tpotential\tsecurity\tthreats\t&\tnot\topening\tunknown\temail\tn Have\ta\tspecial\tcare\tfor\trecent\texploit\tvectors(DDE,\tXLL\tAdd-Ins,\tetc)\twhich\tare\thaving\tvery\tpotential\tusage\tto\tbe\tused\tin\tattack.\tn Disabling\tDDE,\tXLL\tAdd-Ins\twith\tMicrosoft\tOffice\tsettings\tetc.\t[17]\t\tn PowerShell,\tHTA,\tCHM\tare\toften\tused\tin\tthis\tseries\tor\tsimilar\tthreats.\tn Blocking\tPowerShell,\tHTA\tand\tCHM\twith\tAppLocker\tor\tSRP\tetc[18][19]\t\tn Repeatedly\tuse\tsimilar\tattack\tmethods\tand\tuse\talmost\tsame\tinfrastructure.\tn Utilize\tThreat\tIntelligence\ttools\t30\tCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\nConclusion\u0001n Recent\tAPT\tattacks\tare\theavily\tusing\topen\tsource\ttool\tand\thas\tthe\tincreasing\ttendension\tto\tmodify\tthe\toriginal\tsource\tcode,\tso\tthat\tthey\tcan\tcorrespond\tto\tvarious\tplatforms.\tn The\tpast\tevidence\tshows\tus\tthat\tthe\tattacks\tare\tcontinuing\tand\tstill\tongoing\ttoo\tnow.\tn For\tthe\tinformation\tsharing\twith\tOPSEC\ton\ta\tglobal\tscale,\tyou\tare\tmore\tthan\twelcome\tto\tcontact\tus\t!\t31\tCYBERɹ-ɹEDUCATIONɹ-ɹPENTESTɹ-ɹJSOCɹ-ɹ 119ɹ-ɹCONSULTING\tWe provide IT total solutions based on advanced security technologies.\t\nCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\tThank you. Any Questions ?\t\nCopyright\t©LAC\tCo.,\tLtd.\tAll\tRights\tReserved.\t\n1. https://www.pwc.co.uk/cyber-security/pdf/cloud-hopper-report-final-v4.pdf\t2. https://blog.cylance.com/digitally-signed-malware-targeting-gaming-companies\t3. https://blogs.technet.microsoft.com/mmpc/2017/01/25/detecting-threat-actors-in-recent-german-industrial-attacks-with-windows-defender-atp/\t4. https://packetstormsecurity.com/files/31650/tsh-0.6.tgz.html\t5. https://github.com/creaktive/tsh\t6. https://github.com/ivyl/rootkit\t7. https://www.bluecoat.com/zh-cn/security-blog/2014-07-21/korean-gaming-industry-still-under-fire\t8. https://www.protectwise.com/post/winnti-evolution-going-open-source/\t9. https://www.metasploit.com/\t10. https://www.cobaltstrike.com/\t11. https://github.com/Mr-Un1k0d3r/DKMC\t12. https://bitbucket.org/infinitekind/appbundler\t13. https://community.riskiq.com/\t14. https://www.domaintools.com/\t15. https://www.powershellempire.com/\t16. https://www.jcer.or.jp/center/f.relationship_jp-us.html\t17. https://labs.mwrinfosecurity.com/blog/add-in-opportunities-for-office-persistence/\t18. https://www.iij.ad.jp/en/company/development/iir/pdf/iir_vol32_infra_EN.pdf\t19. https://www.symantec.com/content/dam/symantec/docs/security-center/white-papers/increased-use-of-powershell-in-attacks-16-en.pdf\tReference\u0001\n33\t"
}